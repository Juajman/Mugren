;■■■■■■■
;ジャストディフェンス(立ち)
[statedef 4000]
type = S
physics = S
movetype=I
ctrl = 0
velset = 0,0
anim = 150

[state 4100]
type = PlaySND
trigger1 = time=0
value = 4000,0

[state 150]
type = PlaySND
trigger1 = (!var(10)||var(10)>=1000)&&time=0
value = 10,30
channel = 1

;成功
[state 4100]
type = varset
trigger1 = time=0
var(30) = 1

[state 4100]
type = PowerAdd
trigger1 = time=0
value = floor(30*fvar(16)*1.250)

;JUST DEFENCE
[state -2]
type = Explod
trigger1 = !time
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8076
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;スタイリッシュポイント取得
[state 4100]
type = varadd
trigger1 = !time
fvar(15) = .015

[state 4100]
type = ChangeState
trigger1 = time=0
value = 150

;ジャストディフェンス（しゃがみ）
[statedef 4010]
type = C
physics = C
movetype=I
ctrl = 0
velset = 0,0
anim = 150

[state 4100]
type = PlaySND
trigger1 = time=0
value = 4000,0

[state 150]
type = PlaySND
trigger1 = (!var(10)||var(10)>=1000)&&time=0
value = 10,30
channel = 1

;成功
[state 4100]
type = varset
trigger1 = time=0
var(30) = 1

[state 4100]
type = PowerAdd
trigger1 = time=0
value = floor(30*fvar(16)*1.250)

;JUST DEFENCE
[state -2]
type = Explod
trigger1 = !time
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8076
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;スタイリッシュポイント取得
[state 4100]
type = varadd
trigger1 = !time
fvar(15) = .015

[state 4100]
type = ChangeState
trigger1 = time=0
value = 152

;ジャストディフェンス（空中）
[statedef 4020]
type = A
physics = N
movetype=I
ctrl = 0
velset = 0,0
anim = 152

[state 4100]
type = PlaySND
trigger1 = time=0
value = 4000,0

[state 150]
type = PlaySND
trigger1 = (!var(10)||var(10)>=1000)&&time=0
value = 10,30
channel = 1

;成功
[state 4100]
type = varset
trigger1 = time=0
var(30) = 1

[state 4100]
type = PowerAdd
trigger1 = time=0
value = floor(30*fvar(16)*1.250)

;JUST DEFENCE
[state -2]
type = Explod
trigger1 = !time
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8076
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;スタイリッシュポイント取得
[state 4100]
type = varadd
trigger1 = !time
fvar(15) = .015

[state 4100]
type = ChangeState
trigger1 = time=0
value = 154

;■■■■■■■
;パーフェクトガード(立ち)
[statedef 4100]
type = S
physics = S
movetype=I
ctrl = 0
velset = 0,0
anim = 150

[state 4100]
type = PlaySND
trigger1 = time=0
value = 4100,0

[state 4100]
type = PlaySND
trigger1 = time=0&&var(31)<-1
value = 5210,0

[state 150]
type = PlaySND
trigger1 = (!var(10)||var(10)>=1000)&&time=0
value = 10,31
channel = 1

[state 4100]
type = RemoveExplod
trigger1 = time=0
id = 7705

;成功
[state 4100]
type = varset
trigger1 = time=0
var(31) = 1+(var(31)<-1)

;JUST PG
[state -2]
type = Explod
trigger1 = time=0 && var(31)=2
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8083
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;スタイリッシュポイント取得
[state 4100]
type = varadd
trigger1 = time=0 && var(31)=2
fvar(15) = .015

[state 4100]
type = ChangeState
trigger1 = time=0
value = 150

;パーフェクトガード（しゃがみ）
[statedef 4110]
type = C
physics = C
movetype=I
ctrl = 0
velset = 0,0
anim = 150

[state 4100]
type = PlaySND
trigger1 = time=0
value = 4100,0

[state 4100]
type = PlaySND
trigger1 = time=0&&var(31)<-1
value = 5210,0

[state 150]
type = PlaySND
trigger1 = (!var(10)||var(10)>=1000)&&time=0
value = 10,31
channel = 1

[state 4100]
type = RemoveExplod
trigger1 = time=0
id = 7705

;成功
[state 4100]
type = varset
trigger1 = time=0
var(31) = 1+(var(31)<-1)


;JUST PG
[state -2]
type = Explod
trigger1 = time=0 && var(31)=2
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8083
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;スタイリッシュポイント取得
[state 4100]
type = varadd
trigger1 = time=0 && var(31)=2
fvar(15) = .015

[state 4100]
type = ChangeState
trigger1 = time=0
value = 152

;パーフェクトガード（空中）
[statedef 4120]
type = A
physics = N
movetype=I;H
ctrl = 0
velset = 0,0
anim = 152

[state 4100]
type = PlaySND
trigger1 = time=0
value = 4100,0

[state 4100]
type = PlaySND
trigger1 = time=0&&var(31)<-1
value = 5210,0

[state 150]
type = PlaySND
trigger1 = (!var(10)||var(10)>=1000)&&time=0
value = 10,31
channel = 1

[state 4100]
type = RemoveExplod
trigger1 = time=0
id = 7705

;成功
[state 4100]
type = varset
trigger1 = time=0
var(31) = 1+(var(31)<-1)

;JUST PG
[state -2]
type = Explod
trigger1 = time=0 && var(31)=2
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8083
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;スタイリッシュポイント取得
[state 4100]
type = varadd
trigger1 = time=0 && var(31)=2
fvar(15) = .015

;パーフェクトガード成功判別エフェクト
[state 8000]
type = Explod
trigger1 = !numexplod(7701+(var(31)=2))&&var(31)
id = 7701+(var(31)=2)
anim = 90000
pos = 0,-floor(180*const(size.yscale))
postype = p1
sprpriority = 3
bindtime=-1
ownpal = 1
ignorehitpause=0
scale = const(size.xscale),const(size.yscale)

[state 8000]
type = PowerSet
trigger1 = var(31)&&time=0
value = var(55)

[state 8000]
type = PowerAdd
trigger1 = var(31)&&time=0&&(prevstateno=[5000,5099])
value = -floor(40*ifelse(statetype=A,2.0,ifelse(statetype=C,1.5,1))*1.250)

[state 4100]
type = LifeSet
trigger1 = 1
value = var(38)

[state -2]
type = varset
trigger1 = var(31)>0
var(31) = -1
ignorehitpause=1

;ヒットポーズ用
[state 1000]
type = varset
trigger1 = time=0
var(48) = gethitvar(hitshaketime)

[state 4100]
type = ChangeState
trigger1 = !time&&prevstateno=154
value = 154

[state 4100]
type = HitOverride
trigger1 = power
stateno = 4120
attr = SCA,AA,AP
slot = 0
time=1

[state 4100]
type = ChangeState
trigger1 = time>=var(48)
value = 155

;パーフェクトガード（空中）
[statedef 4130]
type = A
physics = N
movetype=H
ctrl = 0
velset = gethitvar(xvel)*ifelse(var(31)=2,4.0,1.5)*facing,ifelse(gethitvar(yvel)<-2,-2,gethitvar(yvel))
anim = 152

;画面端用（相手押し返し）
[state 1000]
type = Helper
trigger1 = Time=0&&(var(31)=[1,2])&&(backedgebodydist<=5||frontedgebodydist<=5)&&(gethitvar(xvel)*facing<0)
id = 14100
stateno=14100+(gethitvar(xvel)*facing<=-6&&var(31)=2)
persistent=0
pos = 0,0
postype = p2
persistent=0
size.ground.front = 0
size.ground.back = 20
size.height = 240

;画面端用（相手押し返し）
[state 1000]
type = Helper
trigger1 = Time=0&&var(31)=2&&(gethitvar(xvel)*facing<0)
id = 14105
stateno=14105
persistent=0
pos = const(size.ground.front)+ifelse(P2statetype=A,enemynear,const(size.air.front),enemynear,const(size.ground.front))+floor(P2bodydist X),0
postype = p1
persistent=0
size.ground.front = 0
size.ground.back = 20
size.height = 240

[state 151]
type = varset
trigger1 = time=0&&var(31)
var(31)=-1

[state 4100]
type = LifeSet
trigger1 = 1
value = var(38)

[state 4120]
type = CtrlSet
trigger1 = time>=var(47)+4
value = 1

[state 4100]
type = ChangeState
trigger1 = Vel Y>0&&Pos Y>=0
value = ifelse(var(31),130+(command="holddown"),52)

;パーフェクトガードエフェクト
[statedef 7700]
type = S
physics = S
ctrl = 0
anim = 90000

[state 7990]
type = AssertSpecial
trigger1 = 1
flag = noshadow

;成功後判別
[state 7700]
type = varset
trigger1 = (root,stateno=150||root,stateno=152||root,stateno=154||root,stateno=4120)
var(10) = 1

[state 7700]
type = Varadd
trigger1 = var(0)
var(0) = 1

[state 7700]
type = VarSet
trigger1 = !numexplod(7700)
var(0) = 0

[state 7700]
type = Varset
trigger1 = !numexplod(7700)&&root,var(31)&&!var(0)&&!var(10)
var(0) = 1

[state 7700]
type = VarSet
trigger1 = var(0)>28
var(0) = 1

[state 7700]
type = Varadd
trigger1 = var(1)
var(1) = 1

[state 7700]
type = VarSet
trigger1 = !numexplod(7701)
var(1) = 0

[state 7700]
type = Varset
trigger1 = !numexplod(7701)&&var(0)=16&&!var(1)
var(1) = 1

[state 7700]
type = VarSet
trigger1 = var(1)>28
var(1) = 1

[state 7700]
type = Varadd
trigger1 = var(2)
var(2) = 1

[state 7700]
type = VarSet
trigger1 = !numexplod(7704)
var(2) = 0

[state 7700]
type = Varset
trigger1 = !numexplod(7704)&&var(0)=1&&!var(1)
var(2) = 1

[state 7700]
type = VarSet
trigger1 = var(2)>28
var(2) = 1

[state 7700]
type = Varadd
trigger1 = var(5)
var(5) = 1

[state 7700]
type = VarSet
trigger1 = !numexplod(7705)
var(5) = 0

[state 7700]
type = Varset
trigger1 = !numexplod(7705)&&(root,stateno=150||root,stateno=152||root,stateno=154||root,stateno=4120||var(10))&&!var(5)
var(5) = 1

[state 7700]
type = VarSet
trigger1 = var(5)>14
var(5) = 1

[state 7700]
type = Varadd
trigger1 = var(6)
var(6) = 1

[state 7700]
type = VarSet
trigger1 = !numexplod(7706)
var(6) = 0

[state 7700]
type = Varset
trigger1 = !numexplod(7706)&&var(10)&&var(5)=6&&!var(6)
var(6) = 1

[state 7700]
type = VarSet
trigger1 = var(6)>14
var(6) = 1

[state 7700]
type = Varadd
trigger1 = var(7)
var(7) = 1

[state 7700]
type = VarSet
trigger1 = !numexplod(7707)
var(7) = 0

[state 7700]
type = Varset
trigger1 = !numexplod(7707)&&var(10)&&var(6)=6&&!var(7)
var(7) = 1

[state 7700]
type = VarSet
trigger1 = var(7)>14
var(7) = 1

[state 7700]
type = Varadd
trigger1 = var(8)
var(8) = 1

[state 7700]
type = VarSet
trigger1 = !numexplod(7708)
var(8) = 0

[state 7700]
type = Varset
trigger1 = !numexplod(7708)&&var(10)&&var(7)=6&&!var(8)
var(8) = 1

[state 7700]
type = VarSet
trigger1 = var(8)>14
var(8) = 1

[state 7700]
type = Varadd
trigger1 = var(9)
var(9) = 1

[state 7700]
type = VarSet
trigger1 = !numexplod(7709)
var(9) = 0

[state 7700]
type = Varset
trigger1 = !numexplod(7709)&&var(10)&&var(8)=6&&!var(9)
var(9) = 1

[state 7700]
type = VarSet
trigger1 = var(9)>14
var(9) = 1

;パーフェクトガードエフェクト1
[state 8000]
type = Explod
trigger1 = !numexplod(7700)&&root,var(31)&&!var(10)
id = 7700
anim = 7700
pos = 0,0
postype = p1
sprpriority = 3
bindtime=-1
removetime=-1
ownpal = 0
ignorehitpause=0
scale = const(size.xscale)*.5,const(size.yscale)*.5

;パーフェクトガードエフェクト2
[state 8000]
type = Explod
trigger1 = !numexplod(7701)&&root,var(31)&&var(0)=16&&!var(10)
id = 7701
anim = 7700
pos = 0,0
postype = p1
sprpriority = 3
bindtime=-1
removetime=-1
ownpal = 0
ignorehitpause=0
scale = const(size.xscale)*.5,const(size.yscale)*.5

;パーフェクトガードエフェクト3
[state 8000]
type = Explod
trigger1 = !numexplod(7704)&&root,var(31)&&var(0)=1&&!var(10)
id = 7704
anim = 7701
pos = 0,0
postype = p1
sprpriority = 3
bindtime=-1
removetime=-1
ownpal = 0
ignorehitpause=0
scale = const(size.xscale),const(size.yscale)

;パーフェクトガードエフェクト1(成功後)
[state 8000]
type = Explod
trigger1 = !numexplod(7705)&&(root,stateno=150||root,stateno=152||root,stateno=154||root,stateno=4120||var(10))
id = 7705
anim = 7700
pos = 0,0
postype = p1
sprpriority = 3
bindtime=-1
removetime=-1
ownpal = 0
ignorehitpause=0
scale = const(size.xscale)*.5,const(size.yscale)*.5

;パーフェクトガードエフェクト2(成功後)
[state 8000]
type = Explod
trigger1 = !numexplod(7706)&&var(10)&&var(5)=6
id = 7706
anim = 7700
pos = 0,0
postype = p1
sprpriority = 3
bindtime=-1
removetime=-1
ownpal = 0
ignorehitpause=0
scale = const(size.xscale)*.5,const(size.yscale)*.5

;パーフェクトガードエフェクト3(成功後)
[state 8000]
type = Explod
trigger1 = !numexplod(7707)&&var(10)&&var(6)=6
id = 7707
anim = 7700
pos = 0,0
postype = p1
sprpriority = 3
bindtime=-1
removetime=-1
ownpal = 0
ignorehitpause=0
scale = const(size.xscale)*.5,const(size.yscale)*.5

;パーフェクトガードエフェクト4(成功後)
[state 8000]
type = Explod
trigger1 = !numexplod(7708)&&var(10)&&var(7)=6
id = 7708
anim = 7700
pos = 0,0
postype = p1
sprpriority = 3
bindtime=-1
removetime=-1
ownpal = 0
ignorehitpause=0
scale = const(size.xscale)*.5,const(size.yscale)*.5

;パーフェクトガードエフェクト5(成功後)
[state 8000]
type = Explod
trigger1 = !numexplod(7709)&&var(10)&&var(8)=6
id = 7709
anim = 7700
pos = 0,0
postype = p1
sprpriority = 3
bindtime=-1
removetime=-1
ownpal = 0
ignorehitpause=0
scale = const(size.xscale)*.5,const(size.yscale)*.5

;閃光
[state 7700]
type = Helper
trigger1 = root,var(31)&&(root,stateno=150||root,stateno=152||root,stateno=154||root,stateno=4120)&&root,time=1
id = 7701
stateno=7701
pos = 0,0
postype = P1
ownpal = 1
size.xscale = const(size.xscale)*(1-random%4*.25)
size.yscale = 500
pausemovetime = 9
supermovetime = 9

[state 7700]
type = Helper
trigger1 = root,var(31)&&(root,stateno=150||root,stateno=152||root,stateno=154||root,stateno=4120)&&root,time=1
id = 7701
stateno=7701
pos = 0,0
postype = P1
ownpal = 1
size.xscale = const(size.xscale)*(1-random%4*.25)
size.yscale = 500
pausemovetime = 9
supermovetime = 9

[state 7700]
type = Helper
trigger1 = root,var(31)&&(root,stateno=150||root,stateno=152||root,stateno=154||root,stateno=4120)&&root,time=1
id = 7701
stateno=7701
pos = 0,0
postype = P1
ownpal = 1
size.xscale = const(size.xscale)*(1-random%4*.25)
size.yscale = 500
pausemovetime = 9
supermovetime = 9

[state 7700]
type = Helper
trigger1 = root,var(31)&&(root,stateno=150||root,stateno=152||root,stateno=154||root,stateno=4120)&&root,time=1
id = 7701
stateno=7701
pos = 0,0
postype = P1
ownpal = 1
size.xscale = const(size.xscale)*(1-random%4*.25)
size.yscale = 500
pausemovetime = 9
supermovetime = 9

;光	
[state 8000]
type = Explod
trigger1 = root,var(31)&&(root,stateno=150||root,stateno=152||root,stateno=154||root,stateno=4120)&&root,time=1
id = 7702
anim = 7702
pos = 5,0
postype = p1
sprpriority = 3
bindtime= 1
ownpal = 1
ignorehitpause=1
scale = const(size.xscale)*1.25,const(size.yscale)*1.25

[state 7700]
type = BindtoRoot
trigger1 = 1
pos = 0,floor(ifelse(root,statetype=C,-90,-140)*const(size.yscale)+(120+const(size.head.pos.y)))
time=-1

[state 7700]
type = ModifyExplod
trigger1 = 1
id = 7700
scale = (1.0+(var(0)-1)*.01)*.5,(1.0+(var(0)-1)*.01)*.5

[state 7700]
type = ModifyExplod
trigger1 = 1
id = 7701
scale = (1.0+(var(1)-1)*.01)*.5,(1.0+(var(1)-1)*.01)*.5

[state 7700]
type = ModifyExplod
trigger1 = 1
id = 7704
scale = .15+(var(2)-1)*.0375,.15+(var(2)-1)*.0375

[state 7700]
type = ModifyExplod
trigger1 = 1
id = 7705
scale = (1.125+(var(5)-1)*.025)*.5,(1.125+(var(5)-1)*.025)*.5

[state 7700]
type = ModifyExplod
trigger1 = 1
id = 7706
scale = (1.125+(var(6)-1)*.025)*.5,(1.125+(var(6)-1)*.025)*.5

[state 7700]
type = ModifyExplod
trigger1 = 1
id = 7707
scale = (1.125+(var(7)-1)*.025)*.5,(1.125+(var(7)-1)*.025)*.5

[state 7700]
type = ModifyExplod
trigger1 = 1
id = 7708
scale = (1.125+(var(8)-1)*.025)*.5,(1.125+(var(8)-1)*.025)*.5

[state 7700]
type = ModifyExplod
trigger1 = 1
id = 7709
scale = (1.125+(var(9)-1)*.025)*.5,(1.125+(var(9)-1)*.025)*.5

[state 7700]
type = RemoveExplod
trigger1 = numexplod(7700)&&(root,stateno=150||root,stateno=152||root,stateno=154||root,stateno=4120)
id = 7700

[state 7700]
type = RemoveExplod
trigger1 = numexplod(7701)&&(root,stateno=150||root,stateno=152||root,stateno=154||root,stateno=4120)
id = 7701

[state 7700]
type = RemoveExplod
trigger1 = numexplod(7704)&&(root,stateno=150||root,stateno=152||root,stateno=154||root,stateno=4120)
id = 7704

[state 7700]
type = RemoveExplod
trigger1 = !root,var(31)
id = 7700

[state 7700]
type = RemoveExplod
trigger1 = !root,var(31)
id = 7701

[state 7700]
type = RemoveExplod
trigger1 = !root,var(31)
id = 7704

[state 7700]
type = RemoveExplod
trigger1 = !root,var(31)
id = 7705

[state 7700]
type = RemoveExplod
trigger1 = !root,var(31)
id = 7706

[state 7700]
type = RemoveExplod
trigger1 = !root,var(31)
id = 7707

[state 7700]
type = RemoveExplod
trigger1 = !root,var(31)
id = 7708

[state 7700]
type = RemoveExplod
trigger1 = !root,var(31)
id = 7709

[state 7700]
type = DestroySelf
trigger1 = !root,var(31)

;パーフェクトガード成功エフェクト（閃光）
[statedef 7701]
type = A
physics = N
ctrl = 0
velset = 0,0
anim = 7709
sprpriority = 99999

[state 7710]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[state 7710]
type = VarSet
trigger1 = !time
fvar(1) = (1-random%3*.25)
ignorehitpause = 1

[state 7710]
type = AngleSet
trigger1 = !time
value = random%361
ignorehitpause = 1

[state 7710]
type = AngleAdd
trigger1 = time
value = (3.0+random%5)-((time%6=5)*(25+random%3*12.5))
ignorehitpause = 1

[state 7710]
type = AngleDraw
trigger1 = 1
ignorehitpause = 1

[state 7710]
type = Trans
trigger1 = 1
trans = addalpha
alpha = 256-time*20,256
ignorehitpause = 1

[state 7710]
type = DestroySelf
trigger1 = Time>13
ignorehitpause = 1

;---------------------------------------------------------------------------
;自分側ガードクラッシュ（立ち）
[Statedef 5910]
type    = S
movetype = I
physics = N
ctrl = 0
velset = 0,0

[state 15910]
type = ChangeAnim
trigger1 = time=0
value = 5002

[state 15910]
type = ChangeAnim
trigger1 = time>0&&animtime=-1&&(anim=[5000,5029])
value = anim
elem = AnimElemNo(0)

[state 15910]
type = ChangeAnim
trigger1 = time=49
value = 5007

[state 15910]
type = ChangeAnim
trigger1 = time=0
trigger1 = SelfAnimExist(5910)
value = 5910

[state 15910]
type = ChangeAnim
trigger1 = time=49
trigger1 = SelfAnimExist(5911)
value = 5911

[state 15910]
type = SelfState
trigger1 = time=60
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;自分側ガードクラッシュ（立ち開始）
[Statedef 5915]
type = S
movetype=I
physics = N
ctrl = 0
velset = 0,0
anim = 150

;効果音
[State -2,PlaySnd]
type = PlaySnd
trigger1 = time=0
value = 5910,0

;エフェクト
[State 6100, Explod]
type = Explod
trigger1 = time=0
anim = 7750
id = 7750
postype = P1
pos = 10,-50
vel = 1,-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
sprpriority = 5
scale = 1,1

;エフェクト
[State 6100, Explod]
type = Explod
trigger1 = time=0
anim = 7750
id = 7750
postype = P1
pos = 0,-65
vel = 1,1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
sprpriority = 5
scale = 1,1

;エフェクト
[State 6100, Explod]
type = Explod
trigger1 = time=0
anim = 7750
id = 7750
postype = P1
pos = -10,-50
vel = -1,-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
sprpriority = 5
scale = 1,1

;エフェクト
[State 6100, Explod]
type = Explod
trigger1 = time=0
anim = 7750
id = 7750
postype = P1
pos = 5,-35
vel = 1,1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
sprpriority = 5
scale = 1,1

[state 5910]
type = VarSet
trigger1 = !time
var(23) = 256

[state 15910]
type = ChangeState
trigger1 = !enemynear,hitpausetime||time>=16
value = 5910
;---------------------------------------------------------------------------
;自分側ガードクラッシュ（空中）
[Statedef 5930]
type    = A
movetype = I
physics = N
ctrl = 0
velset = 0,0

[state 15910]
type = ChangeAnim
trigger1 = time=0
value = 5002

[state 15910]
type = ChangeAnim
trigger1 = time>0&&animtime=-1&&(anim=[5000,5029])
value = anim
elem = AnimElemNo(0)

[state 15910]
type = ChangeAnim
trigger1 = time=0
trigger1 = SelfAnimExist(5930)
value = 5930

[state 15910]
type = VelAdd
trigger1 = 1
y = .5

[state 15910]
type = ChangeState
trigger1 = time>0 && vel Y>0 && Pos Y>=0
value = 5910

;---------------------------------------------------------------------------
;自分側ガードクラッシュ（空中開始）
[Statedef 5935]
type    = A
movetype = H
physics = N
ctrl = 0
velset = 0,0
anim = 152

;効果音
[State -2,PlaySnd]
type = PlaySnd
trigger1 = time=0
value = 5910,0

;エフェクト
[State 6100, Explod]
type = Explod
trigger1 = time=0
anim = 7750
id = 7750
postype = P1
pos = 10,-50
vel = 1,-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
sprpriority = 5
scale = 1,1

;エフェクト
[State 6100, Explod]
type = Explod
trigger1 = time=0
anim = 7750
id = 7750
postype = P1
pos = 0,-65
vel = 1,1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
sprpriority = 5
scale = 1,1

;エフェクト
[State 6100, Explod]
type = Explod
trigger1 = time=0
anim = 7750
id = 7750
postype = P1
pos = -10,-50
vel = -1,-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
sprpriority = 5
scale = 1,1

;エフェクト
[State 6100, Explod]
type = Explod
trigger1 = time=0
anim = 7750
id = 7750
postype = P1
pos = 5,-35
vel = 1,1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
sprpriority = 5
scale = 1,1

[state 5910]
type = VarSet
trigger1 = !time
var(23) = 256

[state 15910]
type = ChangeState
trigger1 = !enemynear,hitpausetime||time>=16
value = 5930
;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
;気絶(自分)
[Statedef 5300]
type = S
movetype = H
physics = S
ctrl = 0
velset = 0,0
anim = 5300

[state 15300]
type = ChangeAnim
trigger1 = hitshakeover&&(prevstateno=5000||prevstateno=5010)
value = ifelse((anim=[5000,5002])||(anim=[5010,5012])||(anim=[5020,5022]),anim+5,ifelse(prevstateno=5000,5007,5027))
persistent=0

[state 15300]
type = ChangeAnim
trigger1 = hitover
value = 5300
persistent=0

[state 15300]
type = HitFallSet
trigger1 = !time
value = 0

[state 15300]
type = lifeadd
trigger1 = !time&&prevstateno=5000
value = -gethitvar(damage)

[State 5910,Exit]
type = ChangeState
trigger1 = time>=30&&var(26)=[-2,0]
value = 0
ctrl = 1

;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
;気絶（吹き飛び）
[Statedef 5310]
type = A
movetype = H
physics = N
ctrl = 0
velset = 0,0
anim = ifelse(GetHitVar(animtype)<=3||!SelfAnimExist(5051)||!SelfAnimExist(5052),5030,5047 + GetHitVar(animtype))

[State 5310]
type = ChangeAnim
trigger1 = !hitshakeover
value = Anim

[state 5310]
type = Changeanim
trigger1 = anim=5030&&animtime=0
value = 5050

[State 5050, 2] ;Coming down anim
type = ChangeAnim
trigger1 = anim = [5050,5059]
trigger1 = Vel Y >= 1
trigger1 = SelfAnimExist(anim+10)
value = anim+10
persistent = 0

[State 5310]
type = VelSet
trigger1 = hitshakeover
x = gethitvar(xvel)*ifelse(facing=-1,-1,1)
y = gethitvar(yvel)
persistent=0

[State 5300]
type = VelAdd
trigger1 = hitshakeover
y = gethitvar(yaccel)

[State 5300]
type = ChangeState
trigger1 = Vel Y>0
trigger1 = Pos Y >= ifelse((anim = [5051,5059]) || (anim = [5061,5069]), 0, 25)
value = 5320

;気絶（叩き付け）
;Dizzy : HIT_BOUNCE (hit ground)
[Statedef 5320]
type = L
movetype = H
physics = N
ctrl = 0
velset = 0,0
anim = 5100

[State 5300]
type = NotHitby
trigger1 = 1
value = SCA

[State 5300]
type = PosSet
trigger1 = Time=0
y = 0

;叩きつけ
[State -2,PlaySnd]
type = PlaySnd
trigger1 = Time=0
value = 5100,0

[state 816]
type = EnvShake
trigger1 = Time=0
time = 8
ampl = 4


[State 40, 1]
type = Explod
trigger1 = !Time
id = 6910
anim = 6910
pos = ceil(-6*const(size.xscale)),ceil(0*const(size.yscale))
postype = p1
ownpal = 1
sprpriority = 3
facing = -1
vel = -5*const(size.xscale),0
scale = const(size.xscale),const(size.yscale)
pausemovetime = 9999
supermovetime = 9999

[State 40, 1]
type = Explod
trigger1 = !Time
id = 6910
anim = 6910
pos = ceil(6*const(size.xscale)),ceil(0*const(size.yscale))
postype = p1
ownpal = 1
sprpriority = 3
facing = 1
vel = 5*const(size.xscale),0
scale = const(size.xscale),const(size.yscale)
pausemovetime = 9999
supermovetime = 9999

[State 40, 1]
type = Explod
trigger1 = !Time
id = 6910
anim = 6910
pos = ceil(-6*const(size.xscale)),-ceil(8*const(size.yscale))
postype = p1
ownpal = 1
sprpriority = 3
facing = -1
vel = -4*const(size.xscale),-0*const(size.yscale)
accel = 0*const(size.xscale),-.25*const(size.yscale)
scale = const(size.xscale),const(size.yscale)
pausemovetime = 9999
supermovetime = 9999

[State 40, 1]
type = Explod
trigger1 = !Time
id = 6910
anim = 6910
pos = ceil(6*const(size.xscale)),-ceil(8*const(size.yscale))
postype = p1
ownpal = 1
sprpriority = 3
facing = 1
vel = 4*const(size.xscale),-0*const(size.yscale)
accel = 0*const(size.xscale),-.25*const(size.yscale)
scale = const(size.xscale),const(size.yscale)
pausemovetime = 9999
supermovetime = 9999

[State 5300]
type = ChangeState
trigger1 = AnimTime=0
value = 5330

;---------------------------------------------------------------------------
; 気絶（バウンド）
;Dizzy : HIT_BOUNCE (bounce into air)
[Statedef 5330]
type    = L
movetype = H
physics = N

[State 5300]
type = NotHitby
trigger1 = 1
value = SCA

[State 5101, 1] ;Coming hit ground anim (normal)
type = ChangeAnim
trigger1 = time = 0
value = 5160

[State 5101, 3]
type = VelSet
trigger1 = Time = 0
x = -2.0*ifelse(P2Dist X<=0,-1,1)
y = -4.0

[State 5101, 4]
type = PosSet
trigger1 = Time = 0
y = 20

[State 5101, 5] ;Acceleration
type = VelAdd
trigger1 = 1
y = .4

[State 5101, 6] ;Hit ground
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 12
type = ChangeState
value = 5340

;---------------------------------------------------------------------------
;気絶（ダウン）
;Dizzy : HIT_LIEDOWN
[Statedef 5340]
type    = L
movetype = H
physics = N

[State 5300]
type = NotHitby
trigger1 = 1
value = SCA

[State 5110, EnvShake]
type = FallEnvShake
trigger1 = Time = 0 && prevstateno!=5120

[State 5110, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 5110, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 5110, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)

[State 5110, 4]
type = HitFallDamage
trigger1 = Time = 0

[State 5110, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5110, Var] ;Get fall velocity
type = VarSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) != 0
sysvar(1) = floor(vel y)

[State 5110, 7]
type = null;GameMakeAnim
trigger1 = Time = 0 && prevstateno!=5120
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 14

[State 5110, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5110, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
value = 5110

[State 5110, 11] ;If just died
type = ChangeState
triggerall = !alive
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

[State 5110, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.5

[State 5110, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 3
ampl = 240
waveform = sine

[State 5110, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[State 5300]
type = ChangeState
trigger1 = Time=const(data.liedown.time)
value = 5350

;気絶（ダウン中）
;Dizzy : HitLieDown
[Statedef 5350]
type = L
movetype = I
physics = N
ctrl = 0
velset = 0,0

[State 5300]
type = NotHitby
trigger1 = 1
value = SCA

[State 5300]
type = ChangeAnim
trigger1 = Time=0
value = 5120

[State 5300]
type = PosSet
trigger1 = Time=0
y = 0

[State 5300]
type = Hitfallset
trigger1 = anim=5120 && AnimTime=0
value = 1

[State 5300]
type = ChangeState
trigger1 = anim=5120 && AnimTime=0
value = 5300

;-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
;==========相手用===============
;気絶
[Statedef 15300]
type = S
movetype=H
physics = S
ctrl = 0
velset = 0,0

[state 15300]
type = ChangeAnim
trigger1 = hitshakeover&&(prevstateno=5000||prevstateno=5010)
value = ifelse((anim=[5000,5002])||(anim=[5010,5012])||(anim=[5020,5022]),anim+5,ifelse(prevstateno=5000,5007,5027))
persistent=0

[state 15300]
type = ChangeAnim
trigger1 = hitover
value = 5300
persistent=0

[state 15300]
type = HitFallSet
trigger1 = !time
value = 0

[state 15300]
type = lifeadd
trigger1 = !time&&prevstateno=5000
value = -gethitvar(damage)

[State 5910,Exit]
type = SelfState
trigger1 = time>=120&&!((enemynear,authorname="rei"||enemynear,authorname="gal129")&&enemynear,fvar(39)=7&&enemynear,var(28)<=0)
trigger2 = Time>=30&&(enemynear,authorname="rei"||enemynear,authorname="gal129")&&enemynear,fvar(39)=7&&(enemynear,var(28)=[-2,0])
value = 0
ctrl = 1

;気絶
[Statedef 15310]
type = A
movetype = H
physics = N
ctrl = 0
velset = 0,0
anim = ifelse(GetHitVar(animtype)<=3||!SelfAnimExist(5051)||!SelfAnimExist(5052),5030,5047 + GetHitVar(animtype))

[State 5310]
type = ChangeAnim
trigger1 = !hitshakeover
value = Anim

[state 5310]
type = Changeanim
trigger1 = anim=5030&&animtime=0
value = 5050

[State 5050, 2] ;Coming down anim
type = ChangeAnim
triggerall = hitshakeover
trigger1 = anim = [5050,5059]
trigger1 = Vel Y >= 1
trigger1 = SelfAnimExist(anim+10)
value = anim+10
persistent = 0

[State 5310]
type = VelSet
trigger1 = hitshakeover
x = gethitvar(xvel)*ifelse(facing=-1,-1,1)
y = gethitvar(yvel)
persistent=0

[State 5300]
type = VelAdd
trigger1 = hitshakeover
y = gethitvar(yaccel)

[State 5300]
type = ChangeState
trigger1 = Vel Y>0
trigger1 = Pos Y >= ifelse((anim = [5051,5059]) || (anim = [5061,5069]), 0, 25)
value = 15320

;気絶
[Statedef 15320]
type = A;L
movetype = H
physics = N;S
ctrl = 0
;velset = 0,0
anim = 5100+((Anim=5051||Anim=5061||Anim=5070)&&SelfAnimExist(5101))

[State 5100, 11]
type = PosFreeze
trigger1 = 1

[State 5300]
type = PosSet
trigger1 = Time=0
y = 0

;叩きつけ
[State -2,PlaySnd]
type = PlaySnd
trigger1 = Time=0 && (authorname="rei"||authorname="gal129")
value = 5100,0

[State 5100, 10]
type = PlaySnd
trigger1 = Time = 0 && !(authorname="rei"||authorname="gal129")
value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)

[state 816]
type = EnvShake
trigger1 = Time=0
time = 8
ampl = 4

[State 5110, 7]
type = GameMakeAnim
trigger1 = Time = 0 && prevstateno!=5120
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 14

[State 5300]
type = ChangeState
trigger1 = Time=3
value = 15330

;---------------------------------------------------------------------------
; 気絶（バウンド）
;Dizzy : HIT_BOUNCE (bounce into air)
[Statedef 15330]
type    = A
movetype = H
physics = N

[State 5101, 1] ;Coming hit ground anim (normal)
type = ChangeAnim
trigger1 = time = 0
value = 5160+(Anim=5101&&SelfAnimExist(5161))

[State 5101, 3]
type = VelSet
trigger1 = Time = 0
x = -2.0*ifelse(P2Dist X<=0,-1,1)
y = -4.0

[State 5101, 4]
type = PosSet
trigger1 = Time = 0
y = 20

[State 5101, 5] ;Acceleration
type = VelAdd
trigger1 = 1
y = .4

[State 5101, 6] ;Hit ground
triggerall = !alive
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 12
type = SelfState
value = 5110

[State 5101, 6] ;Hit ground
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 12
type = ChangeState
value = 15340

;気絶
[Statedef 15340]
type = L
movetype = I
physics = N
ctrl = 0
velset = 0,0
anim = 5170+(Anim=5161&&SelfAnimExist(5171))

[State 1000, 0]
type = HitFallSet
trigger1 = (anim=[5120,5121]) && AnimTime=0
value = 1

;叩きつけ
[State -2,PlaySnd]
type = PlaySnd
trigger1 = Time=0 && (authorname="rei"||authorname="gal129") && fvar(39)=1
value = 5100,1

[State 5100, 10]
type = PlaySnd
trigger1 = Time = 0 && !((authorname="rei"||authorname="gal129") && fvar(39)=1)
value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)

[State 5110, 7]
type = GameMakeAnim
trigger1 = Time = 0 && prevstateno!=5120
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 14

[State 5300]
type = NotHitby
trigger1 = 1
value = SCA

[State 5300]
type = ChangeAnim
trigger1 = (anim=[5170,5171]) && animTime=0
value = 5110+(Anim=5171&&SelfAnimExist(5111))

[State 5300]
type = ChangeAnim
trigger1 = (anim=[5110,5111]) && time>=12
value = 5120+(Anim=5111&&SelfAnimExist(5121))

[State 5300]
type = PosSet
trigger1 = Time=0
y = 0

[State 5300]
type = ChangeState
trigger1 = (anim=[5120,5121]) && AnimTime=0
value = 15300
;---------------------------------------------------------------------------
;相手側ガードクラッシュ用
[Statedef 15900]
type    = S
movetype = I
physics = N
ctrl = 0
velset = 0,0
anim = 90000

;ガードクラッシュ設定
[state 15910]
type = varset
triggerall = time=0
trigger1 = root,stateno=420
var(0) = 4

[state 15910]
type = varset
trigger1 = time=0
trigger1 = root,stateno=200||root,stateno=400||root,stateno=600
trigger2 = root,stateno=420&&root,animelemtime(6)>=0
var(0) = 6

[state 15910]
type = varset
trigger1 = time=0
trigger1 = root,stateno=3100
trigger2 = root,stateno=1000&&root,animelemtime(10)>=0
var(0) = 8

[state 15910]
type = varset
triggerall = time=0
trigger1 = (root,stateno=[210,220])||root,stateno=310||root,stateno=410||root,stateno=610||(root,stateno=[710,720])||root,stateno=900||root,stateno=910
trigger2 = (root,stateno=1000&&root,animelemtime(10)<0)||(root,stateno=[1300,1400])||(root,stateno=[3000,3099])
var(0) = 14

[state 15910]
type = varset
trigger1 = time=0
trigger1 = root,stateno=620||root,stateno=2500
trigger2 = root,stateno=900&&root,var(7)>=58
var(0) = 16

;気絶値設定
[state 15380]
type = varset
triggerall = time=0
trigger1 = root,stateno=3010||root,stateno=3100||root,stateno=3500
var(10) = 0

[state 15380]
type = varset
triggerall = time=0
trigger1 = root,stateno=420
var(10) = 4

[state 15380]
type = varset
triggerall = time=0
trigger1 = root,stateno=200||root,stateno=400||root,stateno=600
var(10) = 5

[state 15380]
type = varset
trigger1 = time=0
trigger1 = root,stateno=1000
trigger2 = root,stateno=420&&root,animelemtime(6)>=0
var(10) = 6

[state 15380]
type = varset
triggerall = time=0
trigger1 = (root,stateno=[210,220])||root,stateno=310||root,stateno=410||root,stateno=710||root,stateno=900||root,stateno=910||root,stateno=1300||root,stateno=1400
var(10) = 7

[state 15380]
type = varset
trigger1 = time=0
trigger1 = root,stateno=620||root,stateno=2500||root,stateno=3000
trigger2 = root,stateno=900&&root,var(7)>=58
var(10) = 8

[state 15380]
type = varset
triggerall = time=0
trigger1 = root,var(1)%2>=1&&root,stateno!=900
var(10) = floor(var(10)*.5)

[state 15380]
type = varset
triggerall = time=0
trigger1 = root,var(1)%4>=2&&root,stateno!=910
var(10) = 0

;小判獲得
[state 15380]
type = varset
trigger1 = time=0
var(20) = 0

[state 15380]
type = varset
triggerall = time=0
trigger1 = root,stateno=220
var(20) = 55

[state 15380]
type = varset
trigger1 = root,stateno=420&&root,animelemtime(6)>=0
var(20) = 25
ignorehitpause=1

[state 15380]
type = varset
trigger1 = root,stateno=310&&root,anim=311
var(20) = 60

[state 15380]
type = varset
trigger1 = root,stateno=600&&numhelper(3107)
trigger1 = helper(3107),stateno=3108
var(20) = 23

[state 15380]
type = varset
trigger1 = root,stateno=610&&numhelper(3107)
trigger1 = helper(3107),stateno=3108
var(20) = 42

[state 15380]
type = varset
trigger1 = root,stateno=620&&numhelper(3107)
trigger1 = helper(3107),stateno=3108
var(20) = 50

[state 15380]
type = varset
trigger1 = (root,stateno=[600,620])&&numhelper(3107)
trigger1 = helper(3107),stateno!=3108
trigger2 = (root,stateno=[600,620])&&!numhelper(3107)
var(20) = 0

[state 15380]
type = varset
triggerall = time=0
trigger1 = root,stateno=910
var(20) = 60

[state 15380]
type = varset
triggerall = time=0
trigger1 = root,stateno=1300
var(20) = 61

[state 15380]
type = varset
triggerall = time=0
trigger1 = root,stateno=3000
var(20) = 400

[state 15380]
type = varset
trigger1 = root,stateno=3010 && root,anim=3010 && root,animelemtime(4)>=0
var(20) = 360

[state 15380]
type = varset
trigger1 = root,stateno=3010 && root,anim=3010 && root,animelemtime(4)>=0 && root,var(7)>=28
var(20) = 480

[state 15380]
type = parentvaradd
trigger1 = root,numhelper(18600)&&var(20)
var(37) = floor(var(20)*root,fvar(24))
ignorehitpause=1
persistent=0

[state 15910]
type = varset
trigger1 = time=0
var(1) = root,stateno

[state 15910]
type = parentvarset
trigger1 = roundstate<2
var(25) = 256

[State 0, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "Guard Clash = %f decrease point = %d"
params = root,var(25), var(0)
ignorehitpause =1

[state 15910]
type = DestroySelf
trigger1 = (root,numhelper(15901)||root,numhelper(15902)||root,numhelper(15903)||root,numhelper(15904))&&time>0&&roundstate>=2
trigger2 = (root,stateno=[0,119])&&time>0&&roundstate>=2
trigger3 = roundstate>2

[state 15910]
type = ChangeState
trigger1 = root,numhelper(15380)&&time>0
value = 15380

[state 15910]
type = ChangeState
trigger1 = root,numhelper(15905)&&time>0
value = 15905

[state 15910]
type = ChangeState
trigger1 = root,stateno!=var(1) && (root,anim!=[var(1),var(1)+1]) && !root,var(34) && time>0 && roundstate>=2
value = 15900

;---------------------------------------------------------------------------
;相手側ガードクラッシュ用（援軍用)
[Statedef 15904]
type    = S
movetype = I
physics = N
ctrl = 0
velset = 0,0
anim = 90000

;ガードクラッシュ値設定
[state 15910]
type = varset
triggerall = time=0
trigger1 = parent,stateno=12500
trigger2 = parent,stateno=13000
var(0) = 4

[state 15910]
type = varset
triggerall = time=0
trigger1 = parent,stateno=12000&&floor(root,var(43)/1000)<50
var(0) = 6

[state 15910]
type = varset
triggerall = time=0
trigger1 = parent,stateno=13500
trigger2 = parent,stateno=12000&&floor(root,var(43)/1000)>=50
trigger3 = parent,stateno=12600
var(0) = 8

;気絶値設定
[state 15380]
type = varset
trigger1 = time=0
var(10) = 0

[state 15380]
type = varset
triggerall = time=0
trigger1 = root,var(1)%2>=1&&root,stateno!=900
var(10) = floor(var(10)*.5)

[state 15380]
type = varset
triggerall = time=0
trigger1 = root,var(1)%4>=2&&root,stateno!=910
trigger2 = root,var(2)>=9
var(10) = 0

[state 15910]
type = varset
trigger1 = time=0&&prevstateno!=15905&&prevstateno!=15380
var(1) = parent,stateno

;ガード回数
[state 15910]
type = varadd
trigger1 = time=0&&(prevstateno=15905||prevstateno=15380)
var(2) = 1

[State 0, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "Guard Clash = %f decrease point = %d A= %d"
params = root,var(25), var(0), var(2)
ignorehitpause =1

[state 15910]
type = ChangeState
trigger1 = numhelper(15389)&&time>0
value = 15380

[state 15910]
type = ChangeState
trigger1 = numhelper(15909)&&time>0
value = 15905

[state 15910]
type = DestroySelf
trigger1 = !root,numhelper(20000)
trigger2 = root,var(12)=[-80000,0]
trigger3 = time>ifelse(root,var(12)>=10000,150,ifelse(root,var(12)>=10000,90,50))

;---------------------------------------------------------------------------

;相手側ガードクラッシュ減少
[Statedef 15905]
type    = S
movetype = A
physics = N
ctrl = 0
velset = 0,0
anim = 15910

[state 15910]
type = PosSet
trigger1 = time=0
x = ceil(enemynear,pos X)

[state 15910]
type = varset
trigger1 = time=0
var(3) = 0

[state 15910]
type = varset
trigger1 = time=0&&(root,var(25)-ceil(var(0)*1.0))<=0&&roundstate=2
trigger1 = ifelse((enemynear,authorname="rei"||enemynear,authorname="gal129")&&(enemynear,fvar(39)=1||enemynear,fvar(39)=4||enemynear,fvar(39)=7),(enemynear,prevstateno!=[4100,4120]),1)
var(3) = 1

;効果音
[State -2,PlaySnd]
type = PlaySnd
trigger1 = time=0&&(root,var(25)-ceil(var(0)*1.0))<=0&&roundstate=2
value = 5910,0

;エフェクト
[State 6100, Explod]
type = Explod
trigger1 = time=0&&(root,var(25)-ceil(var(0)*1.0))<=0&&roundstate=2
anim = 7750
id = 7750
postype = P1
pos = 10,-50
vel = -1,1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
sprpriority = 5
scale = 1,1

;エフェクト
[State 6100, Explod]
type = Explod
trigger1 = time=0&&(root,var(25)-ceil(var(0)*1.0))<=0&&roundstate=2
anim = 7750
id = 7750
postype = P1
pos = 0,-65
vel = 1,1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
sprpriority = 5
scale = 1,1

;エフェクト
[State 6100, Explod]
type = Explod
trigger1 = time=0&&(root,var(25)-ceil(var(0)*1.0))<=0&&roundstate=2
anim = 7750
id = 7750
postype = P1
pos = -10,-50
vel = -1,-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
sprpriority = 5
scale = 1,1

;エフェクト
[State 6100, Explod]
type = Explod
trigger1 = time=0&&(root,var(25)-ceil(var(0)*1.0))<=0&&roundstate=2
anim = 7750
id = 7750
postype = P1
pos = 5,-35
vel = 1,1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
sprpriority = 5
scale = 1,1

[State 200,HitDef]
type = HitDef
trigger1 = time=0&&(root,var(25)-ceil(var(0)*1.0))<=0&&roundstate=2&&P2statetype!=A
trigger1 = ifelse((enemynear,authorname="rei"||enemynear,authorname="gal129")&&(enemynear,fvar(39)=1||enemynear,fvar(39)=4||enemynear,fvar(39)=7),(enemynear,prevstateno!=[4100,4120]),1)
attr = S,NT
getpower = 0,0
givepower = 0,0
hitflag = MAF
priority = 9, Hit
pausetime = 0,0
sparkno = -1
guard.sparkno = -1
sparkxy = 0,0
ground.type = High
ground.velocity = 0
guard.velocity = 0
air.velocity = 0,0
yaccel = .4
air.hittime=13
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
fall.recover=0
air.recover=0
p2stateno=15915
numhits = 0

[State 200,HitDef]
type = HitDef
trigger1 = time=0&&(root,var(25)-ceil(var(0)*1.0))<=0&&roundstate=2&&P2statetype=A
trigger1 = ifelse((enemynear,authorname="rei"||enemynear,authorname="gal129")&&(enemynear,fvar(39)=1||enemynear,fvar(39)=4||enemynear,fvar(39)=7),(enemynear,prevstateno!=[4100,4120]),1)
attr = S,NT
getpower = 0,0
givepower = 0,0
hitflag = MAF
priority = 9, Hit
pausetime = 0,0
sparkno = -1
guard.sparkno = -1
sparkxy = 0,0
ground.type = High
ground.velocity = 0
guard.velocity = 0
air.velocity = 0,0
yaccel = .4
air.hittime=13
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
fall.recover=0
air.recover=0
p2stateno=15935
numhits = 0

[state 15910]
type = Pause
trigger1 = movehit&&(root,var(25)-ceil(var(0)*1.0))<=0&&roundstate=2
trigger1 = !((enemynear,authorname="rei"||enemynear,authorname="gal129")&&enemynear,fvar(39)=1)
time = 16-ifelse(root,hitpausetime>=16,1,root,hitpausetime)
movetime = 16-ifelse(root,hitpausetime>=16,1,root,hitpausetime)

[state 15910]
type = parentvarset
trigger1 = movehit&&(root,var(25)-ceil(var(0)*1.0))<=0&&roundstate=2
var(25) = 256

[state 15910]
type = parentvaradd
trigger1 = time=0&&!var(3)
trigger1 = ifelse((enemynear,authorname="rei"||enemynear,authorname="gal129")&&(enemynear,fvar(39)=1||enemynear,fvar(39)=4||enemynear,fvar(39)=7),(enemynear,prevstateno!=[4100,4120]),1)
var(25) = -ceil(var(0)*ifelse(enemynear,name="Honda Tadakatsu",.25,ifelse(enemynear,name="Toyotomi Hideyoshi",.7,ifelse(enemynear,name="Oichi",1.25,1.0))))

[state 15910]
type = ChangeState
triggerall = time&&!(hitdefattr=SCA,AA,AT)&&(prevstateno=[15900,15909])
trigger1 = (var(1)=420&&var(2)<2)||(var(1)=1000&&var(2)<2)
value = 15900

[state 15910]
type = DestroySelf
trigger1 = time>ifelse(var(3)&&!movehit,1,0)
trigger2 = time>0&&(prevstateno!=[15900,15909])

[state -2]
type = DisplayToClipBoard
trigger1 = 1
text = "Clash=%d"
params = var(3)
ignorehitpause=1
;---------------------------------------------------------------------------
;相手側ガードクラッシュ（立ち）
[Statedef 15910]
type    = S
movetype = I
physics = N
ctrl = 0
velset = 0,0

[state 15910]
type = ChangeAnim
trigger1 = time=0
value = 5002

[state 15910]
type = ChangeAnim
trigger1 = time>0&&animtime=-1&&(anim=[5000,5029])
value = anim
elem = AnimElemNo(0)

[state 15910]
type = ChangeAnim
trigger1 = time=49
value = 5007

[state 15910]
type = ChangeAnim
trigger1 = time=0
trigger1 = SelfAnimExist(5910)
value = 5910

[state 15910]
type = ChangeAnim
trigger1 = time=49
trigger1 = SelfAnimExist(5911)
value = 5911

[state 15910]
type = SelfState
trigger1 = time=60
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;相手側ガードクラッシュ（立ち開始）
[Statedef 15915]
type = S
movetype=I
physics = N
ctrl = 0
velset = 0,0
anim = 150

[state 15910]
type = ChangeState
trigger1 = !enemynear,hitpausetime||time>=16
value = 15910
;---------------------------------------------------------------------------
;相手側ガードクラッシュ（空中）
[Statedef 15930]
type    = A
movetype = I
physics = N
ctrl = 0
velset = 0,0

[state 15910]
type = ChangeAnim
trigger1 = time=0
value = 5002

[state 15910]
type = ChangeAnim
trigger1 = time>0&&animtime=-1&&(anim=[5000,5029])
value = anim
elem = AnimElemNo(0)

[state 15910]
type = ChangeAnim
trigger1 = time=0
trigger1 = SelfAnimExist(5930)
value = 5930

[state 15910]
type = VelAdd
trigger1 = 1
y = .5

[state 15910]
type = ChangeState
trigger1 = time>0 && vel Y>0 && Pos Y>=0
value = 15910

;---------------------------------------------------------------------------
;相手側ガードクラッシュ（空中開始）
[Statedef 15935]
type    = A
movetype = H
physics = N
ctrl = 0
velset = 0,0
anim = 152

[state 15910]
type = ChangeState
trigger1 = !enemynear,hitpausetime||time>=16
value = 15930

;---------------------------------------------------------------------------

;相手側気絶値減少
[Statedef 15380]
type    = S
movetype = A
physics = N
ctrl = 0
velset = 0,0
anim = 15910

[state 15910]
type = PosSet
trigger1 = time=0
x = ceil(enemynear,pos X)

;補正判別
[state 15910]
type = varset
trigger1 = time=0
fvar(1) = 1-(root,var(2)>1)*.4-ifelse(root,var(2)>2,ifelse(root,var(2)>8,.3,(root,var(2)-2)*.05),0)

[state 15910]
type = varset
trigger1 = time=0
var(4) = 0

[state 15910]
type = varset
triggerall = time=0&&roundstate=2
trigger1 = root,var(29)>=100&&(enemynear,name="Honda Tadakatsu"||enemynear,name="Tadakatsu")
trigger2 = root,var(29)>=80&&!(enemynear,name="Honda Tadakatsu"||enemynear,name="Tadakatsu"||enemynear,name="Uesugi Kenshin"||enemynear,name="Kenshin")
trigger3 = root,var(29)>=60&&(enemynear,name="Uesugi Kenshin"||enemynear,name="Kenshin")
var(4) = 1

[state 15910]
type = parentvarset
trigger1 = movehit=1
var(28) = ifelse(P2statetype!=A,180,360)+2

[state 15910]
type = varset
trigger1 = !numtarget&&time>0
var(5) = 1

[state 15910]
type = varset
trigger1 = numtarget && !var(5)
trigger1 = target,stateno=15310
var(5) = 1

[state 200]
type = TargetState
triggerall = roundstate=2 && numtarget && !var(5)
trigger1 = root,var(28)>0 && target,time>0 && (target,stateno=5001||target,stateno=5011) && target,hitover
trigger1 = var(5):=1
value = 15300

[State 200,HitDef]
type = HitDef
triggerall = time=0&&roundstate=2&&P2statetype!=A&&enemynear,gethitvar(yvel)>=0
trigger1 = root,var(29)>=100&&(enemynear,name="Honda Tadakatsu"||enemynear,name="Tadakatsu")
trigger2 = root,var(29)>=80&&!(enemynear,name="Honda Tadakatsu"||enemynear,name="Tadakatsu"||enemynear,name="Uesugi Kenshin"||enemynear,name="Kenshin")
trigger3 = root,var(29)>=60&&(enemynear,name="Uesugi Kenshin"||enemynear,name="Kenshin")
attr = S,NT
getpower = 0,0
givepower = 0,0
hitflag = MAF
priority = 9, Hit
pausetime = 0,enemynear,gethitvar(hitshaketime)
sparkno = -1
guard.sparkno = -1
sparkxy = 0,0
ground.type = None
ground.velocity = -enemynear,gethitvar(xvel)*enemynear,facing
guard.velocity = 0
air.velocity = -enemynear,gethitvar(xvel)*enemynear,facing,enemynear,gethitvar(yvel)
yaccel = .45
air.hittime=13
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
fall.recover=0
air.recover=0
;p2stateno=15300
numhits=0

[State 200,HitDef]
type = HitDef
triggerall = time=0&&roundstate=2&&(P2statetype=A||enemynear,gethitvar(yvel)<0)&&root,var(1)%2<1&&root,var(1)%8<4
trigger1 = root,var(29)>=100&&(enemynear,name="Honda Tadakatsu"||enemynear,name="Tadakatsu")
trigger2 = root,var(29)>=80&&!(enemynear,name="Honda Tadakatsu"||enemynear,name="Tadakatsu"||enemynear,name="Uesugi Kenshin"||enemynear,name="Kenshin")
trigger3 = root,var(29)>=60&&(enemynear,name="Uesugi Kenshin"||enemynear,name="Kenshin")
attr = S,NT
getpower = 0,0
givepower = 0,0
hitflag = MAF
priority = 9, Hit
pausetime = 0,enemynear,gethitvar(hitshaketime)
sparkno = -1
guard.sparkno = -1
sparkxy = 0,0
ground.type = High
ground.velocity = -enemynear,gethitvar(xvel)*enemynear,facing
guard.velocity = 0
air.velocity = -enemynear,gethitvar(xvel)*enemynear,facing,enemynear,gethitvar(yvel)
yaccel = .45
air.hittime=13
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
fall.recover=0
air.recover=0
p2stateno=15310
numhits=0


[State 200,HitDef]
type = HitDef
triggerall = time=0&&roundstate=2&&P2statetype=A&&enemynear,gethitvar(animtype)=4
trigger1 = root,var(29)>=100&&(enemynear,name="Honda Tadakatsu"||enemynear,name="Tadakatsu")
trigger2 = root,var(29)>=80&&!(enemynear,name="Honda Tadakatsu"||enemynear,name="Tadakatsu"||enemynear,name="Uesugi Kenshin"||enemynear,name="Kenshin")
trigger3 = root,var(29)>=60&&(enemynear,name="Uesugi Kenshin"||enemynear,name="Kenshin")
attr = S,NT
getpower = 0,0
givepower = 0,0
hitflag = MAF
priority = 9, Hit
pausetime = 0,enemynear,gethitvar(hitshaketime)
sparkno = -1
guard.sparkno = -1
sparkxy = 0,0
animtype = up
ground.type = High
ground.velocity = -enemynear,gethitvar(xvel)*enemynear,facing
guard.velocity = 0
air.velocity = -enemynear,gethitvar(xvel)*enemynear,facing,enemynear,gethitvar(yvel)
yaccel = .45
air.hittime=13
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
fall.recover=0
air.recover=0
p2stateno=15310
numhits=0

[State 200,HitDef]
type = HitDef
triggerall = time=0&&roundstate=2&&P2statetype=A&&enemynear,gethitvar(animtype)=5
trigger1 = root,var(29)>=100&&(enemynear,name="Honda Tadakatsu"||enemynear,name="Tadakatsu")
trigger2 = root,var(29)>=80&&!(enemynear,name="Honda Tadakatsu"||enemynear,name="Tadakatsu"||enemynear,name="Uesugi Kenshin"||enemynear,name="Kenshin")
trigger3 = root,var(29)>=60&&(enemynear,name="Uesugi Kenshin"||enemynear,name="Kenshin")
attr = S,NT
getpower = 0,0
givepower = 0,0
hitflag = MAF
priority = 9, Hit
pausetime = 0,enemynear,gethitvar(hitshaketime)
sparkno = -1
guard.sparkno = -1
sparkxy = 0,0
animtype = diagup
ground.type = High
ground.velocity = -enemynear,gethitvar(xvel)*enemynear,facing
guard.velocity = 0
air.velocity = -enemynear,gethitvar(xvel)*enemynear,facing,enemynear,gethitvar(yvel)
yaccel = .45
air.hittime=13
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
fall.recover=0
air.recover=0
p2stateno=15310
numhits=0

[state 15910]
type = parentvaradd
trigger1 = time=0&&!var(4)
var(29) = ceil(ifelse(root,numhelper(7580),1.2,1.0)*var(10)*fvar(1)*ifelse(root,var(1)%2>=1,.5,1)*1.0)

[state 15910]
type = ChangeState
triggerall = time&&!(hitdefattr=SCA,AA,AT)&&(prevstateno=[15900,15909])
trigger1 = (var(1)=420&&var(2)<2)||(var(1)=1000&&var(2)<2)
value = 15900

[state 15910]
type = DestroySelf
trigger1 = time>0&&!(var(4)=1&&!var(5))
trigger2 = time>0&&var(5)=1
trigger3 = time>0&&(prevstateno!=[15900,15909])

;---------------------------------------------------------------------------
;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
;吹き飛ばし攻撃ガード時壁吹き飛び用
[statedef 10920]
type = S
movetype=A
physics = S
ctrl = 0
anim = 15910

[State 200,HitDef]
type = HitDef
trigger1 = time=0
attr = S,NT
getpower = 0,0
givepower = 0,0
hitflag = M
priority = 9, Hit
pausetime = 0,0
sparkno = -1
guard.sparkno = -1
sparkxy = 0,0
ground.type = High
ground.velocity = 0
guard.velocity = 0
air.velocity = 0,0
yaccel = .4
air.hittime=13
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
fall.recover=0
air.recover=0
numhits=0
p2stateno=928

[state -2]
type = DestroySelf
trigger1 = Time=1

;溜めエフェクト
[statedef 7770]
type = S
physics =N
movetype = I
velset = 0,0
anim=90000

[state 7990]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[state 7990]
type = ChangeAnim
trigger1 = time=1
value = 7770

[state 7770]
type = PalFX
trigger1 = !time
add = 96,0,64
time = -1

[state 7990]
type = AngleDraw
trigger1 = time
scale = 1.3+(time-1)*.2,.3+(time-1)*.05

[state 7990]
type = Trans
trigger1 = time
trans = addalpha
alpha = 256-(time-1)*23,256

[state 7990]
type = destroyself
trigger1 = Time>=12

;■■■■■■■
;＾＾＾＾＾＾＾＾＾＾＾
;BASARA技発動時背景
[statedef 7560]
ctrl = 0
anim = 90000

[state 8850]
type = AssertSpecial
trigger1 = 1
flag = nokoslow

;発動エフェクト
[state 8000]
type = Helper
trigger1 = time=1
id = 7500
stateno = 7500
pos = 0,0
postype = p1
sprpriority = 100
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1

[state -2]
type = BGPalFX
trigger1 = time=[2,5]
mul = 256-(time-2)*64,256-(time-2)*64,256-(time-2)*64
time=1

[state -2]
type = assertspecial
trigger1 = time>5
flag = noBG
flag2 = noFG

;カットイン
[state 8000]
type = Explod
trigger1 = time=6
id = 6600
anim = 6600
pos = -64,0
postype = back
sprpriority = -9
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.5

;---背景---

;背景(初期中心線)
[state 8000]
type = Explod
trigger1 = time=8
id = 7540
anim = 7540
pos = 0,120
postype = back
sprpriority = -10
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = 10,1

;背景(初期中心線)
[state 8000]
type = Explod
trigger1 = time=8
id = 7541
anim = 7540
pos = 0,119
postype = back
sprpriority = -10
bindtime=-1
vfacing = -1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = 10,1

;背景(矢印)
[state 8000]
type = Explod
trigger1 = time=8
id = 7530
anim = 7530
pos = 0,120
postype = back
sprpriority = -10
bindtime=-1
vfacing = -1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = 2.0,2.0

[state -2]
type = ModifyExplod
trigger1 = NumExplod(7540)
id = 7540
scale = 10,1.0-ifelse(time>=37,(time-36)*1.125,36-time)*.03

[state -2]
type = ModifyExplod
trigger1 = NumExplod(7541)
id = 7541
scale = 10,1.0-ifelse(time>=37,(time-36)*1.125,36-time)*.03

[state -2]
type = ModifyExplod
trigger1 = NumExplod(7530)
id = 7530
scale = 2.0,2.0-(time-8)*.1

[state -2]
type = RemoveExplod
trigger1 = Time=62
id = 7540

[state -2]
type = RemoveExplod
trigger1 = Time=62
id = 7541

[state -2]
type = PalFX
trigger1 = time=[8,16]
add = -256+(time-8)*16,-256+(time-8)*16,-256+(time-8)*16
time=1

[state -2]
type = PalFX
trigger1 = time>=17
add = -128,-128,-128
time = 1

;メイン背景(グラデーション)
[state 8000]
type = Explod
triggerall = time>=8&&!(root,numhelper(7560)>=2)
trigger1 = time=8
id = 7561
anim = 7561
pos = 0,120
postype = Left
sprpriority = -12
bindtime=-1
removetime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = 321,.62

;メイン背景(上部)
[state 8000]
type = Explod
triggerall = time>=8&&!(root,numhelper(7560)>=2)
trigger1 = time=8
trigger2 = time=24;32
trigger3 = time=48;56
trigger4 = 0;time=80
trigger5 = 0;time=104
id = 7560
anim = 7560
pos = 0,-24
postype = back
sprpriority = -11
bindtime=-1
removetime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.6

;メイン背景(下部)
[state 8000]
type = Explod
triggerall = time>=8&&!(root,numhelper(7560)>=2)
trigger1 = time=8
trigger2 = time=24;32
trigger3 = time=48;56
trigger4 = 0;time=80
trigger5 = 0;time=104
id = 7565
anim = 7560
pos = 0,276
postype = back
sprpriority = -11
bindtime=-1
removetime=-1
vfacing = -1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.5

[state -2]
type = RemoveExplod
trigger1 = time>32&&(root,stateno!=[3000,3199])&&(root,var(34)!=[3000,3199])||(root,stateno=3010&&root,time<=1)
trigger1 = !root,numhelper(3107)
trigger2 = time>32&&(root,stateno!=[3000,3199])&&(root,var(34)!=[3000,3199])||(root,stateno=3010&&root,time<=1)
trigger2 = root,numhelper(3107)
trigger2 = helper(3107),time>=100+helper(3107),var(7)
trigger3 = root,movetype=H||Root,WinKO||root,numhelper(7570)||root,numhelper(8800)

[state -2]
type = DestroySelf
trigger1 = time>32&&(root,stateno!=[3000,3199])&&(root,var(34)!=[3000,3199])||(root,stateno=3010&&root,time<=1)
trigger1 = !root,numhelper(3107)
trigger2 = time>32&&(root,stateno!=[3000,3199])&&(root,var(34)!=[3000,3199])||(root,stateno=3010&&root,time<=1)
trigger2 = root,numhelper(3107)
trigger2 = helper(3107),time>=100+helper(3107),var(7)
trigger3 = root,movetype=H||Root,WinKO||root,numhelper(7570)||root,numhelper(8800)

;＾＾＾＾＾＾＾＾＾＾＾
;BASARA技発動時エフェクト
[statedef 7500]
ctrl = 0
anim = 90000
sprpriority = 5

[state 190]
type = StopSND
trigger1 = Time=0
channel = 11

[state 190]
type = PlaySND
trigger1 = Time=0
value = 7500,0
channel = 11

;エフェクト1（小輪）
[state 8000]
type = Explod
trigger1 = time=0
id = 7500
anim = 7500
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = const(size.xscale)*2.0,const(size.yscale)*2.0

;エフェクト1（小輪）拡大
[state 8000]
type = ModifyExplod
trigger1 = time
id = 7500
scale = const(size.xscale)*(4.0+(time-1)*.0125),const(size.yscale)*(4.0+(time-1)*.0125)

;エフェクト2（輝き）
[state 8000]
type = Explod
trigger1 = time=0
id = 7501
anim = 7501
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = const(size.xscale),const(size.yscale)

;エフェクト2（輝き）拡大
[state 8000]
type = ModifyExplod
trigger1 = time
id = 7501
scale = const(size.xscale)*(1.0+time*.1),const(size.yscale)*(1.0+time*.1)

;エフェクト3（輪）
[state 8000]
type = Explod
trigger1 = time=0
id = 7502
anim = 7502
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = const(size.xscale)*1.0,const(size.yscale)*.05

;エフェクト3（輪）楕円型拡大
[state 8000]
type = ModifyExplod
trigger1 = time
id = 7502
scale = const(size.xscale)*(2.0+time*.6)*.5,const(size.yscale)*(.1+time*.03)*.5

;エフェクト4-1-1（細線）
[state 8000]
type = Explod
trigger1 = time=0
id = 7505
anim = 7505
pos = ceil(80*const(size.xscale)),ceil(0*const(size.xscale))
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = const(size.xscale)*.2,const(size.yscale)*1.0

;エフェクト4-1-1（細線）拡大
[state 8000]
type = ModifyExplod
trigger1 = time
id = 7505
pos = ceil(90*const(size.xscale)),ceil(0*const(size.xscale))
scale = const(size.xscale)*(.2+time*.3)*.5,const(size.yscale)*.5

;エフェクト4-1-2（細線）
[state 8000]
type = Explod
trigger1 = time=0
id = 7506
anim = 7505
pos = -ceil(80*const(size.xscale)),ceil(0*const(size.xscale))
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = const(size.xscale)*.2,const(size.yscale)*1.0

;エフェクト4-1-2（細線）拡大
[state 8000]
type = ModifyExplod
trigger1 = time
id = 7506
pos = -ceil(90*const(size.xscale)),ceil(0*const(size.xscale))
scale = const(size.xscale)*(.2+time*.3)*.5,const(size.yscale)*.5

;エフェクト4-2-1（細線）
[state 8000]
type = Helper
trigger1 = time=0
id = 7501
stateno = 7501
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1

;エフェクト4-2-2（細線）
[state 8000]
type = Helper
trigger1 = time=0
id = 7502
stateno = 7502
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1

;エフェクト4-3-1（細線）
[state 8000]
type = Helper
trigger1 = time=0
id = 7503
stateno = 7503
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1

;エフェクト4-3-2（細線）
[state 8000]
type = Helper
trigger1 = time=0
id = 7504
stateno = 7504
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1

;エフェクト4-4-1（細線）
[state 8000]
type = Helper
trigger1 = time=0
id = 7505
stateno = 7505
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1

;エフェクト4-4-2（細線）
[state 8000]
type = Helper
trigger1 = time=0
id = 7506
stateno = 7506
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1

;エフェクト5（光円）
[state 8000]
type = Explod
trigger1 = time=0
id = 7510
anim = 7510
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = const(size.xscale)*.75,const(size.yscale)*.75

;エフェクト5（光円）拡大
[state 8000]
type = ModifyExplod
trigger1 = time
id = 7510
scale = const(size.xscale)*(.75+(time-1)*.1),const(size.yscale)*(.75+(time-1)*.1)

;エフェクト6-1（二つ筋１）
[state 8000]
type = Helper
trigger1 = time=2
id = 7515
stateno = 7515
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1

;エフェクト6-2（二つ筋２）
[state 8000]
type = Helper
trigger1 = time=4
id = 7516
stateno = 7516
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1

;エフェクト6-3（二つ筋３）
[state 8000]
type = Helper
trigger1 = time=6
id = 7517
stateno = 7517
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1

;エフェクト7（青円）
[state 8000]
type = Explod
trigger1 = time=0
id = 7520
anim = 7520
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = const(size.xscale)*.75,const(size.yscale)*.025

;エフェクト7（青円）楕円型拡大
[state 8000]
type = ModifyExplod
trigger1 = time
id = 7520
scale = const(size.xscale)*(1.5+time*.2)*.5,const(size.yscale)*(.05+time*.01)*.5

;エフェクト8-1（ギザギザ円形１）
[state 8000]
type = Helper
trigger1 = time=0
id = 7525
stateno = 7525
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1

;エフェクト8-2（ギザギザ円形２）
[state 8000]
type = Helper
trigger1 = time=4
id = 7526
stateno = 7526
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1

[state 7505]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[state 7505]
type = DestroySelf
trigger1 = Time>=44

;＾＾＾＾＾＾＾＾＾＾＾
;BASARA技発動時エフェクト4-2-1（細線）
[statedef 7501]
ctrl = 0
anim = 7505
sprpriority = 5

[state 7505]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[state 7505]
type = Turn
trigger1 = 0;!time

[state 7505]
type = PosAdd
trigger1 = !time
x = -ceil(80*const(size.xscale))
y = ceil(80*const(size.yscale))

[state 7505]
type = PosAdd
trigger1 = time=1
x = -ceil(10*const(size.xscale))
y = ceil(10*const(size.yscale))

[state 7505]
type = Trans
trigger1 = !time
trans = AddAlpha
alpha = 128,256

[state 7505]
type = Trans
trigger1 = time>=1
trans = AddAlpha
alpha = 256-((time-1)*17),256

[state 7505]
type = AngleDraw
trigger1 = 1
value = 225
scale = const(size.xscale)*(.2+time*.3)*1.0,const(size.yscale)*1.5

[state 7505]
type = DestroySelf
trigger1 = AnimTime=0

;＾＾＾＾＾＾＾＾＾＾＾
;BASARA技発動時エフェクト4-2-2（細線）
[statedef 7502]
ctrl = 0
anim = 7505
sprpriority = 5

[state 7505]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[state 7505]
type = PosAdd
trigger1 = !time
x = ceil(80*const(size.xscale))
y = -ceil(80*const(size.yscale))

[state 7505]
type = PosAdd
trigger1 = time=1
x = ceil(10*const(size.xscale))
y = -ceil(10*const(size.yscale))

[state 7505]
type = Trans
trigger1 = !time
trans = AddAlpha
alpha = 128,256

[state 7505]
type = Trans
trigger1 = time>=1
trans = AddAlpha
alpha = 256-((time-1)*17),256

[state 7505]
type = AngleDraw
trigger1 = 1
value = 45
scale = const(size.xscale)*(.2+time*.3)*1.0,const(size.yscale)*1.5

[state 7505]
type = DestroySelf
trigger1 = Time>=14

;＾＾＾＾＾＾＾＾＾＾＾
;BASARA技発動時エフェクト4-3-1（細線）
[statedef 7503]
ctrl = 0
anim = 7505
sprpriority = 5

[state 7505]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[state 7505]
type = PosAdd
trigger1 = !time
x = ceil(80*const(size.xscale))
y = ceil(80*const(size.yscale))

[state 7505]
type = PosAdd
trigger1 = time=1
x = ceil(10*const(size.xscale))
y = ceil(10*const(size.yscale))

[state 7505]
type = Trans
trigger1 = !time
trans = AddAlpha
alpha = 128,256

[state 7505]
type = Trans
trigger1 = time>=1
trans = AddAlpha
alpha = 256-((time-1)*17),256

[state 7505]
type = AngleDraw
trigger1 = 1
value = -45
scale = const(size.xscale)*(.2+time*.3)*1.0,const(size.yscale)*1.5

[state 7505]
type = DestroySelf
trigger1 = Time>=14

;＾＾＾＾＾＾＾＾＾＾＾
;BASARA技発動時エフェクト4-2-2（細線）
[statedef 7504]
ctrl = 0
anim = 7505
sprpriority = 5

[state 7505]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[state 7505]
type = PosAdd
trigger1 = !time
x = -ceil(80*const(size.xscale))
y = -ceil(80*const(size.yscale))

[state 7505]
type = PosAdd
trigger1 = time=1
x = -ceil(10*const(size.xscale))
y = -ceil(10*const(size.yscale))

[state 7505]
type = Trans
trigger1 = !time
trans = AddAlpha
alpha = 128,256

[state 7505]
type = Trans
trigger1 = time>=1
trans = AddAlpha
alpha = 256-((time-1)*17),256

[state 7505]
type = AngleDraw
trigger1 = 1
value = -225
scale = const(size.xscale)*(.2+time*.3)*1.0,const(size.yscale)*1.5

[state 7505]
type = DestroySelf
trigger1 = Time>=14

;＾＾＾＾＾＾＾＾＾＾＾
;BASARA技発動時エフェクト4-4-1（細線）
[statedef 7505]
ctrl = 0
anim = 7505
sprpriority = 5

[state 7505]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[state 7505]
type = PosAdd
trigger1 = !time
x = ceil(0*const(size.xscale))
y = -ceil(100*const(size.yscale))

[state 7505]
type = PosAdd
trigger1 = time=1
x = ceil(0*const(size.xscale))
y = -ceil(20*const(size.yscale))

[state 7505]
type = Trans
trigger1 = !time
trans = AddAlpha
alpha = 128,256

[state 7505]
type = Trans
trigger1 = time>=1
trans = AddAlpha
alpha = 256-((time-1)*17),256

[state 7505]
type = AngleDraw
trigger1 = 1
value = 90
scale = const(size.xscale)*(.2+time*.3)*1.0,const(size.yscale)*1.5

[state 7505]
type = DestroySelf
trigger1 = Time>=14

;＾＾＾＾＾＾＾＾＾＾＾
;BASARA技発動時エフェクト4-4-2（細線）
[statedef 7506]
ctrl = 0
anim = 7505
sprpriority = 5

[state 7505]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[state 7505]
type = PosAdd
trigger1 = !time
x = ceil(0*const(size.xscale))
y = ceil(100*const(size.yscale))

[state 7505]
type = PosAdd
trigger1 = time=1
x = ceil(0*const(size.xscale))
y = ceil(20*const(size.yscale))

[state 7505]
type = Trans
trigger1 = !time
trans = AddAlpha
alpha = 128,256

[state 7505]
type = Trans
trigger1 = time>=1
trans = AddAlpha
alpha = 256-((time-1)*17),256

[state 7505]
type = AngleDraw
trigger1 = 1
value = -90
scale = const(size.xscale)*(.2+time*.3)*1.0,const(size.yscale)*1.5

[state 7505]
type = DestroySelf
trigger1 = Time>=14

;＾＾＾＾＾＾＾＾＾＾＾
;BASARA技発動時エフェクト6-1（二つ筋１）
[statedef 7515]
ctrl = 0
anim = 7515
sprpriority = 5

[state 7505]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[state 7505]
type = Trans
trigger1 = time<=1
trans = addalpha
alpha = 85*(time+1),256

[state 7505]
type = Trans
trigger1 = time>1
trans = addalpha
alpha = 256-(time-2)*7,256

[state 7505]
type = AngleDraw
trigger1 = 1
value = 135+time*1.73076
scale = 1.25+(time)*.25,1.54-(time)*.04

[state 7505]
type = DestroySelf
trigger1 = Time>=38

;＾＾＾＾＾＾＾＾＾＾＾
;BASARA技発動時エフェクト6-2（二つ筋２）
[statedef 7516]
ctrl = 0
anim = 7515
sprpriority = 5

[state 7505]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[state 7505]
type = Trans
trigger1 = time<=1
trans = addalpha
alpha = 85*(time+1),256

[state 7505]
type = Trans
trigger1 = time>1
trans = addalpha
alpha = 256-(time-2)*7,256

[state 7505]
type = AngleDraw
trigger1 = 1
value = 30
scale = 1.25+(time)*.25,1.54-(time)*.04

[state 7505]
type = DestroySelf
trigger1 = Time>=38

;＾＾＾＾＾＾＾＾＾＾＾
;BASARA技発動時エフェクト6-3（二つ筋３）
[statedef 7517]
ctrl = 0
anim = 7515
sprpriority = 5

[state 7505]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[state 7505]
type = Trans
trigger1 = time<=1
trans = addalpha
alpha = 85*(time+1),256

[state 7505]
type = Trans
trigger1 = time>1
trans = addalpha
alpha = 256-(time-2)*7,256

[state 7505]
type = AngleDraw
trigger1 = 1
value = 280-time*1.73076
scale = 1.25+(time)*.25,1.54-(time)*.04

[state 7505]
type = DestroySelf
trigger1 = Time>=38

;＾＾＾＾＾＾＾＾＾＾＾
;BASARA技発動時エフェクト8-1（ギザギザ円１）
[statedef 7525]
ctrl = 0
anim = 7525
sprpriority = 5

[state 7505]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[state 7505]
type = Trans
trigger1 = 1
trans = addalpha
alpha = 256-time*25,256

[state 7505]
type = AngleDraw
trigger1 = !time
value = -40
scale = 1.0,1.5

[state 7505]
type = AngleDraw
trigger1 = time
value = -40
scale = 1.25+(time-1)*.075,2.0+(time-1)*.075

[state 7505]
type = DestroySelf
trigger1 = Time>=9

;＾＾＾＾＾＾＾＾＾＾＾
;BASARA技発動時エフェクト8-2（ギザギザ円２）
[statedef 7526]
ctrl = 0
anim = 7525
sprpriority = 5

[state 7505]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[state 7505]
type = Trans
trigger1 = 1
trans = addalpha
alpha = 256-time*25,256

[state 7505]
type = AngleDraw
trigger1 = !time
value = 70
scale = .625,1.5

[state 7505]
type = AngleDraw
trigger1 = time
value = 70
scale = .8+(time-1)*.075,2.0+(time-1)*.075

[state 7505]
type = DestroySelf
trigger1 = Time>=9

;■■■■■■■
;＾＾＾＾＾＾＾＾＾＾＾
;援軍アシスト発動時背景
[statedef 7570]
ctrl = 0
anim = 90000

[state -2]
type = assertspecial
trigger1 = 1
flag = noBG
flag2 = noFG

;援軍カットイン
[state 8000]
type = Explod
trigger1 = time=0
id = 6601
anim = 6601+(parent,stateno=21070)*2+(parent,stateno=22070)*4
pos = 80,30;+(facing=-1)*320,240
postype = back
sprpriority = -5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.5

;エフェクト
[state 8000]
type = Helper
trigger1 = time=1
id = 7500
stateno = 7500
pos = 0,0
postype = p1
sprpriority = 5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1

;Assist
[state 8000]
type = Explod
trigger1 = time=0
id = 8750
anim = 8750
pos = 0+(facing=-1)*160,90
postype = back
sprpriority = -5
bindtime=-1
facing=facing
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.5

;Assist背景
[state 8000]
type = Explod
trigger1 = time=0
id = 8751
anim = 8751
pos = 0,60
postype = back
sprpriority = -5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.5

;-----BG---
[state -2]
type = PalFX
trigger1 = time=[8,16]
add = -256+(time-8)*16,-256+(time-8)*16,-256+(time-8)*16
time=1

[state -2]
type = PalFX
trigger1 = time>=17
add = -128,-128,-128
time = 1

;メイン背景(グラデーション)
[state 8000]
type = Explod
triggerall = time>=8&&!(root,numhelper(7560)>=2)
trigger1 = time=8
id = 7561
anim = 7571
pos = 0,120
postype = Left
sprpriority = -12
bindtime=-1
removetime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = 321,.62

;メイン背景(グラデーション)
[state 8000]
type = Explod
triggerall = time>=8&&!(root,numhelper(7560)>=2)
trigger1 = time=8
id = 7561
anim = 7572
pos = 0,120
postype = Left
sprpriority = -12
bindtime=-1
removetime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = 321,.62

;メイン背景(上部)
[state 8000]
type = Explod
triggerall = time>=8&&!(root,numhelper(7560)>=2)
trigger1 = time=8
trigger2 = time=24;32
trigger3 = time=48;56
trigger4 = 0;time=80
trigger5 = 0;time=104
id = 7560
anim = 7570
pos = 0,-24
postype = back
sprpriority = -11
bindtime=-1
removetime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.6

;メイン背景(下部)
[state 8000]
type = Explod
triggerall = time>=8&&!(root,numhelper(7560)>=2)
trigger1 = time=8
trigger2 = time=24;32
trigger3 = time=48;56
trigger4 = 0;time=80
trigger5 = 0;time=104
id = 7565
anim = 7570
pos = 0,276
postype = back
sprpriority = -11
bindtime=-1
removetime=-1
vfacing = -1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.5

[state -2]
type = RemoveExplod
trigger1 = time>50&&(parent,stateno%100!=70)
trigger2 = root,numhelper(8800)

[state -2]
type = DestroySelf
trigger1 = time>50&&(parent,stateno%100!=70)
trigger2 = root,numhelper(8800)

;■■■■■■■
;＾＾＾＾＾＾＾＾＾＾＾
;援軍カウンター発動時背景
[statedef 7565]
ctrl = 0
anim = 90000

;カットイン
[state 8000]
type = Explod
trigger1 = time=0
id = 6601
anim = 6601+(parent,stateno=21009)*2+(parent,stateno=22009)*4
pos = 80,30;+(facing=-1)*320,240
postype = back
sprpriority = -5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.5

;背景
[state 8000]
type = Explod
trigger1 = time=0
id = 8751
anim = 8751
pos = 0,60
postype = back
sprpriority = -5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.5

[state -2]
type = RemoveExplod
trigger1 = Time=(38+ifelse(root,var(57)>=5,40,ifelse(root,var(57)=4,33,ifelse(root,var(57)=3,22,ifelse(root,var(57)=2,12,0)))))

[state -2]
type = RemoveExplod
trigger1 = time>(38+ifelse(root,var(57)>=5,40,ifelse(root,var(57)=4,33,ifelse(root,var(57)=3,22,ifelse(root,var(57)=2,12,0)))))

[state -2]
type = DestroySelf
trigger1 = time>(38+ifelse(root,var(57)>=5,40,ifelse(root,var(57)=4,33,ifelse(root,var(57)=3,22,ifelse(root,var(57)=2,12,0)))))

;■■■■■■■
;＾＾＾＾＾＾＾＾＾＾＾
;一撃BASARA技発動時背景
[statedef 7580]
ctrl = 0
anim = 90000

[state 8850]
type = AssertSpecial
trigger1 = 1
flag = nokoslow

[state 190]
type = PlaySND
trigger1 = !Time
value = 7500,1

[state -2]
type = BGPalFX
trigger1 = time<=3
mul = 256-(time)*64,256-(time)*64,256-(time)*64
time=1

[state -2]
type = assertspecial
trigger1 = time>3
flag = noBG
flag2 = noFG

[state -2]
type = PalFX
trigger1 = time<=8
add = -256+(time-4)*64,-256+(time-4)*64,-256+(time-4)*64
time=1

;家紋
[state 8000]
type = Helper
trigger1 = !time
id = 7590
stateno = 7590
pos = 0,0
postype = p1
sprpriority = -5
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1

;背景1-1-1
[state 8000]
type = Explod
trigger1 = time=4
id = 7580
anim = 7580
pos = 0,0
postype = back
sprpriority = -11
bindtime=-1
removetime=-1
ownpal = 0
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.5

;背景1-1-2
[state 8000]
type = Explod
trigger1 = time=4
id = 7580
anim = 7580
pos = 320,0
postype = back
sprpriority = -11
bindtime=-1
removetime=-1
ownpal = 0
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.5

;背景1-2-1
[state 8000]
type = Explod
trigger1 = time=4
id = 7581
anim = 7581
pos = 0,0
postype = back
sprpriority = -11
bindtime=-1
removetime=-1
ownpal = 0
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.5

;背景1-2-2
[state 8000]
type = Explod
trigger1 = time=4
id = 7581
anim = 7581
pos = 320,0
postype = back
sprpriority = -11
bindtime=-1
removetime=-1
ownpal = 0
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.5

;背景1-3-1
[state 8000]
type = null;Explod
trigger1 = time=4
id = 7585
anim = 7585
pos = 320,66
postype = back
sprpriority = -10
bindtime=-1
removetime=-1
ownpal = 0
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.5

;背景1-3-2
[state 8000]
type = null;Explod
trigger1 = time=4
id = 7586
anim = 7586
pos = 240,66
postype = back
sprpriority = -10
bindtime=-1
removetime=-1
ownpal = 0
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.5

;背景1-3-3
[state 8000]
type = null;Explod
trigger1 = time=4
id = 7587
anim = 7587
pos = 120,66
postype = back
sprpriority = -10
bindtime=-1
removetime=-1
ownpal = 0
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.5

;背景1-3-4
[state 8000]
type = null;Explod
trigger1 = time=4
id = 7588
anim = 7588
pos = 0,66
postype = back
sprpriority = -10
bindtime=-1
removetime=-1
ownpal = 0
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .5,.5

;背景2-1-1
[state 8000]
type = Explod
trigger1 = time=4
id = 7580
anim = 7580
pos = 0,300
postype = back
sprpriority = -10
bindtime=-1
removetime=-1
ownpal = 0
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
vfacing = -1
scale = .5,.5

;背景2-1-2
[state 8000]
type = Explod
trigger1 = time=4
id = 7580
anim = 7580
pos = 320,300
postype = back
sprpriority = -10
bindtime=-1
removetime=-1
ownpal = 0
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
vfacing = -1
scale = .5,.5

;背景2-2-1
[state 8000]
type = Explod
trigger1 = time=4
id = 7581
anim = 7581
pos = 0,300
postype = back
sprpriority = -10
bindtime=-1
removetime=-1
ownpal = 0
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
vfacing = -1
scale = .5,.5

;背景2-2-2
[state 8000]
type = Explod
trigger1 = time=4
id = 7581
anim = 7581
pos = 320,300
postype = back
sprpriority = -10
bindtime=-1
removetime=-1
ownpal = 0
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
vfacing = -1
scale = .5,.5

[state -2]
type = RemoveExplod
trigger1 = (time>50&&(root,stateno!=[3500,3510]))||root,numhelper(8850)
trigger2 = root,movetype=H||Root,WinKO

[state -2]
type = DestroySelf
trigger1 = (time>50&&(root,stateno!=[3500,3510]))||root,numhelper(8850)
trigger2 = root,movetype=H||Root,WinKO

;一撃BASARA技発動時家紋
[statedef 7590]
ctrl = 0
anim = 90000

;紋章
[state 8000]
type = Explod
trigger1 = !time
id = 7590
anim = 7590
pos = 160,120
postype = back
sprpriority = -9
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = .25,.25
pausemovetime=999

;円
[state 8000]
type = Explod
trigger1 = !time
id = 7510
anim = 7510
pos = 160,120
postype = back
sprpriority = -9
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
scale = 1,1
pausemovetime=999

;輪
[state 8000]
type = Explod
trigger1 = !time
id = 8830
anim = 8830
pos = 160,120
postype = back
sprpriority = -9
bindtime=-1
ownpal = 1
pausemovetime=9999
supermovetime=9999
ignorehitpause = 1
removetime=20
scale = .5,.5
pausemovetime=999

[state 8840]
type = ModifyExplod
trigger1 = time
id = 7590
scale = .25+time*.025,.25+time*.025

[state 8840]
type = ModifyExplod
trigger1 = time
id = 8830
scale = .5+time*.02,.5+time*.02

[state 8840]
type = DestroySelf
trigger1 = time>20

;=====援軍ゲージ
[statedef 8100]
ctrl = 0
anim = 90000

;var(15):MAX判別
;var(43):援軍レベル変化

[state 8100]
type = RemoveExplod
trigger1 = root,var(41)!=var(41)||root,var(42)!=var(42)
trigger2 = !NumExplod(8125)&&root,var(40)=1&&!var(15)&&root,var(42)>=root,var(41)&&roundstate=2&&!root,numexplod(40000)
trigger3 = root,var(40)=-10
trigger4 = numhelper(20000)
trigger4 = helper(20000),stateno%10000%1000=[80,90]
trigger5 = root,var(12)!=var(17)&&root,var(12)>=0

[state 8900]
type = varset
trigger1 = 1
var(17) = root,var(12)

;メッセージ
;~~^到着~~~
[state 8100]
type = Explod
trigger1 = !NumExplod(8140)&&root,var(40)=-900
id = 8140
anim = 8140
pos = 15+ifelse(teamside=2,45,0)+floor(root,fvar(19)),63-14+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

[state 8100]
type = ModifyExplod
trigger1 = 1
id = 8140
scale = .5,.5

[state 8100]
type = RemoveExplod
trigger1 = root,var(40)!=-900
id = 8140

;~~^援軍ブロック~~~
[state 8100]
type = Explod
trigger1 = !NumExplod(8180)&&numhelper(20000)
trigger1 = helper(20000),stateno=13600
id = 8180
anim = 8180
pos = 15+ifelse(teamside=2,45,0)+floor(root,fvar(19)),63-12+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

[state 8100]
type = RemoveExplod
trigger1 = !numhelper(20000)
id = 8180

[state 8100]
type = ModifyExplod
trigger1 = numhelper(20000)
id = 8180
scale = (helper(20000),stateno=13600&&helper(20000),animelemtime(3)<0)*.5,(helper(20000),stateno=13600&&helper(20000),animelemtime(3)<0)*.5

;~~^援軍カウンター~~~
[state 8100]
type = Explod
trigger1 = !NumExplod(8181)&&numhelper(20000)
trigger1 = helper(20000),stateno%10000%1000=80
id = 8181
anim = 8181
pos = 15+ifelse(teamside=2,45,0)+floor(root,fvar(19)),63-12+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

[state 8100]
type = RemoveExplod
trigger1 = !numhelper(20000)
id = 8181

[state 8100]
type = ModifyExplod
trigger1 = numhelper(20000)
id = 8181
scale = (helper(20000),stateno%10000%1000=80&&helper(20000),animelemtime(3)<0)*.5,(helper(20000),stateno%10000%1000=80&&helper(20000),animelemtime(3)<0)*.5

;~~^援軍行動可能~~~
[state 8100]
type = Explod
trigger1 = !NumExplod(8182)&&!NumExplod(8125)&&root,var(40)=1&&!var(15)&&root,var(42)>=root,var(41)&&roundstate=2&&!root,numexplod(40000)
id = 8182
anim = 8182
pos = 15+ifelse(teamside=2,23,22)+floor(root,fvar(19)),63-12+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

[state 8100]
type = ModifyExplod
trigger1 = 1
id = 8182
pos = ifelse(var(15)>=48,15,0)+15+ifelse(teamside=2,23,22)+floor(root,fvar(19)),63-12+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
scale = (var(15)>=60)*.5+ifelse(var(15)>=104,var(15)-104,0)*.04,(var(15)>=60)*.5

[state 8100]
type = Explod
trigger1 = !NumExplod(8470)&&!NumExplod(8125)&&root,var(40)=1&&!var(15)&&root,var(42)>=root,var(41)&&roundstate=2&&!root,numexplod(40000)
id = 8470
anim = 8470
pos = 15+ifelse(teamside=2,30,15)+floor(root,fvar(19)),71-12+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

[state 8100]
type = ModifyExplod
trigger1 = 1
id = 8470
scale = (var(15)>=104)*.25+ifelse(var(15)>=104,var(15)-104,0)*.021,(var(15)>=104)*.5

[state 8100]
type = Explod
trigger1 = !NumExplod(8472)&&!NumExplod(8125)&&root,var(40)=1&&!var(15)&&root,var(42)>=root,var(41)&&roundstate=2&&!root,numexplod(40000)
id = 8472
anim = 8472
pos = 15+ifelse(teamside=2,25,20)+floor(root,fvar(19)),71-12+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

[state 8100]
type = ModifyExplod
trigger1 = 1
id = 8472
scale = (var(15)>=104)*.25+ifelse(var(15)>=104,var(15)-104,0)*.021,(var(15)>=104)*.25+ifelse(var(15)>=104,var(15)-104,0)*.021

;~~^援軍要請可能~~~
[state 8100]
type = Explod
trigger1 = !NumExplod(8183)&&root,var(40)=0
id = 8183
anim = 8183
pos = 15+ifelse(teamside=2,45,0)+floor(root,fvar(19)),63-12+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

[state 8100]
type = RemoveExplod
trigger1 = root,var(40)!=0
id = 8143

[state 8100]
type = ModifyExplod
trigger1 = 1
id = 8183
scale = (root,var(40)=0&&roundstate=2&&!root,numexplod(40000)&&root,alive)*.5,(root,var(40)=0&&roundstate=2&&!root,numexplod(40000)&&root,alive)*.5

[state 8100]
type = ModifyExplod
trigger1 = ((root,stateno=3000&&root,AnimElemTime(1)>=1&&root,AnimElemTime(1)<31&&root,Anim=3000)||(root,stateno=3100&&root,Anim=3100&&root,AnimElemTime(2)>=0&&root,AnimElemTime(2)<30))&&!root,var(40)
trigger2 = ((root,stateno=3010&&root,AnimElemTime(3)>=0&&root,AnimElemTime(3)<30&&root,Anim=3010)||(root,stateno=3500&&root,AnimElemTime(4)>=0&&root,AnimElemTime(7)<=0))&&!root,var(40)
id = 8183
scale = 0,0

;~~^援軍移動中~~~
[state 8100]
type = Explod
trigger1 = !NumExplod(8184)&&(root,var(40)=[-899,-10])
id = 8184
anim = 8184
pos = 15+ifelse(teamside=2,45,0)+floor(root,fvar(19)),63-12+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

[state 8100]
type = RemoveExplod
trigger1 = root,var(40)!=0&&root,var(40)!=[-899,-10]
id = 8144

[state 8100]
type = ModifyExplod
trigger1 = 1
id = 8184
scale = (root,var(40)=[-899,-10])*.5,(root,var(40)=[-899,-10])*.5

;~~援軍行動不能マーク
[state 8900]
type = Explod
trigger1 = !NumExplod(8120)
id = 8120
anim = 8120
pos = ifelse(teamside=2,60,15)+floor(root,fvar(19)),63+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing = ifelse(teamside=2,-1,1)

[state 8900]
type = ModifyExplod
triggerall = NumExplod(8120)
trigger1 = !(((root,var(40)=[3,4])||(((roundstate=2&&!root,numexplod(40000)&&root,var(40)>10)||root,var(42)<root,var(41))&&root,var(40)>=10)||root,var(40)<0||(root,statetype=L&&(root,anim=[5110,5129])&&root,var(40)))&&(root,var(40)!=[-999,-10]))
trigger1 = !(((Power<1000&&root,movetype=H&&(root,stateno!=[150,155]))||root,stateno=2500)&&(root,var(40)!=[-999,-10])&&root,var(40)!=0)
trigger1 = !(((root,stateno=3000&&root,AnimElemTime(1)>=1&&root,AnimElemTime(1)<31&&root,Anim=3000)||(root,stateno=3100&&root,Anim=3100&&root,AnimElemTime(2)>=0&&root,AnimElemTime(2)<30))&&!root,var(40))
trigger1 = !(((root,stateno=3010&&root,AnimElemTime(3)>=0&&root,AnimElemTime(3)<30&&root,Anim=3010)||(root,stateno=3500&&root,AnimElemTime(4)>=0&&root,AnimElemTime(7)<=0))&&!root,var(40))
trigger1 = !(enemynear,name="Oichi"&&enemynear,authorname="rei"&&enemynear,numexplod(6793))
trigger1 = !(enemynear,name="Mouri Motonari"&&enemynear,authorname="Neat Unsou"&&enemynear,var(29))
trigger2 = (root,var(40)=[-899,-10])||((roundstate=2&&!root,numexplod(40000))&&!root,var(40))
id = 8120
scale = 0,0

[state 8900]
type = ModifyExplod
triggerall = NumExplod(8120)
trigger1 = ((root,var(40)=[3,4])||(((roundstate=2&&!root,numexplod(40000)&&root,var(40)>10)||root,var(42)<root,var(41))&&root,var(40)>=10)||root,var(40)<0||(root,statetype=L&&(root,anim=[5110,5129])&&root,var(40)))&&(root,var(40)!=[-999,-10])
trigger2 = ((Power<1000&&root,movetype=H&&(root,stateno!=[150,155]))||root,stateno=2500)&&(root,var(40)!=[-999,-10])&&root,var(40)!=0
trigger3 = !(roundstate=2&&!root,numexplod(40000))&&!root,var(40)
trigger4 = ((root,stateno=3000&&root,AnimElemTime(1)>=1&&root,AnimElemTime(1)<31&&root,Anim=3000)||(root,stateno=3100&&root,Anim=3100&&root,AnimElemTime(2)>=0&&root,AnimElemTime(2)<30))&&!root,var(40)
trigger5 = ((root,stateno=3010&&root,AnimElemTime(3)>=0&&root,AnimElemTime(3)<30&&root,Anim=3010)||(root,stateno=3500&&root,AnimElemTime(4)>=0&&root,AnimElemTime(7)<=0))&&!root,var(40)
id = 8120
scale = .5,.5

[state 8900]
type = ModifyExplod
triggerall = NumExplod(8120)
trigger1 = enemynear,name="Oichi"&&enemynear,authorname="rei"&&enemynear,numexplod(6793)
trigger2 = enemynear,name="Mouri Motonari"&&enemynear,authorname="Neat Unsou"&&enemynear,var(29)
id = 8120
scale = .5,.5

[state 8900]
type = VarSet
trigger1 = 1
var(5) = (NumExplod(8120)&&((root,var(40)=[3,4])||(((roundstate=2&&!root,numexplod(40000)&&root,var(40)>10)||root,var(42)<root,var(41))&&root,var(40)>=10)||root,var(40)<0)&&(root,var(40)!=[-999,-10]))

[state 8900]
type = VarSet
trigger1 = 1
var(5) = (NumExplod(8120)&&(!(roundstate=2&&!root,numexplod(40000))&&!root,var(40)))

[state 8900]
type = varset
trigger1 = (root,var(40)=[-899,-10])||((roundstate=2&&!root,numexplod(40000))&&!root,var(40))
var(5) = 0

[state 8900]
type = VarSet
trigger1 = NumExplod(8120)&&(((Power<1000&&root,movetype=H&&(root,stateno!=[150,155]))||root,stateno=2500)&&(root,var(40)!=[-999,-10])&&root,var(40)!=0)
trigger2 = (root,statetype=L&&(root,anim=[5110,5129])&&root,var(40)&&(root,var(40)!=[-999,-10]))
var(5) = 1

;メッセージ
;~~^MAX~~~
[state 8100]
type = Explod
trigger1 = !NumExplod(8125)&&root,var(40)=1&&!var(15)&&root,var(42)>=root,var(41)&&roundstate=2&&!root,numexplod(40000)
id = 8125
anim = 8125
pos = 15+21+floor(root,fvar(19)),63-0+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

[state 8100]
type = Explod
trigger1 = !NumExplod(8471)&&root,var(40)=1&&!var(15)&&root,var(42)>=root,var(41)&&roundstate=2&&!root,numexplod(40000)
id = 8471
anim = 8471
pos = 8+21+floor(root,fvar(19)),-3+63-0+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
scale = .25,.25
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=ifelse(teamside=2,-facing,facing)

[state 8900]
type = Explod
trigger1 = !NumExplod(8460)&&root,var(40)=1&&!var(15)&&root,var(42)>=root,var(41)&&roundstate=2&&!root,numexplod(40000)
id = 8460
anim = 8460
pos = -7+21+floor(root,fvar(19)),4+61+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999

[state 8900]
type = Explod
trigger1 = !NumExplod(8461)&&root,var(40)=1&&!var(15)&&root,var(42)>=root,var(41)&&roundstate=2&&!root,numexplod(40000)
id = 8461
anim = 8461
pos = -7+21+floor(root,fvar(19)),3+61+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999

[state 8100]
type = VarSet
trigger1 = (root,var(42)<root,var(41)||root,var(40)=-900)&&roundstate=2&&!root,numexplod(40000)
var(15) = 0

[state 8100]
type = VarAdd
trigger1 = var(15)>0&&roundstate=2&&!root,numexplod(40000)
var(15) = 1

[state 8100]
type = VarSet
trigger1 = root,var(40)!=1&&root,var(40)!=10&&root,var(40)!=-900&&roundstate=2&&!root,numexplod(40000)
trigger2 = var(15)>=120
var(15) = -1

[state 8100]
type = VarSet
trigger1 = root,var(40)=1&&!var(15)&&root,var(42)>=root,var(41)
var(15) = 1

[state 8100]
type = ModifyExplod
trigger1 = 1
id = 8471
scale = .25+var(15)*.0157,.25+var(15)*.0157

;~~Lv.

[state 8100]
type = RemoveExplod
trigger1 = floor(var(43)/1000)!=floor(root,var(43)/1000)
id = 8400

[state 8100]
type = RemoveExplod
trigger1 = floor(var(43)/1000)!=floor(root,var(43)/1000)
id = 8401

[state 8100]
type = RemoveExplod
trigger1 = var(43)<50000&&root,var(43)>=50000
trigger2 = var(43)>=50000&&root,var(43)<50000
id = 8410

;要請時、Lv.50、Lv.100時点灯~~
;1桁目
[state 8900]
type = Explod
trigger1 = !NumExplod(8450)&&(root,var(40)=-10||(root,var(40)>=0&&floor(var(43)/1000)!=floor(root,var(43)/1000)&&floor(root,var(43)/1000)=50))&&floor(root,var(43)/1000)<100&&roundstate=2&&!root,numexplod(40000)
id = 8450
anim = 8450+floor((root,var(43)-floor(root,var(43)*1.0/10000)*10000)/1000)
pos = 15+ifelse(teamside=2,42,57)+floor(root,fvar(19)),63-30+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

;2桁目
[state 8900]
type = Explod
trigger1 = !NumExplod(8451)&&(root,var(40)=-10||(root,var(40)>=0&&floor(var(43)/1000)!=floor(root,var(43)/1000)&&floor(root,var(43)/1000)=50))&&floor(root,var(43)/1000)<100&&roundstate=2&&!root,numexplod(40000)
id = 8451
anim = 8450+floor(root,var(43)/10000)
pos = 15+ifelse(teamside=2,52,47)+floor(root,fvar(19)),63-30+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

;Lv.
[state 8900]
type = Explod
trigger1 = !NumExplod(8445)&&(root,var(40)=-10||(root,var(40)>=0&&floor(var(43)/1000)!=floor(root,var(43)/1000)&&floor(root,var(43)/1000)=50))&&roundstate=2&&!root,numexplod(40000)
id = 8445
anim = 8445
pos = 15+ifelse(teamside=2,67,32)+floor(root,fvar(19)),63-30+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

lv.100
[state 8900]
type = Explod
trigger1 = !NumExplod(8446)&&floor(root,var(43)/1000)=100&&floor(var(43)/1000)!=floor(root,var(43)/1000)&&roundstate=2&&!root,numexplod(40000)
id = 8446
anim = 8446
pos = 15+ifelse(teamside=2,67,32)+floor(root,fvar(19)),63-30+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing
;~~

;1桁目
[state 8900]
type = Explod
trigger1 = !NumExplod(8400)
id = 8400
anim = 8400+floor((root,var(43)-floor(root,var(43)*1.0/10000)*10000)/1000)+(root,var(43)>=50000)*20
pos = 15+ifelse(teamside=2,42,57)+floor(root,fvar(19)),63-30+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

;2桁目
[state 8900]
type = Explod
trigger1 = !NumExplod(8401)
id = 8401
anim = 8400+floor(root,var(43)/10000)+(root,var(43)>=50000)*20
pos = 15+ifelse(teamside=2,52,47)+floor(root,fvar(19)),63-30+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

;Lv.
[state 8900]
type = Explod
trigger1 = !NumExplod(8410)
id = 8410
anim = 8410+(root,var(43)>=50000)*20
pos = 15+ifelse(teamside=2,67,32)+floor(root,fvar(19)),63-30+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

;Up
[state 8900]
type = Explod
trigger1 = !NumExplod(8411)
id = 8411
anim = 8411
pos = 15+ifelse(teamside=2,77,67)+floor(root,fvar(19)),63-25+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

;Up
[state 8900]
type = Explod
trigger1 = !NumExplod(8431)
id = 8431
anim = 8431
pos = 15+ifelse(teamside=2,77,67)+floor(root,fvar(19)),63-25+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

lv.100
[state 8900]
type = Explod
trigger1 = !NumExplod(8440)
id = 8440
anim = 8440
pos = 15+ifelse(teamside=2,67,32)+floor(root,fvar(19)),63-30+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999
facing=facing

[state 8100]
type = VarSet
trigger1 = 1
var(43) = root,var(43)

[state 8100]
type = ModifyExplod
trigger1 = NumExplod(8400)
id = 8400
scale = (root,var(43)<100000)*.5,(root,var(43)<100000)*.5

[state 8100]
type = ModifyExplod
trigger1 = NumExplod(8401)
id = 8401
scale = (root,var(43)<100000)*.5,(root,var(43)<100000)*.5

[state 8100]
type = ModifyExplod
trigger1 = NumExplod(8410)
id = 8410
scale = (root,var(43)<100000)*.5,(root,var(43)<100000)*.5

[state 8100]
type = ModifyExplod
trigger1 = 1
id = 8411
scale = (roundstate=2&&!root,numexplod(40000)&&root,var(43)<50000&&(root,var(40)=[0,1]))*.5,(roundstate=2&&!root,numexplod(40000)&&root,var(43)<50000&&(root,var(40)=[0,1]))*.5

[state 8100]
type = ModifyExplod
trigger1 = 1
id = 8431
scale = (roundstate=2&&!root,numexplod(40000)&&(root,var(43)=[50000,99000])&&(root,var(40)=[0,1]))*.5,(roundstate=2&&!root,numexplod(40000)&&(root,var(43)=[50000,99000])&&(root,var(40)=[0,1]))*.5

[state 8100]
type = ModifyExplod
trigger1 = NumExplod(8440)
id = 8440
scale = (root,var(43)>=100000)*.5,(root,var(43)>=100000)*.5

;===援軍移動中
[state 8100]
type = Explod
trigger1 = !NumExplod(8130)&&!(root,var(40)!=0&&(root,var(40)!=[-899,-10]))
id = 8130
anim = 8130
pos = 0+floor(root,fvar(19)),63-6+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999

[state 8100]
type = Explod
trigger1 = !NumExplod(8131)&&!(root,var(40)!=0&&(root,var(40)!=[-899,-10]))
id = 8131
anim = 8131
pos = 0-16+floor(root,fvar(19)),63-6+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999

[state 8100]
type = Explod
trigger1 = !NumExplod(8135)&&!(root,var(40)!=0&&(root,var(40)!=[-899,-10]))
id = 8135
anim = 8135
pos = 15+20+floor(root,fvar(19)),63+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999

[state 8110]
type = ModifyExplod
trigger1 = 1
scale = (root,var(40)<=-10)*.5,(root,var(40)<=-10)*.5
id = 8130

[state 8110]
type = ModifyExplod
trigger1 = 1
scale = (root,var(40)<=-10&&roundstate=2&&!root,numexplod(40000))*.5,(root,var(40)<=-10&&roundstate=2&&!root,numexplod(40000))*.5
id = 8131

[state 8110]
type = ModifyExplod
trigger1 = 1
scale = (root,var(40)<=-10)*.5,(root,var(40)<=-10)*.5
pos = 15+22-floor((root,var(40)+10)/16)+floor(root,fvar(19)),63+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
id = 8135

[state 8110]
type = RemoveExplod
trigger1 = root,var(40)!=0&&(root,var(40)!=[-899,-10])
id = 8130

[state 8110]
type = RemoveExplod
trigger1 = root,var(40)!=0&&(root,var(40)!=[-899,-10])
id = 8131

[state 8110]
type = RemoveExplod
trigger1 = root,var(40)!=0&&(root,var(40)!=[-899,-10])
id = 8135

;移動〜到着
[state 8100]
type = PalFX
trigger1 = (!root,var(40)||(root,var(40)=[-899,-10]))
trigger2 = (root,var(40)<0&&(root,var(40)!=[-999,-10]))||(((roundstate=2&&!root,numexplod(40000))||root,var(42)<root,var(41))&&root,var(40)>=10)||var(5)=1
trigger3 = enemynear,name="Oichi"&&enemynear,authorname="rei"&&enemynear,numexplod(6793)
trigger4 = enemynear,name="Mouri Motonari"&&enemynear,authorname="Neat Unsou"&&enemynear,var(29)
mul = 128,128,128
time = 1

;援軍使用中枠
[state 8900]
type = Explod
trigger1 = !NumExplod(8466)&&((root,var(12)>0&&((root,var(40)=1&&(root,var(42)<root,var(41)))||root,var(40)=-1||(root,var(40)=[4,9]))))
id = 8466
anim = 8466
pos = 6+floor(root,fvar(19)),12+61+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
scale = .5,.5
removetime=-1
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999

;援軍ゲージ(要請前)
[state 8900]
type = Explod
trigger1 = !NumExplod(8106)&&root,var(40)=0
id = 8106
anim = 8106
pos = 15+floor(root,fvar(19)),63+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999

;援軍ゲージ(要請前)
[state 8900]
type = Explod
trigger1 = !NumExplod(8105)&&root,var(40)=0
id = 8105
anim = 8105
pos = 15+floor(root,fvar(19)),63+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999

[state 8100]
type = RemoveExplod
trigger1 = !root,numhelper(20000)||root,var(40)>=10
trigger2 = root,var(40)=1&&root,var(42)>=root,var(41)
id = 8466

[state 8100]
type = RemoveExplod
trigger1 = !root,numhelper(20000)||root,var(40)>=10
trigger2 = root,var(40)=1&&root,var(42)>=root,var(41)
id = 8467

[state 8100]
type = RemoveExplod
trigger1 = root,var(40)!=0
id = 8105

[state 8100]
type = RemoveExplod
trigger1 = root,var(40)!=0
id = 8106

[state 8900]
type = Explod
trigger1 = !NumExplod(8102)
id = 8102
anim = 8102
pos = 15-2+floor(root,fvar(19)),63+2+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999

[state 8100]
type = ModifyExplod
trigger1 = NumExplod(8102)
id = 8102
pos = 15-2+floor(root,fvar(19)),63+2+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back

[state 8100]
type = ModifyExplod
trigger1 = NumExplod(8102)&&((root,var(12)>0&&(root,var(40)=-1||(root,var(40)=[4,9]))&&numexplod(8466)&&!numexplod(8467)))
id = 8102
pos = 15-2-6+floor(root,fvar(19)),63+2+6+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back

;~~援軍ポートレイト

[state 8900]
type = Explod
trigger1 = !NumExplod(19000)
id = 19000
anim = 19000+(root,var(12)=[1,1999])*2+(root,var(12)=[2001,9999])*4+(root,var(12)=[10001,19999])*6
pos = 15+floor(root,fvar(19)),63+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
pausemovetime=9999999
supermovetime=9999999

[state 8900]
type = Explod
trigger1 = !NumExplod(19001)
id = 19001
anim = 19001+(root,var(12)=[1,1999])*2+(root,var(12)=[2001,9999])*4+(root,var(12)=[10001,19999])*6
pos = 15+floor(root,fvar(19)),63+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
pausemovetime=9999999
supermovetime=9999999

[state 8100]
type = ModifyExplod
trigger1 = NumExplod(19000)
id = 19000
scale = !((root,var(12)>0&&(root,var(40)=-1||(root,var(40)=[4,9]))&&numexplod(8466)&&!numexplod(8467)))*.5,!((root,var(12)>0&&(root,var(40)=-1||(root,var(40)=[4,9]))&&numexplod(8466)&&!numexplod(8467)))*.5

[state 8100]
type = ModifyExplod
trigger1 = NumExplod(19001)
id = 19001
scale = ((root,var(12)>0&&(root,var(40)=-1||(root,var(40)=[4,9]))&&numexplod(8466)&&!numexplod(8467)))*.5,((root,var(12)>0&&(root,var(40)=-1||(root,var(40)=[4,9]))&&numexplod(8466)&&!numexplod(8467)))*.5

[state 8900]
type = Explod
trigger1 = !NumExplod(8101)
id = 8101
anim = 8101
pos = 15-8+floor(root,fvar(19)),63+8+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999

[state 8900]
type = Explod
trigger1 = !NumExplod(8100)
id = 8100
anim = 8100
pos = 15+floor(root,fvar(19)),63+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999

[state 8100]
type = ModifyExplod
trigger1 = NumExplod(8101)&&!var(0)
id = 8101
scale = ((root,var(12)>0&&(root,var(40)=-1||(root,var(40)=[4,9]))&&numexplod(8466)&&!numexplod(8467)))*.5,((root,var(12)>0&&(root,var(40)=-1||(root,var(40)=[4,9]))&&numexplod(8466)&&!numexplod(8467)))*.5

[state 8100]
type = ModifyExplod
trigger1 = NumExplod(8100)&&!var(0)
id = 8100
scale = (root,var(40)!=0)*.5,(root,var(40)!=0)*.5

[state 8100]
type = varset
trigger1 = 1
var(0) = (root,var(12)>0&&(root,var(40)=-1||(root,var(40)=[4,9]))&&numexplod(8466)&&!numexplod(8467))

[state 8100]
type = RemoveExplod
trigger1 = NumExplod(8200)&&root,var(42)!=var(42)&&root,var(40)!=0
id = 8200
persistent=0

[state 8100]
type = RemoveExplod
trigger1 = NumExplod(8110)&&root,var(42)!=var(42)&&root,var(40)!=0
id = 8110
persistent=0

[state 8100]
type = VarSet
trigger1 = 1
var(41) = root,var(41)

[state 8100]
type = VarSet
trigger1 = 1
var(42) = root,var(42)

[state 8900]
type = Explod
trigger1 = !NumExplod(8110)&&root,var(40)=0
id = 8110
anim = 8110
pos = 15-2+floor(root,fvar(19)),63+2+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999

[state 8900]
type = Explod
trigger1 = !NumExplod(8300)
id = 8300
anim = 8300+floor((root,var(41)-71)*.37)
pos = 15-2+floor(root,fvar(19)),63+2+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999

[state 8900]
type = Explod
trigger1 = !NumExplod(8200)&&root,var(40)!=0
id = 8200
anim = 8200+floor((200-root,var(42))*.37)
pos = 15-2+floor(root,fvar(19)),63+2+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999

[state 8900]
type = Explod
trigger1 = !NumExplod(8110)&&root,var(40)!=0
id = 8110
anim = 8110
pos = 15-2+floor(root,fvar(19)),63+2+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
removetime=-1
scale = .5,.5
sprpriority = -2
bindtime = -1
ownpal = 1
pausemovetime=9999999
supermovetime=9999999

[state 8100]
type = ModifyExplod
trigger1 = 1
id = 8300
pos = 15-ifelse(var(0)=1&&numexplod(8466),8,2)+floor(root,fvar(19)),63+ifelse(var(0)=1&&numexplod(8466),8,2)+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back

[state 8100]
type = ModifyExplod
trigger1 = 1
id = 8200
pos = 15-ifelse(var(0)=1&&numexplod(8466),8,2)+floor(root,fvar(19)),63+ifelse(var(0)=1&&numexplod(8466),8,2)+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back

[state 8100]
type = ModifyExplod
trigger1 = 1
id = 8110
pos = 15-ifelse(var(0)=1&&numexplod(8466),8,2)+floor(root,fvar(19)),63+ifelse(var(0)=1&&numexplod(8466),8,2)+floor(1000*ifelse(((root,fvar(19)-floor(root,fvar(19)))=(0,.001)),-1000,1)*(root,fvar(19)-floor(root,fvar(19))))
postype = back
scale = (root,var(40)!=[-899,-10])*.5,(root,var(40)!=[-899,-10])*.5


;||||||||||||||||||||
;ゲージ位置調整用
[statedef 9001]
ctrl = 0
anim = 90000

;==BASARAゲージ
;==BASARA gauge

;X方向の位置調整+で右、-で左へ
;position X(+:right, -:left)
[state 9000]
type = Parentvarset
trigger1 = time=0
fvar(18) = var(0);デフォルト0

;Y方向の位置調整+で下、-で上へ（最大±999ドット）
;position Y(+:down, -:up)(maximum:999, minimum:-999)
[state 9000]
type = Parentvaradd
trigger1 = time=0
fvar(18) = abs(var(1))*.001*ifelse(var(1)<0,.001,1);デフォルト0

;==援軍ゲージ
;==Engun gauge

;X方向の位置調整+で右、-で左へ
;position X(+:right, -:left)
[state 9000]
type = Parentvarset
trigger1 = time=0
fvar(19) = var(2);デフォルト0

;Y方向の位置調整+で下、-で上へ（最大±999ドット）
;position Y(+:down, -:up)(maximum:999, minimum:-999)
[state 9000]
type = Parentvaradd
trigger1 = time=0
fvar(19) = abs(var(3))*.001*ifelse(var(3)<0,.001,1);デフォルト0

;==ガードゲージ
;==Guard gauge

;X方向の位置調整+で右、-で左へ
;position X(+:right, -:left)
[state 9000]
type = Parentvarset
trigger1 = time=0
fvar(20) = var(4);デフォルト0

;Y方向の位置調整+で下、-で上へ（最大±999ドット）
;position Y(+:down, -:up)(maximum:999, minimum:-999)
[state 9000]
type = Parentvaradd
trigger1 = time=0
fvar(20) = abs(var(5))*.001*ifelse(var(5)<0,.001,1);デフォルト0

;==小判ゲージ
;==Gold gauge

;X方向の位置調整+で右、-で左へ
;position X(+:right, -:left)
[state 9000]
type = Parentvarset
trigger1 = time=0
fvar(17) = var(6);デフォルト0

;Y方向の位置調整+で下、-で上へ（最大±999ドット）
;position Y(+:down, -:up)(maximum:999, minimum:-999)
[state 9000]
type = Parentvaradd
trigger1 = time=0
fvar(17) = abs(var(7))*.0001*ifelse(var(7)<0,.001,1);デフォルト0

;simulで位置ずらす
[state -2]
type = parentvaradd
trigger1 = numpartner&&time=1
trigger1 = partner,name="Honda Tadakatsu"||partner,name="Chousokabe Motochika"
trigger1 = (root,ID-partner,ID)>0
fvar(17) = .001*15*.001

;simulで位置ずらす
[state -2]
type = parentvaradd
triggerall = numpartner&&time=1
trigger1 = (root,ID-partner,ID)>0
fvar(18) = .001*20*.001

;simulで位置ずらす
[state -2]
type = parentvaradd
triggerall = numpartner&&time=1
trigger1 = (root,ID-partner,ID)>0
fvar(19) = .001*40

[state 9001]
type = DestroySelf
trigger1 = time=1

;---------------------------------------------------------------------------
;画面ステージ端判別用
[statedef 30000]
type    = A
movetype = I
physics = N
ctrl = 0
velset = 10,0
anim = 90000
sprpriority = 4

[State 6000]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[State 1000,Projectile]
type = Projectile
trigger1 = !Time
projanim = 90000
projID = 30000
projshadow = -1
velocity = vel x,0
accel = 0, 0
projhits = 1
projstagebound = 0
projedgebound = 999999
sprpriority = 5
; HitDefs
attr = A, NP
animtype  = Heavy
guardflag = MA
hitflag = MAF
sparkno = -1
guard.sparkno = -1
sparkxy = 0, 0
hitsound   = -1
guardsound = -1
ground.type = High
ground.slidetime = 15
guard.slidetime = 15
ground.hittime  = 15
guard.hittime  = 15
air.hittime = 13
ground.velocity = -11.5
guard.velocity = -11.5
airguard.velocity = -2.5
air.type = Low
air.velocity = -2.5,-7.5
yaccel = .5
air.fall = 1
fall.recover = 0
air.recover = 0
forcestand=1
ground.cornerpush.velofff = 0
air.cornerpush.veloff = 0

[State 900, 4]
type = VelSet
trigger1 = !root,NumProjId(30000)&&!var(0)&&Time>1
x = 0

[State 900, 4]
type = VarSet
trigger1 = !root,NumProjId(30000)&&!var(0)&&Time>1
var(0) = ifelse(Time>999,999,Time)

[State 900, 4]
type = ParentVarSet
trigger1 = ifelse(facing=-1,var(1),var(0))&&facing=1&&!root,fvar(12)
fvar(12) = ifelse(facing=-1,var(1),var(0))*10
persistent=0

[State 900, 4]
type = ParentVarAdd
trigger1 = ifelse(facing=-1,var(0),var(1))&&facing=-1&&(root,fvar(12)>=1||root,fvar(12)<=-1)
fvar(12) = ifelse(facing=-1,var(0),var(1))*.0001*10
persistent=0

;HP REVERSAL KO用
[state 2000]
type = VarSet
trigger1 = (Root,Life*100/Root,Const(data.life))<=20&&(Enemynear,Life*100/Enemynear,Const(data.life))>=80&&!var(9)
var(9) = 1

;HP REVERSAL KO用
[state 2000]
type = VarAdd
trigger1 = var(9)>0&&roundstate>=3&&(Root,DrawGame||Root,Win)
var(9) = 1

;HP REVERSAL KO用
[state 2000]
type = VarSet
trigger1 = (Root,Life*100/Root,Const(data.life))>30&&var(9)=1
var(9) = -1

;距離が近い相手判別
[state 2000]
type = VarSet
trigger1 = 1
var(11) = floor(enemynear,pos x)

;次に距離が近い相手判別
[state 2000]
type = VarSet
trigger1 = 1
var(12) = floor(enemynear(numenemy-1),pos x)

;相手がヘルパーか判別
[state 2000]
type = VarSet
trigger1 = 1
var(16) = enemynear,ishelper

;相手がヘルパーか判別
[state 2000]
type = VarSet
trigger1 = 1
var(17) = enemynear(numenemy-1),ishelper

[State 200]
type = DisplayToClipboard
trigger1 = 1
text = "Right Pos = %d Left Pos = %d"
params = ifelse(facing=-1,ceil(var(1)),ceil(var(0)))*10, -ifelse(facing=-1,ceil(var(0)),ceil(var(1)))*10
ignorehitpause =1

[State 200]
type = DisplayToClipboard
trigger1 = 1
text = "enemynear,pos = %d enemynear(1),pos = %d"
params = var(11),var(12)
ignorehitpause =1
;---------------------------------------------------------------------------
;画面ステージ端判別用
[statedef 30005]
type    = A
movetype = I
physics = N
ctrl = 0
velset = -10,0
anim = 90000
sprpriority = 4

[State 6000]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[State 1000,Projectile]
type = Projectile
trigger1 = !Time
projanim = 90000
projID = 30010
projshadow = -1
velocity = vel x,0
accel = 0, 0
projhits = 1
projstagebound = 0
projedgebound = 999999
sprpriority = 5
; HitDefs
attr = A, NP
animtype  = Heavy
guardflag = MA
hitflag = MAF
sparkno = -1
guard.sparkno = -1
sparkxy = 0, 0
hitsound   = -1
guardsound = -1
ground.type = High
ground.slidetime = 15
guard.slidetime = 15
ground.hittime  = 15
guard.hittime  = 15
air.hittime = 13
ground.velocity = -11.5
guard.velocity = -11.5
airguard.velocity = -2.5
air.type = Low
air.velocity = -2.5,-7.5
yaccel = .5
air.fall = 1
fall.recover = 0
air.recover = 0
forcestand=1
ground.cornerpush.velofff = 0
air.cornerpush.veloff = 0

[State 900, 4]
type = VelSet
trigger1 = !root,NumProjId(30010)&&!var(1)&&Time>1
x = 0

[State 900, 4]
type = VarSet
trigger1 = !root,NumProjId(30010)&&!var(1)&&Time>1
var(1) = ifelse(Time>999,999,Time)

[State 900, 4]
type = ParentVarSet
trigger1 = ifelse(facing=-1,var(1),var(0))&&facing=-1&&!root,fvar(12)
fvar(12) = ifelse(facing=-1,var(1),var(0))*10
persistent=0

[State 900, 4]
type = ParentVarAdd
trigger1 = ifelse(facing=-1,var(0),var(1))&&facing=1&&(root,fvar(12)>=1||root,fvar(12)<=-1)
fvar(12) = ifelse(facing=-1,var(0),var(1))*.0001*10
persistent=0

;距離が近い相手判別
[state 2000]
type = VarSet
trigger1 = 1
var(11) = floor(enemynear,pos x)

;次に距離が近い相手判別
[state 2000]
type = VarSet
trigger1 = 1
var(12) = floor(enemynear(numenemy-1),pos x)

;相手がヘルパーか判別
[state 2000]
type = VarSet
trigger1 = 1
var(16) = enemynear,ishelper

;相手がヘルパーか判別
[state 2000]
type = VarSet
trigger1 = 1
var(17) = enemynear(numenemy-1),ishelper

[State 0, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "Right Pos = %d Left Pos = %d"
params = ifelse(facing=-1,ceil(var(1)),ceil(var(0)))*10, -ifelse(facing=-1,ceil(var(0)),ceil(var(1)))*10
ignorehitpause =1

[State 200]
type = DisplayToClipboard
trigger1 = 1
text = "enemynear,pos = %d enemynear(1),pos = %d"
params = var(11),var(12)
ignorehitpause =1

;~~オープニング~~
[statedef 6980]
ctrl = 0
anim = 90000

[state 6980]
type = SuperPause
trigger1 = Time=1
time = 2
movetime = 2
p2defmul = 1
anim = -1
sound = -1
poweradd = 0

[state 6980]
type = AssertSpecial
trigger1 = 1
flag = NoFG
flag2 = Intro
flag3 = NoMusic

[state 6980]
type = AllPalFX
trigger1 = Time<60
add = -255,-255,-255
time = 1

[state 6980]
type = AllPalFX
trigger1 = Time=[760,790]
add = 255-(time-760)*8,255-(time-760)*8,255-(time-760)*8
time = 1

;背景
[state 6980]
type = Explod
trigger1 = time=60
id = 6984
anim = 6984
pos = 0+(teamside=2)*320,0
postype = back
ontop = 1
facing=facing
supermovetime = 99999
scale = 320,240

;背景
[state 6980]
type = Explod
trigger1 = time=60
id = 6985
anim = 6985
pos = 0+(teamside=2)*320,0
postype = back
ontop = 1
facing=facing
supermovetime = 99999
scale = .5,.5

;忠勝
[state 6980]
type = Explod
trigger1 = time=60
id = 6980
anim = 6980
pos = 0+(teamside=2)*320,0
postype = back
ontop = 1
facing=facing
supermovetime = 99999
scale = .5,.5

;忠勝
[state 6980]
type = Explod
trigger1 = time=60
id = 6981
anim = 6981
pos = 0+(teamside=2)*320,0
postype = back
ontop = 1
facing=facing
supermovetime = 99999
scale = .5,.5

;忠勝
[state 6980]
type = Explod
trigger1 = time=60
id = 6986
anim = 6986
pos = 80+(teamside=2)*240,180
postype = back
ontop = 1
facing=facing
supermovetime = 99999
scale = .5,.5

;忠勝紹介
[state 6980]
type = Explod
trigger1 = time=60
id = 6988
anim = 6988
pos = 0+(teamside=2)*320,0
postype = back
ontop = 1
facing=facing
supermovetime = 99999
scale = .5,.5

;家康
[state 6980]
type = Explod
trigger1 = time=60
id = 6982
anim = 6982
pos = 0+(teamside=2)*320,0
postype = back
ontop = 1
facing=facing
supermovetime = 99999
scale = .5,.5

;忠勝
[state 6980]
type = Explod
trigger1 = time=60
id = 6983
anim = 6983
pos = 0+(teamside=2)*320,0
postype = back
ontop = 1
facing=facing
supermovetime = 99999
scale = .5,.5

;家康
[state 6980]
type = Explod
trigger1 = time=60
id = 6987
anim = 6987
pos = 200-(teamside=2)*80,180
postype = back
ontop = 1
facing=facing
supermovetime = 99999
scale = .5,.5

;家康紹介
[state 6980]
type = Explod
trigger1 = time=60
id = 6989
anim = 6989
pos = 160,0
postype = back
ontop = 1
facing=facing
supermovetime = 99999
scale = .5,.5

[state 6980]
type = ModifyExplod
trigger1 = 1
id = 6981
scale = (Time>=760)*.5,(Time>=760)*.5

[state 6980]
type = ModifyExplod
trigger1 = 1
id = 6982
scale = (Time>=420)*.5,(Time>=420)*.5

[state 6980]
type = ModifyExplod
trigger1 = 1
id = 6983
scale = (Time>=760)*.5,(Time>=760)*.5

[state 6980]
type = ModifyExplod
trigger1 = 1
id = 6986
scale = (Time>=300)*.5,(Time>=300)*.5

[state 6980]
type = ModifyExplod
trigger1 = 1
id = 6987
scale = (Time>=600)*.5,(Time>=600)*.5

[state 6980]
type = ModifyExplod
trigger1 = 1
id = 6988
scale = (Time>=120)*.5,(Time>=120)*.5

[state 6980]
type = ModifyExplod
trigger1 = 1
id = 6989
scale = (Time>=480)*.5,(Time>=480)*.5

[state 6980]
type = PlaySND
trigger1 = Time=800
value = 10,0

[state 8980]
type = RemoveExplod
trigger1 = Time>=960

[state -2]
type = DestroySelf
trigger1 = Time>=960

;エンディング
[statedef 6990]
ctrl = 0
velset = 0,0
anim = 90000

;ランダム
[state 8900]
type = PlaySND
trigger1 = Root,Command="s"
value = 10,random%180
channel = 2

[state 6980]
type = AllPalFX
trigger1 = Time=[0,30]
add = 255-(time-0)*8,255-(time-0)*8,255-(time-0)*8
time = 1

[state 6980]
type = Explod
trigger1 = time=1
id = 6990
anim = 6990
pos = 0,0
postype = back
ontop = 1
facing=facing
supermovetime = 99999
scale = .25,.25


;攻撃形態（最低空飛行形態からの連携用）
[statedef 9800]
type = A
physics = N
ctrl = 0
velset = 0,0
anim = 90000

[state 9800]
type = varset
trigger1 = !time
var(0) = 0
ignorehitpause=1

[state 9800]
type = varset
trigger1 = !var(0)&&(command="x"||command="y"||command="z")
var(0) = ifelse(command="z",3,ifelse(command="y",2,1))+(command="holddown")*3
ignorehitpause=1

[state 9800]
type = DestroySelf
trigger1 = time>15
ignorehitpause=1

;===AI用

;---------------------------------------------------------------------------
; Standing
[Statedef 3]
type = S
physics = S
sprpriority = 0

[State 0, 1]
type = ChangeAnim
trigger1 = Anim != 0 && Anim != 5
trigger2 = Anim = 5 && AnimTime = 0 ;Turn anim over
value = 0

[State 0, 2]
type = VelSet
trigger1 = Time = 0
y = 0

[State 0, 3] ;Stop moving if low velocity or 4 ticks pass
type = VelSet
trigger1 = abs(vel x) < 1
x = ifelse(fvar(9),fvar(9),0)

[State 0, 3]
type = VarSet
trigger1 = 1
fvar(8) = 0

[State 0, 3]
type = VelSet
trigger1 = 1
x = fvar(8)+fvar(9)+ifelse(enemynear,backedgebodydist<=5||enemynear,frontedgebodydist<=5,fvar(5),0)

[State 0, 4] ;Are you dead?
type = ChangeState
trigger1 = !alive
value = 5050

;---------------------------------------------------------------------------
; Crouching
[Statedef 13]
;type    = C
;physics = C
anim = 10;11
sprpriority = 0
ctrl = 0

[State 0, 3]
type = VelSet
trigger1 = 1
x = fvar(8)+fvar(9)+ifelse(enemynear,backedgebodydist<=5||enemynear,frontedgebodydist<=5,fvar(5),0)

[State 0, 3]
type = VarSet
trigger1 = 1
fvar(8) = 0

[State 11, 1] ;Change from turning animation
type = CtrlSet
trigger1 = P2dist X<0&&Time
trigger2 = roundstate>=3
value = 1

[State 11, 1] ;Change from turning animation
type = ChangeAnim
trigger1 = Anim=10&&AnimTime=0||(statetype=C&&!time)
value = 11

[State 11, 1] ;Change from turning animation
type = StatetypeSet
trigger1 = !time
statetype=C
physics = C


;---------------------------------------------------------------------------
; FWDWalk
[Statedef 21]
type    = S
physics = S
sprpriority = 0
anim = 20
ctrl = 0

[State 20, 1]
type = VelSet
trigger1 = time>=2
x = const(velocity.walk.fwd.x)*ifelse(var(10),1.5,1)

[State 11, 1] ;Change from turning animation
type = CtrlSet
trigger1 = P2dist X<0&&Time
trigger2 = roundstate>=3
value = 1

[State 20, 3]
type = ChangeAnim
trigger1 = Anim != 20 && Anim != 5
trigger2 = Anim = 5 && AnimTime = 0
value = 20

[state 6150]
type = Explod
trigger1 = var(10)&&prevstateno=0&&!time
id = 25
anim=25+(Anim=21)
pos = floor(0*const(size.xscale)),floor(-250*const(size.yscale))
postype = p1
sprpriority = -1
bindtime=-1
ignorehitpause=1
removeongethit=1
removetime=-1
scale = const(size.xscale),const(size.yscale)
persistent=0

;現在の速度取得
[state 40]
type = varset
trigger1 = time=0
fvar(8) = 0

;現在の速度取得
[state 40]
type = varset
trigger1 = time>=2
fvar(8) = const(velocity.walk.fwd.x)*ifelse(var(10),1.5,1)

;---------------------------------------------------------------------------
; Back Walk
[Statedef 22]
type    = S
physics = S
sprpriority = 0
anim = 21
ctrl = 0

[State 20, 2]
type = VelSet
trigger1 = time>=2
x = const(velocity.walk.back.x)*ifelse(var(10),1.5,1)

[State 11, 1] ;Change from turning animation
type = CtrlSet
trigger1 = P2dist X<0&&Time
trigger2 = roundstate>=3
value = 1

[State 20, 4]
type = ChangeAnim
trigger1 = Anim != 21 && Anim != 5
trigger2 = Anim = 5 && AnimTime = 0
value = 21

[state 6150]
type = Explod
trigger1 = var(10)&&prevstateno=0&&!time
id = 25
anim=25+(Anim=21)
pos = floor(0*const(size.xscale)),floor(-250*const(size.yscale))
postype = p1
sprpriority = -1
bindtime=-1
ignorehitpause=1
removeongethit=1
removetime=-1
scale = const(size.xscale),const(size.yscale)
persistent=0

;現在の速度取得
[state 40]
type = varset
trigger1 = time=0
fvar(8) = 0

;現在の速度取得
[state 40]
type = varset
trigger1 = time>=2
fvar(8) = const(velocity.walk.back.x)*ifelse(var(10),1.5,1)


;===AI(CPU)
;AI起動用ヘルパー（ヘルパー側でAI起動）
[statedef 90000]
ctrl = 0

[state 98765]
type = Assertspecial
trigger1 = 1
flag = invisible

[state 98765]
type = nothitby
trigger1 = 1
value = SCA
time=-1

[state 98765]
type = turn
trigger1 = facing!=parent,facing

;プレイヤー判定
[state 98765]
type = varset
triggerall = var(59)!=1
trigger1 = command="up"&&root,command="up"
trigger2 = command="down"&&root,command="down"
trigger3 = command="fwd"&&root,command="fwd"
trigger4 = command="back"&&root,command="back"
trigger5 = command="x"&&root,command="x"
trigger6 = command="y"&&root,command="y"
trigger7 = command="z"&&root,command="z"
trigger8 = command="a"&&root,command="a"
trigger9 = command="b"&&root,command="b"
trigger10 = command="c"&&root,command="c"
trigger11 = command="s"&&root,command="s"
var(59) = -1

[state -1]
type = DestroySelf
trigger1 = root,var(59)||var(59)=-1||((var(1)=2||var(3))&&var(0))
trigger2 = command="down"&&root,command="down"
trigger3 = command="fwd"&&root,command="fwd"
trigger4 = command="back"&&root,command="back"
trigger5 = command="x"&&root,command="x"
trigger6 = command="y"&&root,command="y"
trigger7 = command="z"&&root,command="z"
trigger8 = command="a"&&root,command="a"
trigger9 = command="b"&&root,command="b"
trigger10 = command="c"&&root,command="c"
trigger11 = command="s"&&root,command="s"
trigger12 = command="up"&&root,command="up"
trigger13 = roundstate>2

[state 90000]
type = varset
trigger1 = roundstate=2&&root,ctrl
var(0) = 1

[state 90000]
type = varset
trigger1 = !var(0)&&(power-var(2)=[1,const(data.power)/20])
var(3) = 1

[state 90000]
type = poweradd
trigger1 = (TeamMode=Single) && (enemy,TeamMode=Single) && (power>=const(data.power)) && !var(1) && !var(0)
value = -1

[state 90000]
type = poweradd
trigger1 = (TeamMode=Single) && (enemy,TeamMode=Single) && (power=const(data.power)-1) && var(0)
value = 1

[state 90000]
type = varset
trigger1 = 1
var(2) = power

[state 90000]
type = varset
trigger1 = (TeamMode=Single) && (enemy,TeamMode=Single) && (power>=const(data.power)) && !var(1) && !var(0)
var(1) = 1

[state 90000]
type = varset
trigger1 = (TeamMode=Single) && (enemy,TeamMode=Single) && (power=const(data.power)-1) && var(1)=1
var(1) = 2

[state 90000]
type = varadd
trigger1 = var(1)=2
var(1) = 1

;AI判定
[state 98765]
type = varset
triggerall = var(59)!=-1&&var(0)=1
trigger1 = root,command="up"
trigger2 = root,command="down"
trigger3 = root,command="fwd"
trigger4 = root,command="back"
trigger5 = root,command="x"
trigger6 = root,command="y"
trigger7 = root,command="z"
trigger8 = root,command="a"
trigger9 = root,command="b"
trigger10 = root,command="c"
trigger11 = root,command="s"
var(59) = 1


;===AI(CPU)
;AI背面攻撃ガード用
[statedef 91000]
ctrl = 0
anim= 90000

[state 98765]
type = Assertspecial
trigger1 = 1
flag = invisible
flag2 = noshadow

[state 98765]
type = nothitby
trigger1 = 1
value = SCA
time=-1

[state 91000]
type = BindtoRoot
trigger1 = 1
pos = -80-root,const(size.ground.back),100
time= 1

[state 91000]
type = Turn
trigger1 = root,facing!=facing

;-160で計算

;相手が一定時間停滞しているか判別
[state 91000]
type = varset
trigger1 = Root,P2bodydist X>20&&!(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[20,60]))
var(0) = 0

;相手が一定時間停滞しているか判別
[state 91000]
type = varadd
trigger1 = (Root,P2bodydist X=[-10,20])||(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[20,60]))
var(0) = 1+(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[20,60]))

;相手が一定時間停滞しているか判別
[state 91000]
type = varset
trigger1 = (Root,P2bodydist X!=[20,40])&&!(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[40,80]))
var(1) = 0

;相手が一定時間停滞しているか判別
[state 91000]
type = varadd
trigger1 = (Root,P2bodydist X=[20,40])||(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[40,80]))
var(1) = 1+(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[40,80]))

;相手が一定時間停滞しているか判別
[state 91000]
type = varset
trigger1 = (Root,P2bodydist X!=[40,60])&&!(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[60,100]))
var(2) = 0

;相手が一定時間停滞しているか判別
[state 91000]
type = varadd
trigger1 = (Root,P2bodydist X=[40,60])||(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[60,100]))
var(2) = 1+(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[60,100]))

;相手が一定時間停滞しているか判別
[state 91000]
type = varset
trigger1 = (Root,P2bodydist X!=[60,80])&&!(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[80,120]))
var(3) = 0

;相手が一定時間停滞しているか判別
[state 91000]
type = varadd
trigger1 = (Root,P2bodydist X=[60,80])||(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[80,120]))
var(3) = 1+(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[80,120]))

;相手が一定時間停滞しているか判別
[state 91000]
type = varset
trigger1 = (Root,P2bodydist X!=[80,100])&&!(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[100,140]))
var(4) = 0

;相手が一定時間停滞しているか判別
[state 91000]
type = varadd
trigger1 = (Root,P2bodydist X=[80,100])||(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[100,140]))
var(4) = 1+(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[100,140]))

;相手が一定時間停滞しているか判別
[state 91000]
type = varset
trigger1 = (Root,P2bodydist X!=[100,120])&&!(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[120,160]))
var(5) = 0

;相手が一定時間停滞しているか判別
[state 91000]
type = varadd
trigger1 = (Root,P2bodydist X=[100,120])||(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[120,160]))
var(5) = 1+(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[120,160]))

;相手が一定時間停滞しているか判別
[state 91000]
type = varset
trigger1 = (Root,P2bodydist X!=[120,140])&&!(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[140,180]))
var(6) = 0

;相手が一定時間停滞しているか判別
[state 91000]
type = varadd
trigger1 = (Root,P2bodydist X=[120,140])||(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[140,180]))
var(6) = 1+(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[140,180]))

;相手が一定時間停滞しているか判別
[state 91000]
type = varset
trigger1 = (Root,P2bodydist X!=[140,160])&&!(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[160,200]))
var(7) = 0

;相手が一定時間停滞しているか判別
[state 91000]
type = varadd
trigger1 = (Root,P2bodydist X=[140,160])||(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[160,200]))
var(7) = 1+(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[160,200]))

;相手が一定時間停滞しているか判別
[state 91000]
type = varset
trigger1 = (Root,P2bodydist X!=[160,180])&&!(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[180,220]))
var(8) = 0

;相手が一定時間停滞しているか判別
[state 91000]
type = varadd
trigger1 = (Root,P2bodydist X=[160,180])||(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[180,220]))
var(8) = 1+(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[180,220]))

;相手が一定時間停滞しているか判別
[state 91000]
type = varset
trigger1 = (Root,P2bodydist X!=[180,200])&&!(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[200,240]))
var(9) = 0

;相手が一定時間停滞しているか判別
[state 91000]
type = varadd
trigger1 = (Root,P2bodydist X=[180,200])||(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[200,240]))
var(9) = 1+(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[200,240]))

;相手が一定時間停滞しているか判別
[state 91000]
type = varset
trigger1 = (Root,P2bodydist X!=[200,220])&&!(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[220,260]))
var(10) = 0

;相手が一定時間停滞しているか判別
[state 91000]
type = varadd
trigger1 = (Root,P2bodydist X=[200,220])||(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[220,260]))
var(10) = 1+(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[220,260]))

;相手が一定時間停滞しているか判別
[state 91000]
type = varset
trigger1 = (Root,P2bodydist X!=[220,240])&&!(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[240,280]))
var(11) = 0

;相手が一定時間停滞しているか判別
[state 91000]
type = varadd
trigger1 = (Root,P2bodydist X=[220,240])||(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[240,280]))
var(11) = 1+(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[240,280]))

;相手が一定時間停滞しているか判別
[state 91000]
type = varset
trigger1 = (Root,P2bodydist X!=[240,260])&&!(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[260,300]))
var(12) = 0

;相手が一定時間停滞しているか判別
[state 91000]
type = varadd
trigger1 = (Root,P2bodydist X=[240,260])||(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[260,300]))
var(12) = 1+(((root,vel X>0&&(root,statetype=A||root,anim=20))||(enemynear,vel X>0&&P2movetype!=A))&&(Root,P2bodydist X=[260,300]))

;自分が接近した回数判別
[state 91000]
type = varset
trigger1 = gametime%1200=0 && random<=750
var(13) = 0

;自分が接近した回数判別
[state 91000]
type = varadd
trigger1 = (Root,P2bodydist X=[-15,45])&&P2movetype=H
var(13) = 1

;相手が近づいてくる回数判別
[state 91000]
type = varset
trigger1 = gametime%180=0 && random<=750&&P2movetype!=H
var(14) = 0

;相手が近づいてくる頻度判別
[state 91000]
type = varadd
trigger1 = enemynear,vel X>0 && P2movetype!=A&&(Root,P2bodydist X=[140,200])
var(14) = 1

;相手が攻撃状態か判別
[state 91000]
type = varset
trigger1 = !(P2movetype!=A&&!inguarddist)&&gametime%4=0
var(15) = 0

;相手が攻撃状態か判別
[state 91000]
type = varadd
trigger1 = P2movetype!=A&&!inguarddist&&root,statetype!=L
var(15) = 1

;相手が空中か判別
[state 91000]
type = varset
trigger1 = P2statetype!=A
var(16) = 0

;相手が空中か判別
[state 91000]
type = varadd
trigger1 = P2statetype=A
var(16) = 1

;相手が空中にいる回数判別
[state 91000]
type = varadd
trigger1 = gametime%240=0&&random<=750
var(17) = -1-(var(17)>=10)*10

;相手が空中にいる回数判別
[state 91000]
type = varadd
trigger1 = var(16)=20&&var(17)%10<8
var(17) = 1

;相手が空中にいる回数判別
[state 91000]
type = varadd
trigger1 = var(16)=26&&enemynear,pos Y<-120&&var(17)<90
var(17) = 10

;相手が地上にいる時間判別
[state 91000]
type = varset
trigger1 = gametime%4=0&&P2movetype!=H
var(18) = 0

;相手が地上にいる時間判別
[state 91000]
type = varadd
trigger1 = !var(16)
var(18) = 1

;ガード可能状態か判別
[state 91000]
type = varset
trigger1 = !inguarddist&&gametime%4=0
var(19) = 0

;ガード可能状態か判別
[state 91000]
type = varadd
trigger1 = inguarddist
var(19) = 1

;~~~~技が潰された・避けられた回数~~~~
;一定時間毎にリセット
[state 91000]
type = varadd
trigger1 = !root,var(2)&&root,movetype!=H&&root,statetype!=L&&(root,movecontact!=[1,18-(root,stateno=200)*10])&&!root,fvar(34) && root,P2bodydist X<=180 && random<=750
var(59) = 1

[state 91000]
type = null
triggerall = var(59)%240=0
trigger1 = var(21)<-1||var(21)>1
trigger1 = var(21):= var(21)+ifelse(var(21)>0,-1,1)
trigger2 = var(22)<-1||var(22)>1
trigger2 = var(22):= var(22)+ifelse(var(22)>0,-1,1)
trigger3 = var(25)<-1||var(25)>1
trigger3 = var(25):= var(25)+ifelse(var(25)>0,-1,1)
trigger4 = var(27)<-1||var(27)>1
trigger4 = var(27):= var(27)+ifelse(var(27)>0,-1,1)
trigger5 = var(47)<-1||var(47)>1
trigger5 = var(47):= var(47)+ifelse(var(47)>0,-1,1)

[state 91000]
type = varadd
trigger1 = stateno=210&&time=1&&!root,var(2)&&(prevstateno!=[200,1199])
var(21) = -1

[state 91000]
type = varadd
trigger1 = stateno=210&&(animtime=0||movecontact)
var(21) = 1+(movecontact!=0)

[state 91000]
type = varadd
trigger1 = stateno=220&&time=1&&!root,var(2)&&(prevstateno!=[200,1199])
var(22) = -1

[state 91000]
type = varadd
trigger1 = stateno=220&&(animtime=0||movecontact)
var(22) = 1+(movecontact!=0)

[state 91000]
type = varadd
trigger1 = stateno=400&&time=1&&!root,var(2)&&(prevstateno!=[200,1199])
var(25) = -1

[state 91000]
type = varadd
trigger1 = stateno=400&&(animtime=0||movecontact)
var(25) = 1+(movecontact!=0)

[state 91000]
type = varadd
trigger1 = stateno=420&&time=1&&!root,var(2)&&(prevstateno!=[200,1199])
var(27) = -1

[state 91000]
type = varadd
trigger1 = stateno=420&&(animtime=0||movecontact)
var(27) = 1+(movecontact!=0)

[state 91000]
type = varadd
trigger1 = stateno=1400&&time=1&&!root,var(2)
var(34) = -1

[state 91000]
type = varadd
trigger1 = stateno=1400&&animtime=0
var(34) = 1+(movecontact!=0)

[state 91000]
type = varadd
trigger1 = stateno=420&&time=1&&!root,var(2)&&prevstateno=220
var(47) = -1

[state 91000]
type = varadd
trigger1 = stateno=420&&(animtime=0||movecontact)
var(47) = 1+(movecontact!=0)

[state 91000]
type = varadd
trigger1 = stateno=1000&&time=1&&!root,var(2)&&prevstateno=220
var(48) = -1

[state 91000]
type = varadd
trigger1 = stateno=1005&&(animtime=0||movecontact)
var(48) = 1+(movecontact!=0)

[State -2]
type = DisplayToClipboard
trigger1 = 1
ignorehitpause = 1
text = "AttackTime = %d  AirTime = %d var(6) = %d var(7) = %d"
params = var(15),var(16),var(6),var(7)

;□□常時監視ステート□□
[statedef -2]

[state -2]
type = VarRandom
trigger1 = 1
v = 50
range = 0,999
ignorehitpause=1

;□硬直終了後1F目に行動できるように□
;（MUGENの仕様で初期状態は不可能なので）

[state -2,KOSND]
type = Turn
trigger1 = ctrl&&AnimTime=0&&statetype!=A&&P2dist X<0

[state -2,KOSND]
type = ChangeState
trigger1 = (stateno=101||stateno=106||stateno=195||(stateno=[200,4999])||Stateno=5120)&&ctrl&&AnimTime=0&&statetype!=A
value = ifelse(statetype=C,11,0)

[state 6980]
type = PlaySND
trigger1 = !numhelper(6950)&&IsHomeTeam!=teamside&&teamside=1&&!time&&stateno=5900&&fvar(39)!=7
trigger2 = stateno=180 && time=1 && !numenemy
value = 7900,2
channel = 21
volume = 255

;オープニング用
[state -2]
type = null;Helper
trigger1 = IsHomeTeam!=teamside&&teamside=1&&!time&&stateno=5900&&fvar(39)!=7;(IsHomeTeam-1)=teamside&&!time&&fvar(39)!=7&&!IsHelper
id = 6980
stateno=6980
pos = 0,0
postype = back
ownpal = 1
pausemovetime=999999
supermovetime=999999

[state 6980]
type = null;StopSND
trigger1 = !NumHelper(6980)&&!(stateno=180&&!numenemy)
channel = 21

;エンディング用
[state -2]
type = null;Helper
trigger1 = stateno=180&&Time=300&&!numenemy
id = 6990
stateno=6990
pos = 0,0
postype = back
ownpal = 1
pausemovetime=999999
supermovetime=999999

;==WIN
[state -2]
type = null;Helper
triggerall = !alive && matchover && Win && !numhelper(8600)
trigger1 = !numpartner
trigger2 = numpartner
trigger2 = !((ID-partner,ID)>0 && (partner,authorname="rei"||partner,authorname="gal129")&&partner,fvar(39)=7)
id = 8600
stateno=8600
pos = 0,0
postype = back
ownpal = 1
facing=facing
pausemovetime=999999
supermovetime=999999

[state -2]
type = varset
trigger1 = 1
fvar(39) = 7;(Sengoku BASARA X)

;大ジャンプ・２段ジャンプ処理
[State -2, crouch]
type = VarSet
trigger1 = command!="holddown" && !((stateno=40 || stateno=45)&&time<=1)
var(0)=ifelse(var(0)>=100,900,0)
ignorehitpause=1

[State -2, crouch]
type = VarSet
trigger1 = command!="holdup" && !((stateno=40 || stateno=45)&&time<=1) && var(0)>=100
var(0)=0
ignorehitpause=1

[State -2, crouch]
type = VarSet
trigger1 = !var(59) && command="holddown" && statetype!=A && var(0)%ifelse(var(0)>=1000,1000,100)<90
var(0)=var(0)+1
ignorehitpause=1

[State -2, crouch]
type = VarSet
trigger1 = !var(59) && command="holdup" && statetype=A && var(0)<9000
var(0)=var(0)+100
ignorehitpause=1

;相手画面端時裏回り防止
[state -2]
type = Width
trigger1 = movetype!=H
edge = 1+((enemynear,backedgebodydist<=5||enemynear,frontedgebodydist<=5)&&var(1)%2>=1)*20,0

;◇◇ブースト◇◇
;ブースト・ダッシュ慣性

;~~~~壁コン中移動ブースト
[state -2]
type = varadd
triggerall = floor(var(6)%1000/100)>0&&stateno!=900
trigger1 = var(1)%2>=1&&P2stateno=927&&(enemynear,backedgebodydist<=5||enemynear,frontedgebodydist<=5)&&backedgebodydist>15&&frontedgebodydist>15
trigger2 = var(1)%2<1
trigger3 = fvar(10)<=0
var(6) = -100

[state -2]
type = varset
triggerall = floor(var(6)%1000/100)>0&&enemynear,backedgebodydist>5&&enemynear,frontedgebodydist>5
trigger1 = var(1)%2>=1&&movecontact=1&&fvar(10)>0
fvar(9) = 11.5

[state -2]
type = varset
triggerall = floor(var(6)%1000/100)>0&&enemynear,backedgebodydist>5&&enemynear,frontedgebodydist>5
trigger1 = var(1)%2>=1&&movecontact&&var(52)=1&&fvar(10)>0
fvar(10) = 60

[State 5210, 1] ;Blink white
type = PalFX
trigger1 = floor(var(6)%1000/100)>0
trigger1 = var(1)%2>=1&&((fvar(10)=[52,60])||(movecontact&&var(52)=2&&enemynear,backedgebodydist>5&&enemynear,frontedgebodydist>5))
time = 1
add = ifelse(fvar(10)<52,255,floor(fvar(10)-52)*32),ifelse(fvar(10)<52,255,floor(fvar(10)-52)*32),ifelse(fvar(10)<52,255,floor(fvar(10)-52)*32)

[State 5210, 1] ;Blink white
type = PalFX
trigger1 = (fvar(10)=[32,40])&&prevstateno=2000
time = 1
add = ifelse(fvar(10)<32,255,floor(fvar(10)-32)*32),ifelse(fvar(10)<32,255,floor(fvar(10)-32)*32),ifelse(fvar(10)<32,255,floor(fvar(10)-32)*32)

;BASARAゲージ回復不能時間
[state 2000]
type = VarAdd
triggerall = floor(var(6)%1000/100)>0&&enemynear,backedgebodydist>5&&enemynear,frontedgebodydist>5
trigger1 = var(1)%2>=1&&movecontact&&var(52)=1
var(9)=ifelse(var(9)>=10000,12000-floor(var(9)/100)*100,12000)

[state 2000]
type = Helper
triggerall = floor(var(6)%1000/100)>0&&enemynear,backedgebodydist>5&&enemynear,frontedgebodydist>5
trigger1 = var(1)%2>=1&&movecontact&&var(52)=1
id = 7720
stateno=7720
pos = 0,floor(-160*const(size.yscale))
postype = p1
pausemovetime=999
supermovetime=999
ownpal = 1
sprpriority = 2
ignorehitpause=1

;~~~~
;振り向き処理
[state 0]
type = AssertSpecial
trigger1 = fvar(9)&&statetype!=A
flag = noautoturn

[State 0, 3]
type = VarSet
trigger1 = fvar(9)&&p2dist x<ifelse(teamside=1,1,0)&&statetype!=A&&(ctrl||stateno=[0,13])
fvar(9) = -fvar(9)

[State 0, 3]
type = ChangeAnim
trigger1 = fvar(9)&&p2dist x<ifelse(teamside=1,1,0)&&statetype!=A&&(ctrl||stateno=[0,13])
value = ifelse(statetype=C,6,5)

[State 0, 3]
type = turn
trigger1 = fvar(9)&&p2dist x<ifelse(teamside=1,1,0)&&statetype!=A&&(ctrl||stateno=[0,13])

[state -2]
type = velset
trigger1 = fvar(9)&&(!fvar(5)||(enemynear,backedgebodydist>5&&enemynear,frontedgebodydist>5))
x = fvar(9)+fvar(8)

[state -2]
type = varset
trigger1 = (fvar(9)=(-.5,0])||(fvar(9)=[0,.5))
trigger2 = movetype=H
fvar(9) = 0

[state -2]
type = varset
triggerall = !(stateno=3000&&AnimElemTime(1)>=1&&AnimElemTime(1)<31&&Anim=3000)&&!(stateno=3010&&AnimElemTime(3)>=0&&AnimElemTime(3)<30&&Anim=3010)&&!(stateno=3100&&Anim=3100&&AnimElemTime(2)>=0&&AnimElemTime(2)<30)
triggerall = !(stateno=3500&&AnimElemTime(4)>=0&&AnimElemTime(7)<=0)
trigger1 = fvar(9)&&(fvar(10)!=[49,50])&&(fvar(10)=[0,60])&&!(var(52)>1&&movecontact)
fvar(9) = ifelse(!fvar(10),fvar(9)*.9,fvar(9)*.97)

[state -2]
type = varset
trigger1 = movetype=H
fvar(10) = 0

[state -2]
type = varadd
triggerall = !(stateno=3000&&AnimElemTime(1)>=1&&AnimElemTime(1)<31&&Anim=3000)&&!(stateno=3010&&AnimElemTime(3)>=0&&AnimElemTime(3)<30&&Anim=3010)&&!(stateno=3100&&Anim=3100&&AnimElemTime(2)>=0&&AnimElemTime(2)<30)
triggerall = !(stateno=3500&&AnimElemTime(4)>=0&&AnimElemTime(7)<=0)
trigger1 = (fvar(10)>=1||fvar(10)<=-1)&&!(var(52)>1&&movecontact)
fvar(10) = ifelse(fvar(10)<0,1,-1)

;=====BASARAゲージ増加
[state -2]
type = poweradd
trigger1 = roundstate=2&&gametime%floor(15/1.250)=0 &&!var(31) && !var(9) && !fvar(21)&&!numexplod(40000)
value = ifelse(gametime%floor(15/1.250)*10=0,ceil(1*fvar(16)*1.250),floor(1*fvar(16)*1.25))
ignorehitpause=1

[state -2]
type = poweradd
trigger1 = roundstate=2&&gametime%floor(15/1.250)=0 &&!var(31) && !var(9) && fvar(21)&&!numexplod(40000)&&life<=const(data.life)*.2
value = ifelse(gametime%floor(15/1.250)*10=0,ceil(1*fvar(16)*1.250),floor(1*fvar(16)*1.250))*4
ignorehitpause=1

[state -2]
type = poweradd
trigger1 = movetype=H&&(Power-var(55))>0&&(((stateno=5000||stateno=5010||stateno=5020||stateno=5070||stateno=5080)&&time=0)||(movetype=H&&(stateno!=[5000,5199]))) &&!var(31) && !var(9) && !fvar(21) && (prevstateno!=[4000,4020])
value = floor((Power-var(55))*(fvar(16)-1))
ignorehitpause=1

[state -2]
type = powerset
trigger1 = movetype=H&&(Power-var(55))>0&&(((stateno=5000||stateno=5010||stateno=5020||stateno=5070||stateno=5080)&&time=0)||(movetype=H&&(stateno!=[5000,5199]))) && !var(31) && var(9) && !fvar(21) && (prevstateno!=[4000,4020])
value = var(55)
ignorehitpause=1

[state -2]
type = powerset
triggerall = fvar(21)
trigger1 = !numpartner
trigger2 = numpartner
trigger2 = ID-partner,ID>0
value = 3000

[state -2]
type = varset
trigger1 = var(9)=1000
var(9) = 0
ignorehitpause=1

[state -2]
type = varadd
trigger1 = var(9)
var(9) = -1*ifelse(var(9)>=1000,((var(9)-floor(var(9)/100)*100)=[1,999]),1)-(var(9)>=1000)*100
ignorehitpause=1

;===KO・食らい関連

;音声
[state 5000]
type = PlaySND
trigger1 = (!var(10)||var(10)>=1000)&&!time&&!IsHelper&&roundstate=2
trigger1 = alive&&movetype=H&&(stateno!=[150,155])&&((gethitvar(damage)&&gethitvar(hittime))||(!gethitvar(hittime)&&!gethitvar(hitshaketime)&&(P2stateno=[1000,3999])&&P2MoveType=A&&(stateno!=[5000,5299])))&&random%2=0
value = 10,ifelse(gethitvar(hittime)>=20||(!gethitvar(hittime)&&!gethitvar(hitshaketime)),15,ifelse(gethitvar(hittime)>=17,14,ifelse(gethitvar(hittime)>=14,14,ifelse(gethitvar(hittime)>=12,13,12))))+random%2
channel = 1

[state 6980]
type = StopSND
trigger1 = !Alive
channel = 1

;ヒットスパーク
[state 1000]
type = Helper
triggerall = movecontact=1&&!((stateno=[800,801])&&Time<10)&&!(stateno=3120&&((AnimElemTime(7)>=0&&AnimElemTime(9)<0)||AnimElemTime(12)>=0&&AnimElemTime(14)<0||AnimElemTime(17)>=0&&AnimElemTime(19)<0)||AnimElemTime(22)>=0&&AnimElemTime(24)<0)
triggerall = stateno!=3500
trigger1 = numtarget
trigger1 = target,time=0&&(target,stateno=150||target,stateno=152||target,stateno=154||target,stateno=5000||target,stateno=5010||target,stateno=5020||target,stateno=5070||target,stateno=5080)
trigger2 = movetype=H
trigger3 = !numtarget && P2movetype=A&&(enemynear,prevstateno=5000||enemynear,prevstateno=5010||enemynear,prevstateno=5020||enemynear,prevstateno=5070||enemynear,prevstateno=5080)&&enemynear,time=1
id = 7000
stateno=7000+(movehit)*100
pos = var(17),var(18)
postype = p1
ownpal = 1
ignorehitpause=1
pausemovetime=99999
supermovetime=99999

;カウンターヒットエフェクト
[state -2]
type = Explod
triggerall = var(49)&&movehit=1
triggerall = !((stateno=[800,801])&&Time<10)&&!(stateno=3120&&((AnimElemTime(7)>=0&&AnimElemTime(9)<0)||AnimElemTime(12)>=0&&AnimElemTime(14)<0||AnimElemTime(17)>=0&&AnimElemTime(19)<0)||AnimElemTime(22)>=0&&AnimElemTime(24)<0)
triggerall = stateno!=3500
trigger1 = numtarget
trigger1 = target,time=0&&(target,stateno=150||target,stateno=152||target,stateno=154||target,stateno=5000||target,stateno=5010||target,stateno=5020||target,stateno=5070||target,stateno=5080)
trigger2 = movetype=H
trigger3 = !numtarget && P2movetype=A&&(enemynear,prevstateno=5000||enemynear,prevstateno=5010||enemynear,prevstateno=5020||enemynear,prevstateno=5070||enemynear,prevstateno=5080)&&enemynear,time=1
id = 7760
anim = 7760
pos = var(17),var(18)
postype = p1
ignorehitpause=1
pausemovetime=99999
supermovetime=99999
bindtime=-1
ontop = 1
ownpal = 1
scale = .5,.5

;〜〜〜ジャストディフェンス〜〜〜
[state -2]
type = varset
trigger1 = command!="holdback"&&var(30)<-7&&!var(59)
trigger2 = var(30)<-7&&var(51)%5<2&&!fvar(33)&&(stateno!=[120,132])&&var(59)
trigger3 = (stateno=21||stateno=40||stateno=45||stateno=100||stateno=110||(stateno=[310,320])||(stateno=[1000,3999]))&&var(59)
var(30) = 0
ignorehitpause=1

[state -2]
type = varadd
trigger1 = var(30)<0
var(30) = -1
ignorehitpause=1

[state -2]
type = varset
trigger1 = command="holdback"&&!var(30)&&!var(59)
trigger2 = (((fvar(33)-floor(fvar(33)))>.15)||((stateno=[150,155])&&time>=(gethitvar(hittime)-4))||((stateno=151||stateno=153||stateno=155)&&var(51)%3=0&&(enemynear,prevstateno!=[0,179])&&(P2stateno!=[0,179])&&P2movetype!=H&&random%3<2))
trigger2 = var(51)%11<ifelse(P2bodydist X>120,6,4)&&random%5<2&&!var(30)&&var(59)
trigger3 = (Pos Y=[-35,-1])&&Vel Y<-9&&!var(30)&&var(59)
var(30) = -1
ignorehitpause=1

;ジャストディフェンス移行
[state -2]
type = ChangeState
trigger1 = time=0 && (stateno=150||stateno=152||stateno=154) && (var(30)=[-6,-1]) && !var(31)
value = 4000+ceil((stateno-150)*5)

;成功判別エフェクト
[state 8000]
type = RemoveExplod
trigger1 = (stateno!=[150,155])||ctrl
id = 7706
;〜〜〜パーフェクトガード〜〜〜

[state -2]
type = varadd
trigger1 = var(31)<-1||var(31)>0
var(31) = 1
ignorehitpause=1

[state -2]
type = varset
triggerall = !var(31)&&power>0
;triggerall = (ctrl||(stateno=[0,50])||(stateno=[100,101])||(stateno=[120,140])||(stateno=[150,155])||((prevstateno!=[52,1999])&&((stateno=[200,210])||(stateno=[400,410]))&&time<4))&&!var(31)&&!var(34)
trigger1 = command="holdback"&&ifelse((stateno=210||stateno=410),command="hold_x",ifelse((stateno=200||stateno=400),command="hold_y",command="hold_x"&&command="hold_y"))&&!var(59)
trigger2 = stateno=5210 && (P2bodydist Y=[0,100]) && (P2bodydist X=[-15,80]) && (time=[8,10]) && var(51)%5<ifelse(Power>=1500,4,3) && var(59)
trigger3 = (P2statetype!=A||(P2statetype=A&&enemynear,pos Y>-40&&enemynear,vel Y<0)) && P2bodydist X<=80 && (Pos Y=[-80-(vel Y>6)*15,-40-(vel Y>6)*15]) && random%3=0 && vel Y>0 && Statetype=A && var(51)%5<3 && var(59)
trigger4 = statetype=A && (ctrl||(stateno=[154,155])||(stateno=[120,132])||stateno=5210) && Pos Y>ifelse(vel Y>7,-40,-25) && Power>=500 && vel Y>=0 && (P2bodydist X=[-15,80]) && !var(2) && var(59)
trigger4 = ifelse((ctrl||(stateno=[120,132])),var(51)<=ifelse(power<1500,250,320),1) && !((P2stateno=[5910,5929])||(P2stateno=[15910,15929])) && var(59)
trigger5 = ((stateno=[150,155])||(Anim=[5120,5121]))&&ifelse(life<=60,random<=100,random<=ifelse((Anim=[5120,5121])&&animtime>-2 && var(51)<=350,350,ifelse((stateno=151||stateno=153)&&(time=[6,10]) && var(51)<=200,200,25)))
trigger5 = Power>=ifelse(var(51)%5<3,1500,500)&&!numexplod(7705) && (P2bodydist X=[-15,60]) && var(59)
var(31) = -ifelse(NumExplod(7705),1,5)

[state -2]
type = varset
trigger1 = !power||(movetype=H&&(stateno!=[150,155])&&!(statetype=A&&(stateno=[5020,5070]))&&stateno!=4120)
trigger2 = (((command!="holdback"||command!="hold_x"||command!="hold_y")&&!var(59))||(P2bodydist X>80&&statetype!=A&&var(59)))
trigger3 = !(statetype=A && (ctrl||(stateno=[154,155])||(stateno=[120,132])||stateno=5210) && Pos Y>ifelse(vel Y>7,-40,-25) && vel Y>=0 && !var(11) && !var(2))&&stateno!=52&&random<=200&&!fvar(33)&&(stateno!=[150,155])&&var(59)
trigger4 = (((stateno=[130,131])&&time>=30)||((stateno=[150,153])&&ifelse(power<1000,gametime%8=0,gametime%16=0)&&!numexplod(7705)))&&statetype!=A&&var(59)
var(31) = 0
ignorehitpause=1

;ヒット時間用
[state 1000]
type = varset
trigger1 = var(31)<0&&movetype=H&&gethitvar(hittime)
var(47) = gethitvar(hittime)

;ヒット時間用
[state 1000]
type = varset
trigger1 = var(31)<0&&movetype=H&&gethitvar(ctrltime)
var(47) = gethitvar(ctrltime)

;自動減少
[state 150,2]
type = PowerAdd
trigger1 = var(31)!=0 && (ctrl||(stateno=[0,50])||(stateno=[100,101])||(stateno=[120,155]))
value = -floor(4*ifelse(statetype=A,2.0,ifelse(statetype=C,1.5,1)))

[State 150, 2]
type = LifeAdd
trigger1 = var(31)>0
trigger1 = stateno=150||stateno=152||stateno=154
value = gethitvar(damage)

;開始時ゲージ消費
[state -2]
type = PowerAdd
trigger1 = (ctrl||(stateno=[0,50])||(stateno=[100,101])||((prevstateno!=[52,1999])&&((stateno=[200,210])||(stateno=[400,410]))&&time<4))&&(stateno!=[120,132])&&(prevstateno!=[150,155])&&(prevstateno!=[4120,4130]) && var(31)<0
value = -floor(40*ifelse(statetype=A,2.0,ifelse(statetype=C,1.5,1))*1.250)

;ゲージ増加停止
[state -2]
type = varset
trigger1 = var(31)!=0
var(9) = 60
ignorehitpause=1

;パーフェクトガード開始動作移行
[state -2]
type = ChangeState
trigger1 = (ctrl||(stateno=[0,50])||(stateno=[100,101])||((prevstateno!=[52,1999])&&((stateno=[200,210])||(stateno=[400,410]))&&time<4))&&(stateno!=[120,132]) && var(31)<0 && movetype!=H
value = 120

;パーフェクトガード移行
[state -2]
type = ChangeState
trigger1 = time=0 && (stateno=150||stateno=152||stateno=154) && var(31)
value = 4100+ceil((stateno-150)*5)

;パーフェクトガード移行
[state -2]
type = ChangeState
trigger1 = statetype=A && var(31)&&stateno=5020 && (prevstateno=[120,155])
value = 4120

;エフェクト1
[state 8000]
type = PlaySND
trigger1 = !numhelper(7700)&&var(31)&&(ctrl||(stateno=[0,50])||(stateno=[120,140]))
value = 4100,0
ignorehitpause=0

;エフェクト1
[state 8000]
type = Helper
trigger1 = !numhelper(7700)&&var(31)&&(ctrl||(stateno=[0,50])||(stateno=[120,155]))
id = 7700
stateno = 7700
pos = 0,-floor(180*const(size.yscale))
postype = p1
sprpriority = 3
ownpal = 1
ignorehitpause=0
size.xscale = const(size.xscale)
size.yscale = const(size.yscale)

;ジャストパーフェクトガード使用不能時間
[state 8000]
type = Explod
trigger1 = !numexplod(7705)&&var(31)=-5
id = 7705
anim = 90000
pos = 0,-floor(90*const(size.yscale))
postype = p1
sprpriority = 3
bindtime=-1
ownpal = 1
ignorehitpause=1
removetime = 24

;成功判別エフェクト
[state 8000]
type = RemoveExplod
trigger1 = ((stateno!=[150,155])&&(stateno!=[4120,4130]))||ctrl
id = 7701

;成功判別エフェクト
[state 8000]
type = RemoveExplod
trigger1 = ((stateno!=[150,155])&&(stateno!=[4120,4130]))||ctrl
id = 7702

;==対戦相手判別（KO後はenemyの情報が入らないため）
[state -2]
type = VarSet
trigger1 = roundstate<2
fvar(11) = 0

;政宗
[state -2,Name]
type = VarSet
trigger1 = P2name="Date Masamune"||P4name="Date Masamune"||P2name="Masamune"||P4name="Masamune"
fvar(11) = 1

;幸村
;炎使い
[state -2,Name]
type = VarSet
trigger1 = P2name="Sanada Yukimura"||P4name="Sanada Yukimura"||P2name="Yukimura"||P4name="Yukimura"
trigger2 = P2name="Avdol"||P4name="Avdol"||P2name="Sol"||P4name="Sol"||P2name="Sol Budgy"||P4name="Sol Budgy"
fvar(11) = 2

;慶次
[state -2,Name]
type = VarSet
trigger1 = P2name="Maeda Keiji"||P4name="Maeda Keiji"||P2name="Keiji"||P4name="Keiji"
fvar(11) = 3

;謙信
[state -2,Name]
type = VarSet
trigger1 = P2name="Uesugi Kenshin"||P4name="Uesugi Kenshin"||P2name="Kenshin"||P4name="Kenshin"
fvar(11) = 4

;お市
[state -2,Name]
type = VarSet
trigger1 = P2name="Oichi"||P4name="Oichi"
fvar(11) = 5

;元親
[state -2,Name]
type = VarSet
trigger1 = P2name="Chousokabe Motochika"||P4name="Chousokabe Motochika"||P2name="Motochika"||P4name="Motochika"
fvar(11) = 6

;元就
;==army(軍隊系)
[state -2,Name]
type = VarSet
trigger1 = P2name="Mouri Motonari"||P4name="Mouri Motonari"||P2name="Motonari"||P4name="Motonari"
trigger2 = P2name="KFMa4B"||P4name="KFMa4B"||P2name="SarutabarutaMUSOU"||P4name="SarutabarutaMUSOU"||P2name="Maori"||P4name="Maori"
trigger3 = numenemy>3 && ((enemy,teammode=single)||(enemy,teammode=turns))
trigger4 = numenemy>5 && (enemy,teammode=simul)
fvar(11) = 7

;秀吉
[state -2,Name]
type = VarSet
trigger1 = P2name="Toyotomi Hideyoshi"||P4name="Toyotomi Hideyoshi"||P2name="Hideyoshi"||P4name="Hideyoshi"
fvar(11) = 8

;信長
;魔王
[state -2,Name]
type = VarSet
trigger1 = P2name="Oda Nobunaga"||P4name="Oda Nobunaga"||P2name="Nobunaga"||P4name="Nobunaga"
trigger2 = P2name="Maou"||P4name="Maou"
fvar(11) = 9

;小十郎
[state -2,Name]
type = VarSet
trigger1 = P2name="Katakura Kojuro"||P4name="Katakura Kojuro"||P2name="Kojuro"||P4name="Kojuro"
fvar(11) = 11

;半兵衛
[state -2,Name]
type = VarSet
trigger1 = P2name="Takenaka Hambe"||P4name="Takenaka Hambe"||P2name="Hambe"||P4name="Hambe"
fvar(11) = 12

;オリジナル

;ザコ
[state -2,Name]
type = VarSet
trigger1 = P2name="twelve"||P4name="twelve"||P2name="zaku"||P4name="zaku"
fvar(11) = 50

;=================================
;ダッシュコマンド(Dash Command)
[state -2]
type = varSet
trigger1 = (floor(fvar(13))=7||floor(fvar(13))=-7)
trigger2 = (floor(fvar(13))=14||floor(fvar(13))=-14)
trigger3 = (floor(fvar(13))=16||floor(fvar(13))=-16)
trigger4 = (fvar(13)>=18||fvar(13)<=-18)
fvar(13) = 0
ignorehitpause=1

[state -2]
type = varAdd
trigger1 = fvar(13)
fvar(13) = ifelse(fvar(13)<0,-1,1)
ignorehitpause=1

[state -2]
type = varSet
triggerall =(floor(fvar(13))=[15,16])
trigger1 = command="holdfwd"&&P2dist X>=0
trigger2 = command="holdback"&&P2dist X<0
fvar(13) = 17
ignorehitpause=1

[state -2]
type = varSet
triggerall = ((floor(fvar(13))=[1,7])||(floor(fvar(13))=[8,14]))&&fvar(13)-floor(fvar(13))!=.1
trigger1 = (command="back"||command="backup"||command="backdown")&&P2dist X>=0
trigger2 = (command="fwd"||command="fwdup"||command="fwddown")&&P2dist X<0
trigger3 = (command="up"||command="down")&&((command!="holdfwd"&&P2dist X>=0)||(command!="holdback"&&P2dist X<0))
fvar(13) = 0
ignorehitpause=1

[state -2]
type = varSet
triggerall = (floor(fvar(13))=[8,14])||((floor(fvar(13))=[-14,-8])&&fvar(13)-floor(fvar(13))=-.1&&(command="fwd"||command="fwdup"||command="fwddown"))
trigger1 = (command="fwd"||command="fwdup"||command="fwddown")&&P2dist X>=0
trigger2 = (command="back"||command="backup"||command="backdown")&&P2dist X<0
fvar(13) = 15
ignorehitpause=1

[state -2]
type = varset
triggerall = (floor(fvar(13))=[1,7])
trigger1 = command!="holdfwd"&&command!="holdback"&&command!="holdup"&&command!="holddown"
fvar(13) = 8+(fvar(13)-floor(fvar(13))=.1)*.1
ignorehitpause=1

[state -2]
type = varSet
triggerall = fvar(13)<=0
trigger1 = (command="fwd"||command="fwdup"||command="fwddown")&&P2dist X>=0
trigger2 = (command="back"||command="backup"||command="backdown")&&P2dist X<0
fvar(13) = 1+(command="back"||command="backup"||command="backdown")*.1
ignorehitpause=1

;BackStep
[state -2]
type = varSet
triggerall = (floor(fvar(13))=[-16,-15])
trigger1 = command="holdback"&&P2dist X>=0
trigger2 = command="holdfwd"&&P2dist X<0
fvar(13) = -17
ignorehitpause=1

[state -2]
type = varSet
triggerall = ((floor(fvar(13))=[-7,-1])||(floor(fvar(13))=[-14,-8]))&&fvar(13)-floor(fvar(13))!=-.1
trigger1 = (command="fwd"||command="fwdup"||command="fwddown")&&P2dist X>=0
trigger2 = (command="back"||command="backup"||command="backdown")&&P2dist X<0
trigger3 = (command="up"||command="down")&&((command!="holdback"&&P2dist X>=0)||(command!="holdfwd"&&P2dist X<0))
fvar(13) = 0
ignorehitpause=1

[state -2]
type = varSet
triggerall = (floor(fvar(13))=[-14,-8])||((floor(fvar(13))=[8,14])&&fvar(13)-floor(fvar(13))=.1&&(command="back"||command="backup"||command="backdown"))
trigger1 = (command="back"||command="backup"||command="backdown")&&P2dist X>=0
trigger2 = (command="fwd"||command="fwdup"||command="fwddown")&&P2dist X<0
fvar(13) = -15
ignorehitpause=1

[state -2]
type = varset
triggerall = (floor(fvar(13))=[-7,-1])
trigger1 = command!="holdfwd"&&command!="holdback"&&command!="holdup"&&command!="holddown"
fvar(13) = -8-(fvar(13)-floor(fvar(13))=-.1)*.1
ignorehitpause=1

[state -2]
type = varSet
triggerall = fvar(13)>=0
trigger1 = (command="back"||command="backup"||command="backdown")&&P2dist X>=0
trigger2 = (command="fwd"||command="fwdup"||command="fwddown")&&P2dist X<0
fvar(13) = -1-(command="fwd"||command="fwdup"||command="fwddown")*.1
ignorehitpause=1


;○○SP取得時ボイス○○
;=====本体======
[state -2]
type = varset
trigger1 = roundstate=0
var(10) = 0

[state -2]
type = varadd
trigger1 = var(10)>0
var(10) = -1
ignorehitpause=1

;==First Hit
;◆相手キャラ別◆
[state -2]
type = playsnd
triggerall = movetype!=H&&numexplod(8799)&&var(44)%2<1&&!var(10)&&roundstate=2
triggerall = enemynear,name="date masamune"&&random%2=0
trigger1 = movehit=1&&stateno!=801
trigger1 = var(10) := floor(182*(TicksPerSecond/60))
value = 10,78
channel = 1
ignorehitpause=1
;3.032sec

[state -2]
type = playsnd
triggerall = movetype!=H&&numexplod(8799)&&var(44)%2<1&&!var(10)&&roundstate=2
triggerall = enemynear,name="sanada yukimura" && random%2=0
trigger1 = movehit=1&&stateno!=801
trigger1 = var(10) := floor(244*(TicksPerSecond/60))
value = 10,79
channel = 1
ignorehitpause=1
;4.056sec

[state -2]
type = playsnd
triggerall = movetype!=H&&numexplod(8799)&&var(44)%2<1&&!var(10)&&roundstate=2
triggerall = (enemynear,name="maeda keiji"||enemynear,name="keiji") && random%2=0
trigger1 = movehit=1&&stateno!=801
trigger1 = var(10) := floor(119*(TicksPerSecond/60))
value = 10,80
channel = 1
ignorehitpause=1
;1.978sec

[state -2]
type = playsnd
triggerall = movetype!=H&&numexplod(8799)&&var(44)%2<1&&!var(10)&&roundstate=2
triggerall = (enemynear,name="mouri motonari"||enemynear,name="motonari") && random%2=0
trigger1 = movehit=1&&stateno!=801
trigger1 = var(10) := floor(251*(TicksPerSecond/60))
value = 10,81
channel = 1
ignorehitpause=1
;4.178sec

[state -2]
type = playsnd
triggerall = movetype!=H&&numexplod(8799)&&var(44)%2<1&&!var(10)&&roundstate=2
triggerall = (enemynear,name="toyotomi hideyoshi"||enemynear,name="hidyoshi") && random%2=0
trigger1 = movehit=1&&stateno!=801
trigger1 = var(10) := floor(204*(TicksPerSecond/60))
value = 10,82
channel = 1
ignorehitpause=1
;3.385sec

[state -2]
type = playsnd
triggerall = movetype!=H&&numexplod(8799)&&var(44)%2<1&&!var(10)&&roundstate=2
triggerall = (enemynear,name="oda nobunaga"||enemynear,name="nobunaga") && random%2=0
trigger1 = movehit=1&&stateno!=801
trigger1 = var(10) := floor(208*(TicksPerSecond/60))
value = 10,83
channel = 1
ignorehitpause=1
;3.459sec

[state -2]
type = playsnd
triggerall = movetype!=H&&numexplod(8799)&&var(44)%2<1&&!var(10)&&roundstate=2
triggerall = (enemynear,name="uesugi kenshin"||enemynear,name="kenshin") && random%2=0
trigger1 = movehit=1&&stateno!=801
trigger1 = var(10) := floor(205*(TicksPerSecond/60))
value = 10,84
channel = 1
ignorehitpause=1
;3.411sec

[state -2]
type = playsnd
triggerall = movetype!=H&&numexplod(8799)&&var(44)%2<1&&!var(10)&&roundstate=2
triggerall = (enemynear,name="oichi") && random%2=0
trigger1 = movehit=1&&stateno!=801
trigger1 = var(10) := floor(214*(TicksPerSecond/60))
value = 10,85
channel = 1
ignorehitpause=1
;3.557sec

[state -2]
type = playsnd
triggerall = movetype!=H&&numexplod(8799)&&var(44)%2<1&&!var(10)&&roundstate=2
triggerall = (enemynear,name="honda tadakatsu"||enemynear,name="tadakatsu") && random%2=0
trigger1 = movehit=1&&stateno!=801
trigger1 = var(10) := floor(208*(TicksPerSecond/60))
value = 10,86
channel = 1
ignorehitpause=1
;3.459sec

[state -2]
type = playsnd
triggerall = movetype!=H&&numexplod(8799)&&var(44)%2<1&&!var(10)&&roundstate=2
triggerall = (enemynear,name="katakura kojuro"||enemynear,name="kojuro") && random%2=0
trigger1 = movehit=1&&stateno!=801
trigger1 = var(10) := floor(209*(TicksPerSecond/60))
value = 10,87
channel = 1
ignorehitpause=1
;3.483sec

[state -2]
type = playsnd
triggerall = movetype!=H&&numexplod(8799)&&var(44)%2<1&&!var(10)&&roundstate=2
triggerall = (enemynear,name="takenaka hambe"||enemynear,name="hambe") && random%2=0
trigger1 = movehit=1&&stateno!=801
trigger1 = var(10) := floor(166*(TicksPerSecond/60))
value = 10,88
channel = 1
ignorehitpause=1
;2.758sec

;◆凡庸◆
[state -2]
type = playsnd
triggerall = movetype!=H&&numexplod(8799)&&var(44)%2<1&&!var(10)&&roundstate=2
trigger1 = movehit=1&&stateno!=801
trigger1 = var(10) := floor(176*(TicksPerSecond/60))
value = 10,77
channel = 1
ignorehitpause=1
;2.927sec

;~~firsthit取られ
[state -2]
type = varset
trigger1 = movetype=H && (stateno!=[150,155])&&numexplod(8799)&&var(44)%2<1&&roundstate=2 && !numexplod(40000) && alive
var(10) = 1180
ignorehitpause=1

[state -2]
type = playsnd
triggerall = var(10)=1000&&roundstate=2 && !numexplod(40000) && alive
trigger1 = var(10) := floor(237*(TicksPerSecond/60))
value = 10,193
channel = 1
ignorehitpause=1
;3.948sec

;◆Reversal◆
[state -2]
type = PlaySND
trigger1 = ((fvar(27)-floor(fvar(27)))=[.1,.3))&&(stateno=105||(stateno=[200,999])||var(34)||(stateno=[1000,1999])||(stateno=[3000,3999]))&&time<=1&&Movetype!=H&&!var(10)
trigger1 = var(10) := floor(60*(TicksPerSecond/60))
value = 10,7
channel = 1
;0.989sec

;◆特殊食らい◆
;気絶時
;俺はぁ…鬼ぃ…
[state -2]
type = PlaySND
trigger1 = !var(10)&&anim=5300&&time=1&&roundstate=2&&!numexplod(40000)
trigger1 = var(10) := floor(113*(TicksPerSecond/60))
value = 10,20
channel = 1
;1.876sec

;よろけ時
;うぁ！
[state -2]
type = PlaySND
trigger1 = !var(10)&&anim=5910&&time=1&&(stateno%10000!=[5910,5935])&&roundstate=2&&!numexplod(40000)
trigger1 = var(10) := floor(26*(TicksPerSecond/60))
value = 10,21
channel = 1
;0.424sec

;体力吸収され・毒食らい時
;おい、こりゃなんだ！？
[state -2]
type = PlaySND
trigger1 = !var(10)&&enemynear,name="Oda Nobunaga"&&0;未対応
trigger1 = var(10) := floor(66*(TicksPerSecond/60))
trigger2 = !var(10)&&enemynear,name="Lin"&&P2stateno=2510&&stateno=2520&&time=190&&roundstate=2&&!numexplod(40000)
trigger2 = var(10) := floor(66*(TicksPerSecond/60))
value = 10,22
channel = 1
;0.424sec

;当て身取られた時
;うわぁ！
[state -2]
type = PlaySND
trigger1 = !var(10)&&P2movetype=A&&movereversed&&(stateno!=[5000,5999])&&roundstate=2&&!numexplod(40000)
trigger1 = var(10) := floor(37*(TicksPerSecond/60))
value = 10,23
channel = 1
;0.607sec

;四縛食らい時
;おいおい…嘘だろ…
[state -2]
type = PlaySND
trigger1 = !var(10) && MoveType=H&&time=0&&P2Name="Chousokabe Motochika" && enemynear,numhelper(6410)
trigger1 = var(10) := floor(151*(TicksPerSecond/60))
value = 10,24
channel = 1
;2.513sec

;被ガードクラッシュ時
;おいっ！？
[state -2]
type = PlaySND
trigger1 = !var(10)&&anim=5910&&time=1&&(stateno%10000=[5910,5935])&&roundstate=2&&!numexplod(40000)
trigger1 = var(10) := floor(45*(TicksPerSecond/60))
value = 10,32
channel = 1
;0.747sec

;吹き飛ばし防御時
;チクショお！
[state -2]
type = PlaySND
trigger1 = !var(10)&&anim=154&&(stateno=151||stateno=153)&&time=1&&roundstate=2&&!numexplod(40000)
trigger1 = var(10) := floor(60*(TicksPerSecond/60))
value = 10,33
channel = 1
;0.990sec

;◆相手援軍要請◆

[state -2]
type = VarSet
trigger1 = !var(10)&&roundstate=2&&!numexplod(40000)&&alive
trigger1 = enemynear,fvar(39)=7&&(enemynear,authorname="rei"||enemynear,authorname="gal129")&&enemynear,var(40)=-10
trigger2 = enemynear,authorname="Ahuron"&&enemynear,name="Keiji"&&enemynear,var(40)=-10
trigger3 = (enemynear,authorname="Neat Unsou"||enemynear,authorname="syouga")&&enemynear,var(40)=1&&enemynear,var(46)=660
trigger4 = enemynear,name="Mukuro"&&enemynear,authorname="ahuron"&&enemynear,stateno=12600 && enemynear,time=1
trigger5 = enemynear,name="bonus game"&&enemynear,authorname="BK"&&(gametime%960=[0,120])&&gametime%2=0&&random%70=0
var(10) = floor(242*(TicksPerSecond/60))
channel = 1
ignorehitpause=1
;4.023sec

;ちんけな策弄しやがって！面白え！
[state -2]
type = PlaySND
trigger1 = roundstate=2&&!numexplod(40000)&&(stateno!=[1000,3999])&&alive&&var(10)=2000
trigger1 = var(10) := floor(242*(TicksPerSecond/60))
value = 10,191
channel = 1
ignorehitpause=1
;4.023sec

;◆◆自分コンボ中◆◆
;この俺をなめてもらっちゃ困るってもんよ！
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&!numexplod(40000)&&(stateno!=[1000,3999])&&alive&&movetype!=H&&var(50)%100=0&&life>enemynear,life&&(enemynear,life*100.0/enemynear,const(data.life))<75&&var(2)>=10
trigger1 = movehit=1&&numtarget
trigger1 = target,time=0
trigger1 = var(10) := floor(189*(TicksPerSecond/60))
value = 10,175
channel = 1
ignorehitpause=1
;3.137sec

;122〜133;相手キャラ用

;◆◆自分不利◆◆
;なんだあ？痛くもかゆくもねえ！…
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&!numexplod(40000)&&(stateno!=[1000,3999])&&alive&&movetype!=H&&var(50)%720=0&&life<enemynear,life&&((life*100.0/const(data.life))=(600,800])
trigger1 = var(10) := floor(326*(TicksPerSecond/60))
value = 10,61
channel = 1
ignorehitpause=1
;5.417sec

;ちっ、田舎もんがよー！
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&!numexplod(40000)&&(stateno!=[1000,3999])&&alive&&movetype!=H&&var(50)%600=0&&life<enemynear,life&&((life*100.0/const(data.life))=(400,600])
trigger1 = var(10) := floor(191*(TicksPerSecond/60))
value = 10,62
channel = 1
ignorehitpause=1
;3.167sec

;こんなの！嵐に比べりゃどうってことねえ！
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&!numexplod(40000)&&(stateno!=[1000,3999])&&alive&&movetype!=H&&var(50)%480=0&&life<enemynear,life&&((life*100.0/const(data.life))=(200,400])
trigger1 = var(10) := floor(198*(TicksPerSecond/60))
value = 10,63
channel = 1
ignorehitpause=1
;3.297sec

;◆◆自分有利◆◆
;食われたくねぇんなら逃げた方がいいぜ！
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&!numexplod(40000)&&(stateno!=[1000,3999])&&alive&&movetype!=H&&var(50)%3=0&&gametime%360=0
trigger1 = ((life*100.0/const(data.life))=(60,80]) && ((enemynear,life*100.0/enemynear,const(data.life))=[20,40))
trigger1 = var(10) := floor(162*(TicksPerSecond/60))
value = 10,122
channel = 1
ignorehitpause=1
;2.690sec

;はっはっは！刺激のねぇ戦だな！
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&!numexplod(40000)&&(stateno!=[1000,3999])&&alive&&movetype!=H&&var(50)%3=0&&gametime%360=0
trigger1 = ((life*100.0/const(data.life))=(80,100]) && ((enemynear,life*100.0/enemynear,const(data.life))=(0,20))
trigger1 = 0;var(10) := floor(215*(TicksPerSecond/60))
value = 10,121
channel = 1
ignorehitpause=1
;3.577sec

;それで本気なのか？うん？
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&!numexplod(40000)&&(stateno!=[1000,3999])&&alive&&movetype!=H&&var(50)%3=0&&gametime%360=0
trigger1 = life>enemynear,life && ((enemynear,life*100.0/enemynear,const(data.life))=[40,60))
trigger1 = var(10) := floor(158*(TicksPerSecond/60))
value = 10,59
channel = 1
ignorehitpause=1
;2.620sec

;相手になんねーか！？はっはっは！
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&!numexplod(40000)&&(stateno!=[1000,3999])&&alive&&movetype!=H&&var(50)%3=0&&gametime%360=0
trigger1 = life>enemynear,life && ((enemynear,life*100.0/enemynear,const(data.life))=[60,80))
trigger1 = var(10) := floor(169*(TicksPerSecond/60))
value = 10,58
channel = 1
ignorehitpause=1
;2.809sec

;あんた？鬼との闘い方を知ってんのかい？
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&!numexplod(40000)&&(stateno!=[1000,3999])&&alive&&movetype!=H&&var(50)%3=0&&gametime%360=0
trigger1 = life>enemynear,life && ((enemynear,life*100.0/enemynear,const(data.life))=[80,100))
trigger1 = var(10) := floor(236*(TicksPerSecond/60))
value = 10,176
channel = 1
ignorehitpause=1
;3.930sec

;~~コンボ成功
;これが鬼の名を持つ俺の実力よ！はっはっは！
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&!numexplod(40000)&&P2statetype=L&&var(3)>=13&&var(50)<500&&random%3=0
trigger1 = var(10) := floor(308*(TicksPerSecond/60))
value = 10,60
channel = 1
ignorehitpause=1
;5.130sec

;◆◆自分・相手体力僅差
;どうした？なんとか言えよこら！
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&!numexplod(40000)&&(stateno!=[1000,3999])&&alive&&movetype!=H&&!var(2)&&var(50)%3=0&&gametime%300=0
trigger1 = life>=enemynear,life && ((enemynear,life*100.0/enemynear,const(data.life))=[80,100])
trigger1 = var(10) := floor(215*(TicksPerSecond/60))
value = 10,57
channel = 1
ignorehitpause=1
;3.568sec

;◆◆一定時間◆◆
;やれやれ…他での戦は窮屈だぜ…
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&!numexplod(40000)&&(stateno!=[1000,3999])&&alive&&movetype!=H&&!var(2)&&var(50)%90=0&&gametime%2=0&&gametime%8600=[1900+(teamside=2)*360,2000+(teamside=2)*360]
trigger1 = var(10) := floor(250*(TicksPerSecond/60))
value = 10,134
channel = 1
ignorehitpause=1
;4.151sec

;どうした？もっと本気出しても構わねぇぜ？
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&!numexplod(40000)&&(stateno!=[1000,3999])&&alive&&movetype!=H&&!var(2)&&var(50)%90=0&&gametime%2=0&&gametime%8600=[2900+(teamside=2)*360,3000+(teamside=2)*360]
trigger1 = var(10) := floor(240*(TicksPerSecond/60))
value = 10,135
channel = 1
ignorehitpause=1
;3.986秒

;やっぱ俺…戦いってやつが好きだわ！
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&!numexplod(40000)&&(stateno!=[1000,3999])&&alive&&movetype!=H&&!var(2)&&var(50)%90=0&&gametime%2=0&&gametime%8600=[3900+(teamside=2)*360,4000+(teamside=2)*360]
trigger1 = var(10) := floor(191*(TicksPerSecond/60))
value = 10,136
channel = 1
ignorehitpause=1
;3.173sec

;122~131相手キャラ用

[state -2]
type = varset
trigger1 = var(10)=1000||var(10)=2000||roundstate=3
var(10) = 0
ignorehitpause=1

;=====援軍======
[state -2]
type = varset
trigger1 = 1
var(11) = 0
ignorehitpause=1

;援軍壁コン
[state -2]
type = varset
triggerall = var(44)%8192<4096 && (var(1)%2>=1||var(1)%8>=4) && !(P2stateno=927&&P2movetype=H)
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2
var(11) = 1

;援軍エリアル
[state -2]
type = varset
triggerall = var(44)%16384<8192 && var(1)%4>=2 && var(1)%2<1 && var(1)%8<4
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2
var(11) = 1

;~~~通常技単発ヒット~~~
[state -2]
type = varset
triggerall = !var(2)||(var(34)=210&&(var(35)=[1,2])&&var(19)&&var(2)=1)
trigger1 = var(44)%262144>=131072&&var(44)%524288>=262144&&stateno=220&&movehit=1&&var(44)%1048576<524288
trigger2 = var(44)%262144>=131072&&var(44)%1048576>=524288&&((stateno=210&&movehit=1)||(var(34)=210&&(var(35)=[1,2])&&var(19)))&&var(44)%524288<262144
trigger3 = var(44)%524288>=262144&&var(44)%1048576>=524288&&stateno=200&&movehit=1&&var(44)%262144<131072
var(11) = 1
ignorehitpause=1

[state -2]
type = varset
triggerall = !var(2)
trigger1 = var(44)%2097152>=1048576&&var(44)%4194304>=2097152&&stateno=420&&movehit=1&&var(44)%8388608<4194304
trigger2 = var(44)%2097152>=1048576&&var(44)%8388608>=4194304&&stateno=410&&movehit=1&&var(44)%4194304<2097152
trigger3 = var(44)%4194304>=2097152&&var(44)%8388608>=4194304&&((stateno=400&&movehit=1)||(var(34)=400&&(var(35)=[1,2])&&var(19)))&&var(44)%2097152<1048576
var(11) = 1
ignorehitpause=1

[state -2]
type = varset
triggerall = !var(2)
trigger1 = var(44)%16777216>=8388608&&var(44)%33554432>=16777216&&stateno=620&&movehit=1&&var(44)%67108864<33554432
trigger2 = var(44)%16777216>=8388608&&var(44)%67108864>=33554432&&stateno=610&&movehit=1&&var(44)%33554432<16777216
trigger3 = var(44)%33554432>=16777216&&var(44)%67108864>=33554432&&stateno=600&&movehit=1&&var(44)%16777216<8388608
var(11) = 1
ignorehitpause=1

[state -2]
type = varset
trigger1 = (P2bodydist X=[40,80])&&P2movetype=A&&inguarddist&&stateno=105&&time=1
var(11) = 1
ignorehitpause=1

[state -2]
type = varset
trigger1 = var(39)>=600 && roundstate=2
var(11) = 1
ignorehitpause=1

;en first hit
[state -2]
type = Varset
triggerall = var(44)%2048<1024 && numexplod(8798)
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2
trigger2 = numhelper(20000)
trigger2 = helper(20000),var(11)=2
var(11) = 2
ignorehitpause=1

;☆スタイリッシュポイント☆

;~~~回数制限あり~~~
;ファーストアタック
[state -2]
type = varadd
triggerall = movetype!=H&&numexplod(8799)&&var(44)%2<1
trigger1 = movehit=1&&stateno!=801
trigger2 = numhelper(6300)
trigger2 = (helper(6300),movehit=[1,2])
trigger3 = numhelper(3107)
trigger3 = (helper(3107),movehit=[1,2])
trigger4 = numhelper(3555)
trigger4 = (helper(3555),movehit=[1,2])
fvar(15) = .05
ignorehitpause=1

[state -2]
type = varadd
trigger1 = stateno=900&&movehit=1&&var(44)%4<2
fvar(15) = .10
ignorehitpause=1

[state -2]
type = varadd
trigger1 = stateno=801&&movehit=1&&var(44)%8<4
fvar(15) = .05
ignorehitpause=1

[state -2]
type = varadd
trigger1 = stateno=910&&movehit=1&&var(44)%16<8
fvar(15) = .10
ignorehitpause=1

;劣勢で挑発
[state -2]
type = varadd
trigger1 = (Life<=const(data.life)*.2||Life<=enemynear,life*.5)&&stateno=195&&animTime=-1&&var(44)%32<16
fvar(15) = .05
ignorehitpause=1

;BASARA技ヒット
[state -2]
type = varadd
triggerall = var(44)%64<32
trigger1 = (stateno=[3000,3199])&&movehit=1
trigger2 = numhelper(6300)
trigger2 = (helper(6300),movehit=[1,2])
fvar(15) = .05
ignorehitpause=1

;一撃BASARA技を回避
[state -2]
type = varadd
trigger1 = ((P2stateno=3500&&enemynear,moveguarded)||((P2stateno!=[3500,3510])&&enemynear,var(45)<0))&&(enemynear,authorname="rei"||enemynear,authorname="gal129")&&enemynear,fvar(39)=7&&var(44)%128<64
fvar(15) = .10
ignorehitpause=1

;===援軍
;要請
[state -2]
type = varadd
trigger1 = var(40)<=-10&&var(44)%256<128
trigger2 = numhelper(10000)
trigger2 = helper(10000),stateno=17000&&var(44)%256<128
fvar(15) = .10+(var(43)<=30000)*.10
ignorehitpause=1

;到着
[state -2]
type = varadd
trigger1 = var(40)=-900&&numhelper(10000)&&var(44)%512<256
fvar(15) = .10
ignorehitpause=1

;手出し無用宣言
[state -2]
type = varadd
trigger1 = var(40)=-2&&var(44)%1024<512
fvar(15) = .10
ignorehitpause=1

;ファーストアタック
[state -2]
type = varadd
triggerall = var(44)%2048<1024 && numexplod(8798)
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2
trigger2 = numhelper(20000)
trigger2 = helper(20000),var(11)=2
fvar(15) = .10
ignorehitpause=1

;カウンターヒット
[state -2]
type = varadd
triggerall = var(49) && var(44)%4096<2048
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2
trigger2 = numhelper(20000)
trigger2 = helper(20000),var(19)>0
fvar(15) = .05
ignorehitpause=1

;援軍壁ヒット
[state -2]
type = varadd
triggerall = var(44)%8192<4096 && var(1)%8>=4 && !(P2stateno=927&&P2movetype=H)
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2
fvar(15) = .05
ignorehitpause=1

;援軍エリアル
[state -2]
type = varadd
triggerall = var(44)%16384<8192 && var(1)%4>=2 && var(1)%2<1 && var(1)%8<4
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2
fvar(15) = .05
ignorehitpause=1

;援軍アシスト
[state -2]
type = varadd
trigger1 = numhelper(20000)&&var(44)%32768<16384
trigger1 = helper(20000),var(12)=1
fvar(15) = .05
ignorehitpause=1

;====特殊スタイリッシュポイント取得メッセージ====
;FIRST HIT
[state -2]
type = Explod
triggerall = movetype!=H&&numexplod(8799)&&var(44)%2<1
trigger1 = movehit=1&&stateno!=801
trigger2 = numhelper(6300)
trigger2 = (helper(6300),movehit=[1,2])
trigger3 = numhelper(3107)
trigger3 = (helper(3107),movehit=[1,2])
trigger4 = numhelper(3555)
trigger4 = (helper(3555),movehit=[1,2])
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8070
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;BOUNCE DOWN
[state -2]
type = Explod
trigger1 = stateno=900&&movehit=1&&var(44)%4<2
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8071
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;THROW SUCCESS
[state -2]
type = Explod
trigger1 = stateno=801&&movehit=1&&var(44)%8<4
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8072
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;AERIAL HIT
[state -2]
type = Explod
trigger1 = stateno=910&&movehit=1&&var(44)%16<8
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8073
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;PROVOCATION P
[state -2]
type = Explod
trigger1 = (Life<=const(data.life)*.2||Life<=enemynear,life*.5)&&stateno=195&&animTime=-1&&var(44)%32<16
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8074
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;BASARA HIT
[state -2]
type = Explod
triggerall = var(44)%64<32
trigger1 = (stateno=[3000,3199])&&movehit=1
trigger2 = numhelper(6300)
trigger2 = (helper(6300),movehit=[1,2])
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8075
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;STYLISH KO!
[state -2]
type = Explod
trigger1 = numhelper(8800)
trigger1 = helper(8800),time=1&&stateno!=3510
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8077
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;ICHIGEKI AVOID
[state -2]
type = Explod
trigger1 = ((P2stateno=3500&&enemynear,moveguarded)||((P2stateno!=[3500,3510])&&enemynear,var(45)<0))&&(enemynear,authorname="rei"||enemynear,authorname="gal129")&&enemynear,fvar(39)=7&&var(44)%128<64
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8078
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;HP REVERSAL KO
[state -2]
type = Explod
trigger1 = numhelper(30000)
trigger1 = helper(30000),var(9)=2
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8079
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;STAND ATK HIT
[state -2]
type = Explod
triggerall = !var(2)||(var(34)=210&&(var(35)=[1,2])&&var(19))
trigger1 = var(44)%262144>=131072&&var(44)%524288>=262144&&stateno=220&&movehit=1&&var(44)%1048576<524288
trigger2 = var(44)%262144>=131072&&var(44)%1048576>=524288&&((stateno=210&&movehit=1)||(var(34)=210&&(var(35)=[1,2])&&var(19)&&var(2)=1))&&var(44)%524288<262144
trigger3 = var(44)%524288>=262144&&var(44)%1048576>=524288&&stateno=200&&movehit=1&&var(44)%262144<131072
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8080
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;CROUCH ATK HIT
[state -2]
type = Explod
triggerall = !var(2)
trigger1 = var(44)%2097152>=1048576&&var(44)%4194304>=2097152&&stateno=420&&movehit=1&&var(44)%8388608<4194304
trigger2 = var(44)%2097152>=1048576&&var(44)%8388608>=4194304&&stateno=410&&movehit=1&&var(44)%4194304<2097152
trigger3 = var(44)%4194304>=2097152&&var(44)%8388608>=4194304&&((stateno=400&&movehit=1)||(var(34)=400&&(var(35)=[1,2])&&var(19)))&&var(44)%2097152<1048576
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8081
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;JUMP ATK HIT
[state -2]
type = Explod
triggerall = !var(2)
trigger1 = var(44)%16777216>=8388608&&var(44)%33554432>=16777216&&stateno=620&&movehit=1&&var(44)%67108864<33554432
trigger2 = var(44)%16777216>=8388608&&var(44)%67108864>=33554432&&stateno=610&&movehit=1&&var(44)%33554432<16777216
trigger3 = var(44)%33554432>=16777216&&var(44)%67108864>=33554432&&stateno=600&&movehit=1&&var(44)%16777216<8388608
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8082
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;AVOID BACKSTEP
[state -2]
type = Explod
trigger1 = (P2bodydist X=[40,80])&&P2movetype=A&&inguarddist&&stateno=105&&time=1
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8084
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;GUARD KEEPER
[state -2]
type = Explod
trigger1 = var(39)>=600 && roundstate=2
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8085
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;EN REQUEST
[state -2]
type = Explod
triggerall = var(44)%256<128 && numhelper(8000)
trigger1 = var(40)<=-10
trigger2 = numhelper(10000)
trigger2 = helper(10000),stateno=17000
trigger3 = !roundsexisted&&(teammode=turns)&&!var(40)
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8086
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;EN APPEAR
[state -2]
type = Explod
triggerall = var(44)%512<256 && numhelper(8000)
trigger1 = var(40)=-900&&numhelper(10000)
trigger2 = !roundsexisted&&(teammode=turns)&&!var(40)
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8087
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;BRAVE
[state -2]
type = Explod
trigger1 = var(40)=-2&&var(44)%1024<512
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8088
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;EN FIRST HIT
[state -2]
type = Explod
triggerall = var(44)%2048<1024 && numexplod(8798)
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2
trigger2 = numhelper(20000)
trigger2 = helper(20000),var(11)=2
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8089
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;EN COUNTER HIT
[state -2]
type = Explod
triggerall = var(49) && var(44)%4096<2048
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2
trigger2 = numhelper(20000)
trigger2 = helper(20000),var(19)>0
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8090
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5


;COUNTER SUCCESS
[state -2]
type = Explod
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2 && helper(20000),stateno%10000%1000=80
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8091
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;EN HIT CANCEL
[state -2]
type = Explod
trigger1 = numhelper(7710)
trigger1 = helper(7710),var(8)=2
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8092
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;EN BOUNCE DOWN HIT
[state -2]
type = Explod
triggerall = var(44)%8192<4096 && var(1)%8>=4 && !(P2stateno=927&&P2movetype=H)
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8093
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;EN AERIAL HIT
[state -2]
type = Explod
triggerall = var(44)%16384<8192 && var(1)%4>=2 && var(1)%2<1 && var(1)%8<4
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8094
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;BLOCK SUCCESS
[state -2]
type = Explod
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2 && helper(20000),stateno=13600
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8095
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;EN BASARA
[state -2]
type = Explod
trigger1 = numhelper(20000)&&var(44)%32768<16384
trigger1 = helper(20000),var(12)=1
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8096
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

;LOW LV EN REQ
[state -2]
type = Explod
triggerall = var(43)<=30000
trigger1 = var(40)<=-10&&var(44)%256<128
id = ifelse(!NumExplod(8070),8070,ifelse(!NumExplod(8071),8071,ifelse(!NumExplod(8072),8072,8073)))
anim = 8097
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),228+floor(1000*ifelse(((fvar(18)-floor(fvar(18)))=(0,.001)),-1000,1)*(fvar(18)-floor(fvar(18))))
postype = back
ontop = 1
ownpal = 1
facing=facing
bindtime=-1
ignorehitpause=1
pausemovetime=999
supermovetime=999
scale = .5,.5

[state -2]
type = ModifyExplod
trigger1 = NumExplod(8071)
id = 8070
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),224-8+floor(10000*(fvar(18)-floor(fvar(18))))
facing=facing
postype = back

[state -2]
type = ModifyExplod
trigger1 = NumExplod(8072)
id = 8070
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),224-16+floor(10000*(fvar(18)-floor(fvar(18))))
facing=facing
postype = back

[state -2]
type = ModifyExplod
trigger1 = NumExplod(8072)
id = 8071
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),224-8+floor(10000*(fvar(18)-floor(fvar(18))))
postype = back

[state -2]
type = ModifyExplod
trigger1 = NumExplod(8073)
id = 8070
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),224-24+floor(10000*(fvar(18)-floor(fvar(18))))
facing=facing
postype = back

[state -2]
type = ModifyExplod
trigger1 = NumExplod(8073)
id = 8071
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),224-16+floor(10000*(fvar(18)-floor(fvar(18))))
postype = back

[state -2]
type = ModifyExplod
trigger1 = NumExplod(8073)
id = 8072
pos = 8+18+ifelse(teamside=2,75,0)+ifelse(teamside=1&&facing=-1,267,ifelse(teamside=2&&facing=1,119,0))+floor(fvar(18)),224-8+floor(10000*(fvar(18)-floor(fvar(18))))
facing=facing
postype = back

;~~~回数制限~~~
;ファーストアタック
[state -2]
type = varadd
triggerall = movetype!=H&&numexplod(8799)&&var(44)%2<1
trigger1 = movehit=1&&stateno!=801
trigger2 = numhelper(6300)
trigger2 = (helper(6300),movehit=[1,2])
trigger3 = numhelper(3107)
trigger3 = (helper(3107),movehit=[1,2])
trigger4 = numhelper(3555)
trigger4 = (helper(3555),movehit=[1,2])
var(44) = 1
ignorehitpause=1

[state -2]
type = varadd
trigger1 = stateno=900&&movehit=1&&var(44)%4<2
var(44)=2
ignorehitpause=1

[state -2]
type = varadd
trigger1 = stateno=801&&movehit=1&&var(44)%8<4
var(44)=4
ignorehitpause=1

[state -2]
type = varadd
trigger1 = stateno=910&&movehit=1&&var(44)%16<8
var(44)=8
ignorehitpause=1

[state -2]
type = varadd
trigger1 = (Life<=const(data.life)*.2||Life<=enemynear,life*.5)&&stateno=195&&animTime=-1&&var(44)%32<16
var(44)=16
ignorehitpause=1

;BASARA技ヒット
[state -2]
type = varadd
triggerall = var(44)%64<32
trigger1 = (stateno=[3000,3199])&&movehit=1
trigger2 = numhelper(6300)
trigger2 = (helper(6300),movehit=[1,2])
var(44)=32
ignorehitpause=1

;一撃BASARA技を回避
[state -2]
type = varadd
trigger1 = ((P2stateno=3500&&enemynear,moveguarded)||((P2stateno!=[3500,3510])&&enemynear,var(45)<0))&&(enemynear,authorname="rei"||enemynear,authorname="gal129")&&enemynear,fvar(39)=7&&var(44)%128<64
var(44)=64
ignorehitpause=1

;===援軍
[state -2]
type = varadd
triggerall = var(44)%256<128
trigger1 = var(40)<=-10
trigger2 = numhelper(10000)
trigger2 = helper(10000),stateno=17000
trigger3 = !roundsexisted&&(teammode=turns)&&!var(40)
var(44)=128
ignorehitpause=1

;到着
[state -2]
type = varadd
triggerall = var(44)%512<256
trigger1 = var(40)=-900&&numhelper(10000)
trigger2 = !roundsexisted&&(teammode=turns)&&!var(40)
var(44)=256
ignorehitpause=1

;手出し無用宣言
[state -2]
type = varadd
trigger1 = var(40)=-2&&var(44)%1024<512
var(44) = 512
ignorehitpause=1

;ファーストアタック
[state -2]
type = varadd
triggerall = var(44)%2048<1024 && numexplod(8798)
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2
trigger2 = numhelper(20000)
trigger2 = helper(20000),var(11)=2
var(44) = 1024
ignorehitpause=1

;カウンターヒット
[state -2]
type = varadd
triggerall = var(49) && var(44)%4096<2048
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2
trigger2 = numhelper(20000)
trigger2 = helper(20000),var(19)>0
var(44) = 2048
ignorehitpause=1

;援軍壁ヒット
[state -2]
type = varadd
triggerall = var(44)%8192<4096 && var(1)%8>=4 && !(P2stateno=927&&P2movetype=H)
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2
var(44)=4096
ignorehitpause=1

;援軍エリアル
[state -2]
type = varadd
triggerall = var(44)%16384<8192 && var(1)%4>=2 && var(1)%2<1 && var(1)%8<4
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2
var(44)=8192
ignorehitpause=1

;援軍アシスト
[state -2]
type = varadd
trigger1 = numhelper(20000)&&var(44)%32768<16384
trigger1 = helper(20000),var(12)=1
var(44)=16384
ignorehitpause=1

;~~~通常技単発ヒット~~~
;スタイリッシュポイント増加
[state -2]
type = varadd
triggerall = !var(2)||(var(34)=210&&(var(35)=[1,2])&&var(19)&&var(2)=1)
trigger1 = var(44)%262144>=131072&&var(44)%524288>=262144&&stateno=220&&movehit=1&&var(44)%1048576<524288
trigger2 = var(44)%262144>=131072&&var(44)%1048576>=524288&&((stateno=210&&movehit=1)||(var(34)=210&&(var(35)=[1,2])&&var(19)))&&var(44)%524288<262144
trigger3 = var(44)%524288>=262144&&var(44)%1048576>=524288&&stateno=200&&movehit=1&&var(44)%262144<131072
fvar(15) = .08
ignorehitpause=1

[state -2]
type = varadd
triggerall = !var(2)
trigger1 = var(44)%2097152>=1048576&&var(44)%4194304>=2097152&&stateno=420&&movehit=1&&var(44)%8388608<4194304
trigger2 = var(44)%2097152>=1048576&&var(44)%8388608>=4194304&&stateno=410&&movehit=1&&var(44)%4194304<2097152
trigger3 = var(44)%4194304>=2097152&&var(44)%8388608>=4194304&&((stateno=400&&movehit=1)||(var(34)=400&&(var(35)=[1,2])&&var(19)))&&var(44)%2097152<1048576
fvar(15) = .08
ignorehitpause=1

[state -2]
type = varadd
triggerall = !var(2)
trigger1 = var(44)%16777216>=8388608&&var(44)%33554432>=16777216&&stateno=620&&movehit=1&&var(44)%67108864<33554432
trigger2 = var(44)%16777216>=8388608&&var(44)%67108864>=33554432&&stateno=610&&movehit=1&&var(44)%33554432<16777216
trigger3 = var(44)%33554432>=16777216&&var(44)%67108864>=33554432&&stateno=600&&movehit=1&&var(44)%16777216<8388608
fvar(15) = .08
ignorehitpause=1


;立ち通常技
[state -2]
type = varadd
triggerall = stateno=200&&movehit=1&&var(44)%262144<131072
trigger1 = !var(2)
var(44) = 131072
ignorehitpause=1

[state -2]
type = varadd
triggerall = ((stateno=210&&movehit=1)||(var(34)=210&&(var(35)=[1,2])&&var(19)))&&var(44)%524288<262144
trigger1 = !var(2)||(var(34)=210&&(var(35)=[1,2])&&var(19)&&var(2)=1)
var(44) = 262144
ignorehitpause=1

[state -2]
type = varadd
triggerall = stateno=220&&movehit=1&&var(44)%1048576<524288
trigger1 = !var(2)
var(44) = 524288
ignorehitpause=1

;しゃがみ通常技
[state -2]
type = varadd
triggerall = ((stateno=400&&movehit=1)||(var(34)=400&&(var(35)=[1,2])&&var(19)))&&var(44)%2097152<1048576
trigger1 = !var(2)
var(44) = 1048576
ignorehitpause=1

[state -2]
type = varadd
triggerall = stateno=410&&movehit=1&&var(44)%4194304<2097152
trigger1 = !var(2)
var(44) = 2097152
ignorehitpause=1

[state -2]
type = varadd
triggerall = stateno=420&&movehit=1&&var(44)%8388608<4194304
trigger1 = !var(2)
var(44) = 4194304
ignorehitpause=1

;ジャンプ通常技
[state -2]
type = varadd
triggerall = stateno=600&&movehit=1&&var(44)%16777216<8388608
trigger1 = !var(2)
var(44) = 8388608
ignorehitpause=1

[state -2]
type = varadd
triggerall = stateno=610&&movehit=1&&var(44)%33554432<16777216
trigger1 = !var(2)
var(44) = 16777216
ignorehitpause=1

[state -2]
type = varadd
triggerall = stateno=620&&movehit=1&&var(44)%67108864<33554432
trigger1 = !var(2)
var(44) = 33554432
ignorehitpause=1

;~~~~制限なし~~~~

;カウンターヒット
[state -2]
type = varadd
triggerall = var(49)
trigger1 = movehit=1&&stateno!=801
trigger2 = numhelper(20000)
trigger2 = helper(20000),movehit=2
fvar(15) = ifelse(((stateno=[1000,1999])||(stateno=[3000,3199]))&&movehit=1,.03,.015)
ignorehitpause=1

;逆転ＫＯ
[state -2]
type = varadd
trigger1 = numhelper(30000)
trigger1 = helper(30000),var(9)=2
fvar(15) = .1
ignorehitpause=1

;~~一定時間ガードをする~~
[state -2]
type = varadd
trigger1 = var(39)>=600
fvar(15) = .03
ignorehitpause=1

[state -2]
type = varset
trigger1 = (Stateno!=[150,155])&&movetype=H
trigger2 = var(39)>=600||roundstate<2
var(39) = 0
ignorehitpause=1

[state -2]
type = varadd
trigger1 = ((Stateno=[150,155])||var(39))&&roundstate=2
var(39) = 1
ignorehitpause=1

;~~近距離で相手の攻撃をバックステップでかわす~~
[state -2]
type = varadd
trigger1 = (P2bodydist X=[40,80])&&P2movetype=A&&inguarddist&&stateno=105&&time=1
fvar(15) = .03

;~~BASARA技KO~~
[state -2]
type = varadd
trigger1 = numhelper(8800)
trigger1 = helper(8800),time=1&&stateno!=3510
fvar(15) = .05
ignorehitpause=1

;~~援軍ヒットキャンセル~~
[state -2]
type = varadd
trigger1 = numhelper(7710)
trigger1 = helper(7710),var(8)=2
fvar(15) = .01
ignorehitpause=1

;~~手出し無用宣言~~
;アレンジ（ゲージ増加）
[state -2]
type = poweradd
trigger1 = var(40)=-2&&NumExplod(6295)
value = 1000

;一撃ゲージ自動増加
;原作の回復システムがないため時間に応じて増加
[state -2]
type = varadd
trigger1 = !(movetype=H&&!var(31)&&(stateno!=[4120,4130]))&&statetype!=A&&roundstate=2&&!numexplod(40000)&&fvar(15)*1.00<.99
fvar(15) = .00002
ignorehitpause=1
;~~~~~~~~~~~~~~~~~~~

;被ヒットによる増加
[state -2]
type = varadd
trigger1 = movetype=H&&(var(38)-life)>0
fvar(15) = .00015*(var(38)-life)

[state -2]
type = varset
trigger1 = movehit=1&&movetype=H||!movehit
fvar(14) = fvar(1)*fvar(2)*fvar(3)*fvar(4)
ignorehitpause=1

[state -2]
type = varset
trigger1 = fvar(15)>1.0
fvar(15) = 1.0
ignorehitpause=1

;本気出すか！
[state -2]
type = playsnd
trigger1 = roundstate=2&&!numexplod(40000)&&fvar(15)>=1.0&&fvar(16)<(2.0+(var(40)!=0&&(var(40)!=[-899,-10]))*.2)
trigger1 = var(10) := floor(72*(TicksPerSecond/60))
value = 10,65
channel = 1
ignorehitpause=1
;1.185sec

;BASARAゲージ増加量
[state -2]
type = varset
trigger1 = !var(45)
fvar(16) = 1+fvar(15)*1.00+(var(40)!=0&&(var(40)!=[-899,-10]))*.2
ignorehitpause=1

[state -2]
type = varset
trigger1 = fvar(16)<1
fvar(16) = 1
ignorehitpause=1

;======エリアル中
;リセット
[state -2]
type = varadd
trigger1 = !(stateno=40&&prevstateno=910)&&statetype!=A&&(anim!=[600,729])&&var(1)%4>=2&&movehit=1
trigger2 = var(6)%10>0&&var(1)%4>=2
var(1) = -2

[state -1]
type = varset
trigger1 = !var(2)
trigger2 = numtarget
trigger2 = target,statetype!=A
fvar(26) = 91000

;□エリアル中ヒット数計算□
[state -1]
type = varset
trigger1 = !var(2)
trigger2 = numtarget
trigger2 = target,statetype!=A&&!target,hitfall
var(4) = 0

[state -1]
type = varadd
trigger1 = movecontact=1 && numtarget && var(2)<32 && var(1)%4>=2&&var(1)%2<1&&var(1)%8<4
trigger1 = target,time=0 && (target,stateno=5000||target,stateno=5010||target,stateno=5020||target,stateno=5070||target,stateno=5080) && (target,statetype=A||target,hitfall=1)
var(4) = ifelse(stateno=620&&floor(var(4)/10000)<7,10000,ifelse(stateno=610&&(floor(var(4)-ifelse(var(4)>=10000,floor(var(4)/10000)*10000,0))/100)<7,100,1))
ignorehitpause=1

;~~~~~コンボ補正~~~~~
;□ヒット数計算□
[state -1]
type = varset
trigger1 = !numtarget&&P2movetype!=H
trigger2 = (P2stateno=[150,155])
var(2) = 0

[state -1]
type = varadd
trigger1 = movecontact=1 && numtarget && !(stateno=801&&time<2)
trigger1 = target,time=0 && (target,stateno=5000||target,stateno=5010||target,stateno=5020||target,stateno=5070||target,stateno=5080)
var(2) = 1
ignorehitpause=1

;□空中ヒット数計算□
[state -1]
type = varset
trigger1 = !var(2)
var(3) = 0

[state -1]
type = varadd
trigger1 = movecontact=1 && numtarget && !(stateno=801&&time<2)
trigger1 = target,time=0 && (target,stateno=5000||target,stateno=5010||target,stateno=5020||target,stateno=5070||target,stateno=5080) && (target,statetype=A||target,hitfall=1)
var(3) = 1
ignorehitpause=1

;□コンボ補正□
[state -1]
type = varset
trigger1 = 1
fvar(1) = 1-(var(2)!=0)*ifelse(fvar(21),ifelse(var(2)>3,.4,.25+(var(2)-1)*.05),.4)-ifelse(var(2)>1,ifelse(var(2)>7,.3,(var(2)-1)*.05),0)+(var(2)=8)*.05-(var(2)>=9)*.1-(var(2)>=10)*.05-(var(2)>=11)*.075-(var(2)>=12)*.015-(var(2)>=13)*.01-(var(2)>=14)*.02
ignorehitpause=1

;□コンボ補正□
[state -1]
type = varset
trigger1 = fvar(21)
fvar(1) = 1-(var(2)!=0)*.25-ifelse(var(2)>14,.745,ifelse(var(2)>9,(var(2)-7)*.01+(var(2)-1)*.075,(var(2)-1)*.075))*(var(2)!=0)
ignorehitpause=1

;□基底補正□
;===基底・強制基底技ヒット判別
;（２重にかかるのを防止）
[state -1]
type = varadd
trigger1 = (((stateno=200||stateno=400||stateno=600||stateno=620||(stateno=1000&&animelemtime(10)<0))&&var(2)=1)||stateno=801)&&movecontact=1
trigger1 = numtarget
trigger1 = target,time=0&&(target,stateno=5000||target,stateno=5010||target,stateno=5020||target,stateno=5070||target,stateno=5080)
var(8) = ifelse(stateno=801&&var(8)%32<16,16,ifelse(stateno=1000&&var(8)%8<4,4,ifelse((stateno=400||stateno=620)&&var(8)%4<2,2,ifelse(var(8)%2<1,1,0))))
ignorehitpause=1

;援軍ヒット後
[state -1]
type = varadd
triggerall = var(8)%256<128
trigger1 = numhelper(20000)
trigger1 = helper(20000),movehit=2 && helper(20000),stateno%100!=70
trigger2 = var(15)>0
var(8) = 128
ignorehitpause=1

;リセット
[state -1]
type = varset
trigger1 = !var(2)
var(8) = 0

;基底補正
[state -1]
type = varset
trigger1 = 1
fvar(2) = ifelse(var(8)%2>=1,.80,1.0)*ifelse(var(8)%4>=2,.85,1.0)*ifelse(var(8)%8>=4,.80,1.0)*ifelse(var(8)%16>=8,.9,1.0)*ifelse(var(8)%32>=16,.5,1.0)*ifelse(var(8)%256>=128,.80-(stateno=[1000,1499])*.1-(stateno=[3000,3120])*.2,1.0)
ignorehitpause=1

;空中・しゃがみ・カウンター時補正
[state -1]
type = varset
trigger1 = 1
fvar(3) = ifelse(!var(2)&&P2statetype=A&&P2movetype!=H,1.2,ifelse(P2statetype=C,1.1,1.0))*ifelse(!var(2)&&P2movetype=A,1.1,1.0)
ignorehitpause=1

;逆根性値補正
[state -1]
type = varset
trigger1 = 1
fvar(4) = ifelse((enemynear,life*1.00/enemynear,const(data.life))<.125,.75,ifelse((enemynear,life*1.00/enemynear,const(data.life))<.25,.80,ifelse((enemynear,life*1.00/enemynear,const(data.life))<.5,.85,1)))
ignorehitpause=1

;逆根性値補正（根性値持ちキャラには発生しないように）
[state -1]
type = varset
trigger1 = enemynear,authorname = "muteki"
trigger2 = enemynear,authorname = "y.y"&&(enemynear,name="joseph"||enemynear,name="jotaro"||enemynear,name="Hol Holse"||enemynear,name="Hol horse & Boingo")
trigger3 = enemynear,authorname = "H"
fvar(4) = 1.0
ignorehitpause=1

;最終コンボ補正
[state -2]
type = varset
trigger1 = 1
fvar(0) = fvar(1)*fvar(2)*fvar(3)*fvar(4)
ignorehitpause=1

;===
受け身不能時間設定
[state -2]
type = varset
trigger1 = !var(2)
var(14) = 0
ignorehitpause=1

受け身不能時間設定
[state -2]
type = varadd
trigger1 = (P2stateno!=5000&&P2stateno!=5010&&P2stateno!=5020&&P2stateno!=5070&&P2stateno!=5080)&&((P2stateno=[5000,5099]))||(((P2stateno=[926,929])||(P2stateno=[936,939]))&&P2movetype=H&&enemynear,hitshakeover)
var(14) = 1
ignorehitpause=1

;==壁コンボ中
[state -1]
type = varset
triggerall = var(1)!=2
trigger1 = !numtarget&&P2movetype!=H
trigger2 = numtarget
trigger2 = target,pos Y>=0
var(1) = ifelse(var(1)%4>=2&&statetype=A,2,0)

[state -1]
type = varadd
triggerall = (var(1)%2>=1||var(1)%8>=4)
trigger1 = (P2stateno=927 && enemynear,time>=20 && P2movetype=H)
trigger2 = (P2stateno=937 && enemynear,time>=1 && P2movetype=H)
var(1) = ifelse(var(1)%8>=4,-4,-1)

[state -1]
type = varadd
triggerall = var(1)%2>=1&&numtarget && floor(var(6)%100/10)<9
triggerall = enemynear,backedgebodydist>5&&enemynear,frontedgebodydist>5
trigger1 = movehit=1 && target,time=0||projhit=1
trigger2 = numhelper(11000)
trigger2 = helper(11000),movehit=1 && helper(11000),hitpausetime=14
var(6) = 10
ignorehitpause=1

[state -1]
type = targetstate
trigger1 = (var(1)%2>=1||var(1)%8>=4)&&numtarget&&stateno!=900&&stateno!=1300
trigger1 = movehit=1 && target,time=0
value = ifelse(var(1)%8>=4,ifelse(var(1)%4>=2,939,936),ifelse(floor(var(6)%100/10)=5&&var(1)%2>=1,928,926))
ignorehitpause=1

;ガード時壁吹き飛び用
[state -2]
type = Helper
trigger1 = (P2stateno=151||P2stateno=153) && -enemynear,gethitvar(xvel)*enemynear,facing>floor(22*const(size.xscale)) && ifelse(enemynear,facing=facing,enemynear,frontedgebodydist<=5,enemynear,backedgebodydist<=5) && enemynear,vel x<-2.5
trigger1 = (P2stateno!=[926,929]) && stateno!=1000
trigger2 = numtarget(920)
trigger2 = (target,stateno=151||target,stateno=153) && ifelse(target,facing=facing,target,frontedgebodydist<=5,target,backedgebodydist<=5) && target,vel x<-2.5
id = 10920
stateno=10920
pos = 0,0
postype = p2
ignorehitpause=1


;壁吹き飛ばし岩盤
[State 40, 1]
type = Helper
trigger1 = numtarget
trigger1 = ((target,stateno=926||target,stateno=928)&&target,time%5=1)&&!(target,time>1&&!target,hitshakeover)&&target,pos Y>=-20
trigger1 = !(target,backedgebodydist<=5||target,frontedgebodydist<=5)
trigger2 = !numtarget && P2movetype=H
trigger2 = ((P2stateno=926||P2stateno=928)&&enemynear,time%5=1)&&!(enemynear,time>1&&!enemynear,hitshakeover)&&enemynear,pos Y>=-20
trigger2 = !(enemynear,backedgebodydist<=5||enemynear,frontedgebodydist<=5)
id = 6920
stateno = 6920
pos = floor(enemynear,Pos X-Pos X)*facing,-floor(Pos Y)
postype = p1
ownpal = 1
pausemovetime = 9999
supermovetime = 9999
ignorehitpause=1

;ダウン時岩盤
[State 40, 1]
type = Helper
trigger1 = numtarget && enemynear,hitfall && (P2stateno=5030||P2stateno=5035||P2stateno=5050||P2stateno=5071||P2stateno=15071||P2stateno=15076||(P2stateno=927&&enemynear,time>=20))
trigger1 = enemynear,vel Y>ifelse(P2stateno=927,-0.5,0) && (enemynear,pos Y>=-enemynear,Vel Y||(enemynear,Pos Y>=-1&&P2stateno=927))
trigger1 = (var(1)%4>=2||P2stateno=927)
id = 6925
stateno = 6920
pos = floor(enemynear,Pos X-Pos X)*facing,-floor(Pos Y)
postype = p1
ownpal = 1
pausemovetime = 9999
supermovetime = 9999
ignorehitpause=1

;ダウンほこり
[State 40, 1]
type = Helper
trigger1 = numtarget && enemynear,hitfall && (P2stateno=5071||P2stateno=15071||P2stateno=15076||(P2stateno=927&&enemynear,time>=20))
trigger1 = enemynear,vel Y>0 && (enemynear,pos Y>=-enemynear,Vel Y||(enemynear,Pos Y>=-1&&P2stateno=927)) && var(6)%10<1
trigger2 = numtarget && var(6)%10<1 && (P2stateno=[15100,15110]) && enemynear,time=1&&P2movetype=H
id = 6926
stateno = 6921
pos = floor(enemynear,Pos X-Pos X)*facing,-floor(Pos Y)
postype = p1
ownpal = 1
pausemovetime = 9999
supermovetime = 9999
ignorehitpause=1

;効果音
[State 5100, 10]
type = PlaySnd
trigger1 = numtarget
trigger1 = target,time=1&&target,stateno=927&&(target,backedgebodydist<=5||target,frontedgebodydist<=5)
trigger2 = numhelper(6920)
value = 5100, 1
channel = 5
ignorehitpause=1

;ダウン時用
[state -2]
type = VarSet
trigger1 = !numtarget&&P2movetype!=H
trigger2 = P2stateno=15075&&P2movetype=H
var(6) = 0

;効果音
[State 5100, 10]
type = PlaySnd
trigger1 = numtarget && enemynear,hitfall && (((P2stateno=5030||P2stateno=5035||P2stateno=5050||P2stateno=5071) && !enemynear,canrecover)||P2stateno=15071||P2stateno=15076||(P2stateno=927&&enemynear,time>=20))
trigger1 = (enemynear,pos Y>=-enemynear,Vel Y||(enemynear,Pos Y>=-1&&P2stateno=927)) && enemynear,vel Y>ifelse(P2stateno=927,-0.5,0) && var(6)%10<1
trigger2 = numtarget && var(6)%10<2&&((var(6)%10<1&&(P2stateno=[15100,15110])&&enemynear,time=1)||(var(6)%10>0&&P2stateno=5020))&&P2movetype=H
value = 5100, ifelse(P2stateno=927,1,ifelse(var(1)%4>=2,2,0))
ignorehitpause=1

;ダウン時用
[state -2]
type = VarAdd
trigger1 = (numtarget||var(2)) && enemynear,hitfall && (((P2stateno=5030||P2stateno=5035||P2stateno=5050||P2stateno=5071))||P2stateno=5100||P2stateno=15071||P2stateno=15076||(P2stateno=927&&enemynear,time>=20&&var(1)%4<2))
trigger1 = (enemynear,pos Y>=-enemynear,Vel Y||(enemynear,Pos Y>=-1&&P2stateno=927)) && enemynear,vel Y>ifelse(P2stateno=927,-0.5,0) && var(6)%10<1
trigger2 = var(6)%10<2&&((var(6)%10<1&&(P2stateno=[15100,15110])&&enemynear,time=1)||(var(6)%10>0&&P2stateno=5020))&&P2movetype=H
trigger3 = var(6)%10<1&&enemynear,hitfall && !enemynear,canrecover &&(P2stateno!=[5000,5099])
trigger3 = enemynear,pos Y>=-enemynear,Vel Y && enemynear,vel Y>0
var(6) = 1
ignorehitpause=1

;ダウン時用
[state -2]
type = TargetState
trigger1 = !enemynear,canrecover && enemynear,hitfall && (P2stateno=5030||P2stateno=5050||P2stateno=5071) && enemynear,vel Y>0 && enemynear,pos Y>=-enemynear,Vel Y && roundstate>=2
trigger2 = var(6)%10<1&&enemynear,hitfall && !enemynear,canrecover &&(P2stateno!=[5000,5099])
trigger2 = enemynear,pos Y>=-enemynear,Vel Y && enemynear,vel Y>0
value = ifelse(var(28)>0,15320,15100)
ignorehitpause=1

;ジャンプ状態リセット
[state -2]
type = varset
trigger1 = statetype!=A&&stateno!=40&&stateno!=45&&!var(34)
trigger2 = statetype=A&&movetype=H&&(stateno!=[150,155])&&(stateno!=[4120,4130])
var(5) = ifelse(var(5)%256>=128,128,0)
ignorehitpause=1

;着地硬直リセット
[state -2]
type = varset
trigger1 = statetype!=A&&stateno!=52&&var(5)%256>=128
var(5) = 0
ignorehitpause=1

[state -2]
type = AssertSpecial
trigger1 = stateno=52
flag = nostandguard

;======画面端ヒットバック

[state -2]
type = varset
trigger1 = !numtarget&&P2movetype!=H
fvar(7) = 0
ignorehitpause=1

[state -2]
type = varadd
trigger1 = fvar(7)
fvar(7) = ifelse(fvar(7)<0,1,-1)
ignorehitpause=1

[state -2]
type = velset
trigger1 = fvar(5) && ((fvar(5)=[-1,0])||(fvar(5)=[0,1])) && (enemynear,backedgebodydist<=5||enemynear,frontedgebodydist<=5||(P2stateno=927&&P2movetype=H))
x = fvar(8)+fvar(9)

[state -2]
type = varset
trigger1 = fvar(5) && movetype=H && (stateno!=[0,40])
trigger2 = fvar(5) && ((fvar(5)=[-1,0])||(fvar(5)=[0,1]))
trigger3 = !numtarget&&P2movetype!=H
trigger4 = numtarget
trigger4 = (target,stateno!=[5000,5099])&&(target,stateno!=[150,169])&&(target,stateno!=[926,929])&&(target,stateno!=[936,939])&&(target,stateno!=[15070,15071])&&(target,stateno!=[15100,15110])&&(target,stateno!=[15300,15350])&&target,stateno!=15010
trigger4 = !((target,stateno=[150,155])&&((target,authorname="rei"||target,authorname="gal129")&&(target,fvar(39)=1||target,fvar(39)=4))&&(target,prevstateno=[4100,4110]))
fvar(5)=0

[state -2]
type = varset
trigger1 = !fvar(5)
fvar(6)=0

[state -2]
type = varset
trigger1 = movetype=H||((stateno=[0,40])&&time<=1)
fvar(8)=0

[state -2]
type = velset
trigger1 = fvar(5) && !fvar(7) && (enemynear,backedgebodydist<=5||enemynear,frontedgebodydist<=5||(P2stateno=927&&P2movetype=H))
x = fvar(8)+fvar(9)+fvar(5)

[state -2]
type = varset
triggerall = !(stateno=3000&&AnimElemTime(1)>=1&&AnimElemTime(1)<31&&Anim=3000)&&!(stateno=3010&&AnimElemTime(3)>=0&&AnimElemTime(3)<30&&Anim=3010)&&!(stateno=3100&&Anim=3100&&AnimElemTime(2)>=0&&AnimElemTime(2)<30)
triggerall = !(stateno=3500&&AnimElemTime(4)>=0&&AnimElemTime(7)<=0)
trigger1 = fvar(5) && !fvar(7) && numtarget&&!(var(52)>1&&movecontact)
fvar(5) = fvar(5)*ifelse(!fvar(6),.6,ifelse(target,statetype=C,const(movement.crouch.friction),const(movement.stand.friction)))

[state -2]
type = varset
triggerall = !(stateno=3000&&AnimElemTime(1)>=1&&AnimElemTime(1)<31&&Anim=3000)&&!(stateno=3010&&AnimElemTime(3)>=0&&AnimElemTime(3)<30&&Anim=3010)&&!(stateno=3100&&Anim=3100&&AnimElemTime(2)>=0&&AnimElemTime(2)<30)
triggerall = !(stateno=3500&&AnimElemTime(4)>=0&&AnimElemTime(7)<=0)
trigger1 = fvar(5) && !fvar(7) && !numtarget&&!(var(52)>1&&movecontact)
fvar(5) = fvar(5)*ifelse(!fvar(6),.6,ifelse(P2statetype=C,const(movement.crouch.friction),const(movement.stand.friction)))

[state -2]
type = varadd
triggerall = !(stateno=3000&&AnimElemTime(1)>=1&&AnimElemTime(1)<31&&Anim=3000)&&!(stateno=3010&&AnimElemTime(3)>=0&&AnimElemTime(3)<30&&Anim=3010)&&!(stateno=3100&&Anim=3100&&AnimElemTime(2)>=0&&AnimElemTime(2)<30)
triggerall = !(stateno=3500&&AnimElemTime(4)>=0&&AnimElemTime(7)<=0)
trigger1 = fvar(6)>0 && !fvar(7)&&!(var(52)>1&&movecontact)
fvar(6)=-1

;===ヒットポーズ処理

;ヒットポーズ時間
[state -2]
type = varset
trigger1 = var(52)=100 && (stateno!=[200,3999]) && (anim!=[200,3999])
var(52) = 0
ignorehitpause=1

[state -2]
type = varadd
trigger1 = var(52)<100&&var(52)>0 && (stateno!=[200,3999]) && (anim!=[200,3999])
var(52) = -1
ignorethitpause=1

;先行入力~~~~
;リセット
[state -2]
type = varset
trigger1 = var(53)&&movetype=H&&!var(34)
var(53) = 0
ignorehitpause=1

;残像消去
[state -2]
type = AfterImage
trigger1 = (statetype!=A||(movetype=H&&(StateNo!=[120,159])))&&stateno!=2000
time = 0

;空中ダッシュ先行入力~~~~
[state -2]
type = VarSet
trigger1 = Stateno=50 && Pos Y>-60 && Vel Y<0 && Ctrl
var(53) = ifelse((fvar(13)=17&&P2dist X>=0)||(fvar(13)=-17&&P2dist X<0),110,ifelse((fvar(13)=-17&&P2dist X>=0)||(fvar(13)=17&&P2dist X<0),115,var(53)))

;~~~ガードクラッシュ
[State -2, 1]
type = varSet
trigger1 = (stateno=[150,155])
var(22) = 0
ignorehitpause=1

[State -2, 1]
type = varAdd
triggerall = !(stateno=3000&&AnimElemTime(1)>=1&&AnimElemTime(1)<31&&Anim=3000)&&!(stateno=3010&&AnimElemTime(3)>=0&&AnimElemTime(3)<30&&Anim=3010)&&!(stateno=3100&&Anim=3100&&AnimElemTime(2)>=0&&AnimElemTime(2)<30)
triggerall = !(stateno=3500&&AnimElemTime(4)>=0&&AnimElemTime(7)<=0)
trigger1 = (StateNo!=[5910,5931]) && var(22)>=0
var(22) = 1
ignorehitpause=1

[state varset]
type = varset
trigger1 = enemynear,numpartner
var(23)=1000

;-------------------
;ガードクラッシュ値回復
[State -2, 1]
type = varAdd
triggerall = stateno!=5150
triggerall = !(stateno=3000&&AnimElemTime(1)>=1&&AnimElemTime(1)<31&&Anim=3000)&&!(stateno=3010&&AnimElemTime(3)>=0&&AnimElemTime(3)<30&&Anim=3010)&&!(stateno=3100&&Anim=3100&&AnimElemTime(2)>=0&&AnimElemTime(2)<30)
triggerall = !(stateno=3500&&AnimElemTime(4)>=0&&AnimElemTime(7)<=0)
trigger1 = var(23)<256 && var(22)>=60 && ceil(var(22))%20=0
var(23) = 1
ignorehitpause=1

[state -2]
type = varset
trigger1 = roundstate<2
trigger2 = (anim=[5910,5939])
trigger3 = (enemynear,authorname="rei"||enemynear,authorname="gal129")&&(enemynear,fvar(39)=4||enemynear,fvar(39)=7)
var(23) = 256

;減少
[state -2]
type = varadd
trigger1 = (stateno=150||stateno=152||stateno=154)&&time=0&&!numexplod(7701)&&!numexplod(7702)
var(23) = -floor(ifelse(gethitvar(ctrltime)>=18,16.0,ifelse(gethitvar(ctrltime)>=15,14,ifelse(gethitvar(ctrltime)>=12,8,ifelse(gethitvar(ctrltime)>=10,6,4))))*.7*ifelse(numexplod(7706),.2,1.0))

;ガードクラッシュ
[state -2]
type = ChangeState
trigger1 = (stateno=150||stateno=152||stateno=154)&&time=0&&!numexplod(7701)&&!numexplod(7702)&&var(23)<0
value = 5915+(stateno=154)*20

;相手側ガードクラッシュ
;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
;ガードクラッシュ減少値判別
[State 100, Helper]
type = Helper
triggerall = !numhelper(15900)&&!IsHelper
trigger1 = ((stateno=[200,799])||(stateno=[900,910])||(stateno=[1000,2099])||(stateno=[3000,3999])) && time=1
trigger2 = roundstate=0
trigger3 = (var(34)&&(stateno=[120,132])&&time=0)
id = 15900
stateno=15900
pos = 0,0
postype = p2
ownpal = 1
ignorehitpause = 1

;ガードクラッシュ減少値判別
[State 100, Helper]
type = Helper
triggerall = moveguarded=1&&!numhelper(15905)&&!IsHelper
triggerall = !enemynear,numpartner
trigger1 = numtarget
trigger1 = target,time=0 && (target,stateno=150||target,stateno=152||target,stateno=154)
trigger2 = !numtarget && movetype=H && (P2stateno=[150,155])
id = 15905
stateno=15905
pos = 0,0
postype = p2
ownpal = 1
ignorehitpause = 1

[State -2, 1]
type = varSet
trigger1 = ((P2stateno=[150,155])&&ifelse((enemynear,authorname="rei"||enemynear,authorname="gal129")&&(enemynear,fvar(39)=1||enemynear,fvar(39)=4||enemynear,fvar(39)=7),(enemynear,prevstateno!=[4100,4120])&&!enemynear,var(11),1))
var(24) = 0
ignorehitpause=1

[State -2, 1]
type = varAdd
triggerall = !(stateno=3000&&AnimElemTime(1)>=1&&AnimElemTime(1)<31&&Anim=3000)&&!(stateno=3010&&AnimElemTime(3)>=0&&AnimElemTime(3)<30&&Anim=3010)&&!(stateno=3100&&Anim=3100&&AnimElemTime(2)>=0&&AnimElemTime(2)<30)
triggerall = !(stateno=3500&&AnimElemTime(4)>=0&&AnimElemTime(7)<=0)
trigger1 = (P2StateNo!=[15910,15931]) && var(24)>=0
var(24) = 1
ignorehitpause=1

[state varset]
type = varset
trigger1 = enemynear,numpartner
var(25)=1000

;-------------------
;ガードクラッシュ値回復
[State -2, 1]
type = varAdd
triggerall = P2stateno!=5150
triggerall = !(stateno=3000&&AnimElemTime(1)>=1&&AnimElemTime(1)<31&&Anim=3000)&&!(stateno=3010&&AnimElemTime(3)>=0&&AnimElemTime(3)<30&&Anim=3010)&&!(stateno=3100&&Anim=3100&&AnimElemTime(2)>=0&&AnimElemTime(2)<30)
triggerall = !(stateno=3500&&AnimElemTime(4)>=0&&AnimElemTime(7)<=0)
trigger1 = var(25)<256 && ifelse(enemynear,name="Honda Tadakatsu"||enemynear,name="Tadakatsu",ceil(var(24))%5=0,ceil(var(24))%20=0) && var(24)>=60
var(25) = 1
ignorehitpause=1

[state -2,1]
type = targetstate
trigger1 = var(25)<=0
value = 15915+(p2statetype=A)*20

[state -2,1]
type = varset
trigger1 = roundstate<2||var(25)<=0
trigger2 = (enemynear,anim=[5910,5930])
var(25) = 256


;~~~~気絶処理~~~
;相手側気絶
;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
;気絶増加値判別
[State 100, Helper]
type = Helper
triggerall = (movehit=1||(movehit=2&&var(1)%2>=1)||projhit=1)&&!numhelper(15380) && (stateno!=[3000,3099])&&var(28)>=0 && var(2)<9
triggerall = !enemynear,numpartner
trigger1 = numtarget
trigger1 = target,time=0 && (target,stateno=5000||target,stateno=5010||target,stateno=5020||target,stateno=5070||target,stateno=5080)
trigger2 = numtarget && var(1)%2>=1
trigger2 = target,time=1 && (target,prevstateno=[5000,5099]) && (target,stateno=926||target,stateno=936)
trigger3 = !numtarget && movetype=H && P2movetype=H && (P2stateno!=[150,155])
id = 15380
stateno=15380
pos = 0,0
postype = p2
ownpal = 1
ignorehitpause = 1

;==自分
[state -2]
type = varadd
triggerall = !(stateno=3000&&AnimElemTime(8)>=0&&AnimElemTime(11)<2)&&!(stateno=3100&&AnimElemTime(1)>=1&&AnimElemTime(2)<0)&&!(stateno=3500&&AnimElemTime(1)>=1&&AnimElemTime(1)<31)
trigger1 = var(27)>0&&gametime%8=0&&(movetype!=H||(stateno=[150,155]))&&statetype!=L&&(stateno!=[15100,15110])
var(27) = -1
ignorehitpause=1

;気絶値増加
[state -2]
type = varadd
trigger1 = alive&&!var(26)&&gethitvar(hitcount)=1
trigger1 = !(gethitvar(damage)&&gethitvar(hittime)&&(stateno!=[150,155])&&(stateno!=[4120,4130]))&&(stateno!=[5000,5099])&&(prevstateno=[5000,5099])&&time=1
var(27) = 7
ignorehitpause=1

[state -2]
type = varadd
trigger1 = alive&&!var(26)&&(gethitvar(hitcount)=[1,8])
trigger1 = gethitvar(damage)&&gethitvar(hittime)&&(stateno!=[150,155])&&(stateno!=[4120,4130])
var(27) = floor(ifelse(gethitvar(hittime)>=20,8,ifelse(gethitvar(hittime)>=17,7,ifelse(gethitvar(hittime)>=14,6,ifelse(gethitvar(hittime)>=12,5,4))))*(1-(gethitvar(hitcount)-1)*.05-(gethitvar(hitcount)>1)*.35))
ignorehitpause=1

[state -2]
type = varset
trigger1 = roundstate!=2||enemynear,numpartner||(anim=5300&&stateno!=5300)
trigger2 = var(26)!=0
trigger3 = (enemynear,authorname="rei"||enemynear,authorname="gal129")&&enemynear,fvar(39)=7
var(27) = 0
ignorehitpause=1

[state -2]
type = varset
trigger1 = roundstate!=2||enemynear,numpartner||(anim=5300&&stateno!=5300)||((enemynear,authorname="rei"||enemynear,authorname="gal129")&&enemynear,fvar(39)=7)
trigger2 = var(26)=-1&&(movetype!=H||(stateno=[150,155]))
var(26) = 0
ignorehitpause=1

[state -2]
type = varset
trigger1 = var(26)=-2&&stateno!=5300
var(26) = -1
ignorehitpause=1

[state -2]
type = varset
trigger1 = var(26)<-1&&stateno!=5300
var(26) = -2
ignorehitpause=1

[state -2]
type = varset
trigger1 = var(26)>0&&stateno=5300
var(26) = -ifelse(var(26)>120,120,var(26))
ignorehitpause=1

;気絶残り時間
[state -2]
type = varadd
triggerall = !(stateno=3000&&AnimElemTime(8)>=0&&AnimElemTime(11)<2)&&!(stateno=3100&&AnimElemTime(1)>=1&&AnimElemTime(2)<0)&&!(stateno=3500&&AnimElemTime(1)>=1&&AnimElemTime(1)<31)
trigger1 = var(26)!=0&&(var(26)!=[-2,-1])&&(stateno!=[5320,5340])
var(26) = ifelse(var(26)<0,1,-1)
ignorehitpause=1

;気絶残り時間(レバガチャ)
[state -2]
type = varadd
triggerall = !(stateno=3000&&AnimElemTime(8)>=0&&AnimElemTime(11)<2)&&!(stateno=3100&&AnimElemTime(1)>=1&&AnimElemTime(2)<0)&&!(stateno=3500&&AnimElemTime(1)>=1&&AnimElemTime(1)<31)
triggerall = var(26)!=0&&var(26)!=-1
trigger1 = (command="fwd"||command="back"||command="up"||command="down")
trigger2 = (command="x"||command="y"||command="z")
var(26) = ifelse(var(26)<0,ifelse(var(26)>=-4,-var(28)-1,4),ifelse(var(28)<=4,-var(26)+1,-4))
ignorehitpause=1

;気絶残り時間
[state -2]
type = varset
trigger1 = var(27)>=80&&!var(26)
var(26) = ifelse((stateno=5000||stateno=5010)&&!hitfall,180,360)+2
ignorehitpause=1

[state -2]
type = changestate
trigger1 = var(26)>0
trigger1 = (stateno=5001||stateno=5011) && HitOver
value = 5300
ignorehitpause=1

[state -2]
type = changestate
trigger1 = var(26)>0
trigger1 = time=0 && (stateno=5000||stateno=5010||stateno=5020||stateno=5030||stateno=5050||stateno=5070) && HitFall
value = 5310
ignorehitpause=1

[state -2]
type = changestate
trigger1 = var(26)>0
trigger1 = time=1 && stateno=5120
value = 5350
ignorehitpause=1

[state -2]
type = Helper
trigger1 = (var(26)!=[-2,-1])&&var(26)!=0&&!numhelper(7780)
id = 7780
stateno=7780
pos = 0,const(size.head.pos.y)+20
postype = p1
ignorehitpause=1
pausemovetime=999
supermovetime=999

;==相手
[state -2]
type = varadd
triggerall = !(stateno=3000&&AnimElemTime(8)>=0&&AnimElemTime(11)<2)&&!(stateno=3100&&AnimElemTime(1)>=1&&AnimElemTime(2)<0)&&!(stateno=3500&&AnimElemTime(1)>=1&&AnimElemTime(1)<31)
trigger1 = var(29)>0&&gametime%8=0&&!var(2)&&P2statetype!=L&&(P2stateno!=[15100,15110])
var(29) = -1
ignorehitpause=1

[state -2]
type = varset
trigger1 = roundstate!=2||enemynear,numpartner||(enemynear,anim=5300&&p2stateno!=15300&&(p2stateno!=[5000,5099]))
trigger2 = var(28)!=0
var(29) = 0
ignorehitpause=1

[state -2]
type = varset
trigger1 = roundstate!=2||enemynear,numpartner||(enemynear,anim=5300&&p2stateno!=15300&&(p2stateno!=[5000,5099]))
trigger2 = var(28)=-1&&(P2movetype!=H||(P2stateno=[150,155]))
var(28) = 0
ignorehitpause=1

[state -2]
type = varset
trigger1 = var(28)=-2&&P2stateno!=15300
var(28) = -1
ignorehitpause=1

[state -2]
type = varset
trigger1 = var(28)<-1&&P2stateno!=15300
var(28) = -2
ignorehitpause=1

[state -2]
type = varset
trigger1 = var(28)>0&&P2stateno=15300
var(28) = -var(28)
ignorehitpause=1

;気絶残り時間
[state -2]
type = varadd
trigger1 = var(28)!=0&&(var(28)!=[-2,-1])&&(P2stateno!=[15320,15340])
var(28) = ifelse(var(28)<0,1,-1)
ignorehitpause=1

;気絶残り時間(レバガチャ)
[state -2]
type = varadd
triggerall = !(stateno=3000&&AnimElemTime(8)>=0&&AnimElemTime(11)<2)&&!(stateno=3100&&AnimElemTime(1)>=1&&AnimElemTime(2)<0)&&!(stateno=3500&&AnimElemTime(1)>=1&&AnimElemTime(1)<31)
triggerall = var(28)!=0&&var(28)!=-1
trigger1 = (enemynear,command="fwd"||enemynear,command="back"||enemynear,command="up"||enemynear,command="down")
trigger2 = (enemynear,command="x"||enemynear,command="y"||enemynear,command="z")
var(28) = ifelse(var(28)<0,ifelse(var(28)>=-4,-var(28)-1,4),ifelse(var(28)<=4,-var(28)+1,-4))
ignorehitpause=1

;気絶残り時間
[state -2]
type = varset
triggerall = var(29)>=ifelse(enemynear,name="Uesugi Kenshin"||enemynear,name="Kenshin",60,ifelse(enemynear,name="Honda Tadakatsu"||enemynear,name="Tadakatsu",100,80))&&!var(28) && numtarget
trigger1 = (target,stateno=5000||target,stateno=5010||target,stateno=5020||target,stateno=5030||target,stateno=5050||target,stateno=5070)
trigger2 = target,stateno=926||target,stateno=936
var(28) = ifelse((target,stateno=5000||target,stateno=5010)&&!target,hitfall,180,240)+2
ignorehitpause=1

[state -2]
type = Helper
trigger1 = (var(28)!=[-2,-1])&&var(28)!=0&&!numhelper(7785)
id = 7785
stateno=7785
pos = 0,enemynear,const(size.head.pos.y)+20
postype = p1
ignorehitpause=1
pausemovetime=999
supermovetime=999

[state -2]
type = targetstate
trigger1 = var(28)>0 && numtarget
trigger1 = target,time=0 && (target,stateno=5000||target,stateno=5010||target,stateno=5020||target,stateno=5030||target,stateno=5050||target,stateno=5070) && target,hitfall
value = 15310
ignorehitpause=1

[state -2]
type = targetstate
trigger1 = var(28)>0 && numtarget
trigger1 = target,time>0 && (target,stateno=5001||target,stateno=5011) && target,hitover
value = 15300
ignorehitpause=1

;ダウン時用
[state -2]
type = TargetState
trigger1 = numtarget
trigger1 = var(28)>0 && (target,stateno=15100||target,stateno=15110) && target,time=1
value = ifelse(target,stateno=15100,15320,15340)
ignorehitpause=1

[state -2]
type = Helper
trigger1 = (var(28)!=[-2,-1])&&var(28)!=0&&!numhelper(7785)
id = 7785
stateno=7785
pos = 0,enemynear,const(size.head.pos.y)+20
postype = p1
ignorehitpause=1
pausemovetime=999
supermovetime=999

;ファーストアタック判別
[state -2]
type = Explod
trigger1 = !roundsexisted && roundstate=2 && !ctrl && stateno=0 && ((Prevstateno=[190,194])||Prevstateno=5900) && !numexplod(8799)
id = 8799
anim = 90000
pos = 0,0
postype = back
removetime=-1
pausemovetime=99999
supermovetime=99999

[state -2]
type = RemoveExplod
trigger1 = movetype=H && (stateno!=[150,155])
trigger2 = (movehit=1&&stateno!=801)||projhit=1
id = 8799
ignorehitpause=1

;援軍ファーストアタック判別
[state -2]
type = Explod
trigger1 = roundstate=2 && !ctrl && stateno=0 && ((Prevstateno=[190,194])||Prevstateno=5900) && !numexplod(8798)
id = 8798
anim = 90000
pos = 0,0
postype = back
removetime=-1
pausemovetime=99999
supermovetime=99999

[state -2]
type = RemoveExplod
trigger1 = numhelper
trigger1 = helper,movehit
trigger2 = (enemynear,authorname="rei"||enemynear,authorname="gal129")&&enemynear,fvar(39)=7&&enemynear,var(44)%2048>=1024
id = 8798
ignorehitpause=1

;~~~~~~メッセージ
;COUNTER HIT
[state -2]
type = helper
triggerall = var(49)
trigger1 = movehit=1&&stateno!=801
trigger2 = numhelper(20000)
trigger2 = helper(20000),movehit=2
trigger3 = numhelper(20000)
trigger3 = helper(20000),var(19)>0
id = 8710
stateno = 8710
pos = 60+(teamside=2)*190,100+(numhelper(8712)!=0)*40
postype = back
ignorehitpause=1
pausemovetime=99999
supermovetime=99999
bindtime=-1
ontop = 1
ownpal = 1
scale = .5,.5
facing=facing

;GUARD BREAK
[state -2]
type = Helper
triggerall = !numhelper(8711)
trigger1 = numhelper(15900)
trigger1 = helper(15900),var(3)
trigger2 = numhelper(15906)
trigger2 = helper(15906),var(3)
id = 8711
stateno = 8711
pos = 250+(facing=-1)*10-(teamside=2)*190,100+(numhelper(8712)!=0)*40
postype = back
ignorehitpause=1
pausemovetime=99999
supermovetime=99999
bindtime=-1
ontop = 1
ownpal = 1
scale = .5,.5
facing=facing

;REVERSAL
[state -2]
type = Helper
triggerall = !numhelper(8712)
trigger1 = ((fvar(27)-floor(fvar(27)))=[.1,.3))&&((stateno=[300,320])||(stateno=[800,999])||var(34)||(stateno=[1000,1999])||(stateno=[3000,3999]))&&time<=1&&Movetype!=H
id = 8712
stateno = 8712
pos = 50+(teamside=2)*190,100
postype = back
ignorehitpause=1
pausemovetime=99999
supermovetime=99999
bindtime=-1
ontop = 1
ownpal = 1
scale = .5,.5
facing=facing

;転倒食らい
[state 190]
type = Targetstate
trigger1 = numtarget && movehit=1 && var(1)%2<1 && var(1)%8<4 && var(6)%10<1 && var(49)
trigger1 = target,time=0 && target,gethitvar(yvel)>=4
value = 15070

;COUNTER HIT 判別
[state -2]
type = varset
trigger1 = !movehit||movehit>1||(movehit=1&&!var(52))
var(49) = (P2movetype=A)
ignorehitpause=1

[state -2]
type = varset
trigger1 = numhelper(8710)
trigger1 = helper(8710),time<16
var(49) = 0
ignorehitpause=1

;~~~~~~~~~~~リバーサル~~~~~~~~~
;受け付け時間延長
[state -2]
type = varset
trigger1 = floor(fvar(27))%10=9
trigger2 = (statetype=L||movetype=H)&&floor(fvar(27))%10=4
trigger3 = floor(fvar(27)/10)*10=stateno&&time=1
trigger4 = ((fvar(27)=[.2,.3])||(fvar(27)=[.6,.7]))
trigger5 = command!="hold_x"&&((fvar(27)=[200,209])||(fvar(27)=[400,409])||(fvar(27)=[1000,1009])||(fvar(27)=[1100,1109])||(fvar(27)=[1150,1159])||statetype=A)
trigger6 = command!="hold_y"&&((fvar(27)=[210,219])||(fvar(27)=[310,319])||(fvar(27)=[410,419])||(fvar(27)=[1110,1119])||(fvar(27)=[1160,1169])||statetype=A)
trigger7 = command!="hold_z"&&((fvar(27)=[220,229])||(fvar(27)=[420,429])||(fvar(27)=[3000,3509])||statetype=A)
trigger8 = (command!="hold_y"||command!="hold_z")&&(fvar(27)=[900,919])
trigger9 = stateno=900||(movetype=H&&time=1)
fvar(27)=0

[state -2]
type = varadd
trigger1 = (fvar(27)-floor(fvar(27)))>=.1
fvar(27) = .1

[state -2]
type = varadd
trigger1 = command="hold_x"&&((fvar(27)=[200,209])||(fvar(27)=[400,409])||(fvar(27)=[1000,1009])||(fvar(27)=[1100,1109])||(fvar(27)=[1150,1159]))
trigger2 = command="hold_y"&&((fvar(27)=[210,219])||(fvar(27)=[310,319])||(fvar(27)=[410,419])||(fvar(27)=[1110,1119])||(fvar(27)=[1160,1169]))
trigger3 = command="hold_z"&&((fvar(27)=[220,229])||(fvar(27)=[420,429])||(fvar(27)=[3000,3509]))
trigger4 = (command="hold_y"&&command="hold_z")&&(fvar(27)=[900,919])
fvar(27)=1
ignorehitpause=1

[state -2]
type = varset
triggerall = !(movetype=A&&(stateno=[200,699]))&&!ctrl&&(stateno!=[0,140])&&stateno!=2000&&!fvar(27)
trigger1 = command="Gora"&&Power>=1000 && !var(59)
fvar(27) = 3000

[state -2]
type = varset
triggerall = !(movetype=A&&(stateno=[200,699]))&&!ctrl&&(stateno!=[0,140])&&stateno!=2000&&!fvar(27)
trigger1 = command="Shibaku"&&Power>=1000 && !var(59)
fvar(27) = 3100

[state -2]
type = varset
triggerall = !(movetype=A&&(stateno=[200,699]))&&!ctrl&&(stateno!=[0,140])&&stateno!=2000&&!fvar(27)
trigger1 = command="Ichigeki"&&(var(45)=[1,9999]) && !var(59)
fvar(27) = 3500

;~~~
[state -2]
type = varset
triggerall = !(movetype=A&&(stateno=[200,699]))&&!ctrl&&(stateno!=[0,140])&&stateno!=2000&&!fvar(27)
trigger1 = command="Jibaku" && var(40)=1 && numhelper(20000) && var(12)>0 && !var(59)
fvar(27) = 1600

[state -2]
type = null;varset
triggerall = !(movetype=A&&(stateno=[200,699]))&&!ctrl&&(stateno!=[0,140])&&stateno!=2000&&!fvar(27)
trigger1 = (command="x"||command="y"||command="z")&&command="a" && !var(12) && var(40)>0 && !var(59)
fvar(27) = 1500+ifelse(command="z",2,ifelse(command="y",1,0))

[state -2]
type = varset
triggerall = !(movetype=A&&(stateno=[200,699]))&&!ctrl&&(stateno!=[0,140])&&stateno!=2000&&!fvar(27)
trigger1 = command="Dokyu2" && !var(59)
fvar(27) = 1150+(command="y")*10

[state -2]
type = varset
triggerall = !(movetype=A&&(stateno=[200,699]))&&!ctrl&&(stateno!=[0,140])&&stateno!=2000&&!fvar(27)
trigger1 = command="Dokyu" && !var(59)
fvar(27) = 1100+(command="y")*10

[state -2]
type = varset
triggerall = !(movetype=A&&(stateno=[200,699]))&&!ctrl&&(stateno!=[0,140])&&stateno!=2000&&!fvar(27)
trigger1 = command="Issyoku" && !var(59)
fvar(27) = 1000

[state -2]
type = varset
triggerall = (movetype=H||statetype=L)&&!ctrl&&((anim=[5120,5121])||stateno=151||stateno=153||stateno=5001||stateno=5011)&&stateno!=2000&&!fvar(27)
trigger1 = command="y"&&command="z" && !var(59)
fvar(27) = 900+(command="holddown")*10

[state -2]
type = varset
triggerall = (movetype=H||statetype=L)&&!ctrl&&((anim=[5120,5121])||stateno=151||stateno=153||stateno=5001||stateno=5011)&&stateno!=2000&&!fvar(27)
trigger1 = command="z"&&(command="holdfwd"||command="holdback")&&command!="holddown"&&command!="holdup"&&P2bodydist X<=floor(35*const(size.xscale)) && !var(59)
fvar(27) = 800

[state -2]
type = varset
triggerall = (movetype=H||statetype=L)&&!ctrl&&((anim=[5120,5121])||stateno=151||stateno=153||stateno=5001||stateno=5011)&&stateno!=2000&&!fvar(27)
trigger1 = command="y"&&command="holdfwd"&&command!="holddown" && !var(59)
fvar(27) = 310

[state -2]
type = varset
triggerall = (movetype=H||statetype=L)&&!ctrl&&((anim=[5120,5121])||stateno=151||stateno=153||stateno=5001||stateno=5011)&&stateno!=2000&&!fvar(27)
trigger1 = command="z" && !var(59)
fvar(27) = 220*ifelse(command="holddown",2,1)

[state -2]
type = varset
triggerall = (movetype=H||statetype=L)&&!ctrl&&((anim=[5120,5121])||stateno=151||stateno=153||stateno=5001||stateno=5011)&&stateno!=2000&&!fvar(27)
trigger1 = command="y" && !var(59)
fvar(27) = 210*ifelse(command="holddown",2,1)

[state -2]
type = varset
triggerall = (movetype=H||statetype=L)&&!ctrl&&((anim=[5120,5121])||stateno=151||stateno=153||stateno=5001||stateno=5011)&&stateno!=2000&&!fvar(27)
trigger1 = command="x" && !var(59)
fvar(27) = 200*ifelse(command="holddown",2,1)

[state -2]
type = varset
triggerall = (movetype=H||statetype=L)&&!ctrl&&((anim=[5120,5121])||stateno=151||stateno=153||stateno=5001||stateno=5011)&&stateno!=300&&!fvar(27)
trigger1 = ((fvar(13)=-17&&P2dist X>=0)||(fvar(13)=17&&P2dist X<0)) && !var(59)
fvar(27) = 100

[state -2]
type = varadd
trigger1 = (anim=[5120,5121])&&animtime=0
fvar(27) = .15

[state -2]
type = varadd
trigger1 = (stateno=151||stateno=153||stateno=5001||stateno=5011)&&(HitOver||Ctrl)
fvar(27) = .50
;==

;~~~~~~
;画面端距離判別
[state -2]
type = Helper
trigger1 = Roundstate=2 && !ctrl && !NumHelper(30000)
id = 30000
stateno=30000
pos = 160,0
postype = back
facing=-(teamside=2)

;画面端距離判別
[state -2]
type = Helper
trigger1 = Roundstate=2 && !ctrl && !NumHelper(30005)
id = 30005
stateno=30005
pos = 160,0
postype = back
facing=-(teamside=2)

;援軍位置判別
[state 190]
type = Helper
trigger1 = !NumHelper(18000)
id = 18000
stateno = 18000
name="pos"
pos = 100,0
postype = back
sprpriority = -4
shadowoffset = -16
size.xscale = const(size.xscale)
size.yscale = const(size.yscale)

;~~~一撃BASARA技KO~~~~
[state 3500]
type = varadd
trigger1 = var(45)>1&&var(45)!=10000&&roundstate<3
var(45) = -1
ignorehitpause=1

;失敗時
[state 801]
type = PowerSet
trigger1 = var(45)=-1||var(45)=1||(roundstate<2&&(var(45)=[1,999]))
value = 0
ignorehitpause=1

;一撃ゲージ消滅用
[state 801]
type = VarSet
trigger1 = var(45)=-1||var(45)=1||(roundstate<2&&var(45)>0)
var(45) = -2
ignorehitpause=1

;成功後
[state 801]
type = AssertSpecial
trigger1 = var(45)=10000
flag = NoMusic
ignorehitpause=1

;成功後
[state 801]
type = AssertSpecial
trigger1 = var(45)=10000&&stateno=3510&&animelemtime(3)<16
flag = NoMusic
flag2 = NoBG
flag3 = NoFG
ignorehitpause=1

[state 3500]
type = PalFX
trigger1 = (var(45)=[1,2000])&&gametime%60<30
add = ceil((96-(var(45)<=180)*96)*(gametime%30+1)*1.0/30),ceil((96-(var(45)<=180)*96)*(gametime%30+1)*1.0/30),ceil(((var(45)<=180)*128)*(gametime%30+1)*1.0/30)
time = 1
ignorehitpause=1

[state 3500]
type = PalFX
trigger1 = (var(45)=[1,2000])&&gametime%60>=30
add = ceil((96-(var(45)<=180)*96)*(30-(gametime%30+1))*1.0/30),ceil((96-(var(45)<=180)*96)*(30-(gametime%30+1))*1.0/30),ceil(((var(45)<=180)*128)*(36-(gametime%30+1))*1.0/30)
time = 1
ignorehitpause=1

[state -2]
type = varset
trigger1 = roundstate=3&&var(9)>0
var(9) = 0

[state -2]
type = varadd
trigger1 = roundstate=3&&var(9)<=0
var(9) = -1

;ＯＰＴＩＯＮ
[state -2]
type = Helper
trigger1 = !NumHelper(9000) && roundstate=0 && !roundsexisted && !time
id = 9000
stateno=9000
pos  = 0,0
postype = p1

;□援軍関連□

;援軍ゲージ最大値
[state -2]
type = VarSet
trigger1 = !roundsexisted&&roundstate=0&&(teammode=turns)&&!var(40)
var(41) = 100

;援軍レベル
[state -2]
type = varset
trigger1 = !roundsexisted&&roundstate=0&&(teammode=turns)&&!var(40)
var(43) = 60000

;援軍行動可能に設定
[state -2]
type = VarSet
trigger1 = var(42)>=var(41) && (var(40)=[1,10]) && numhelper(10000)
trigger1 = helper(10000),stateno=10000&&roundstate=2&&!numexplod(40000)
trigger2 = (var(40)=[-4,-3]) && roundstate<2
var(40) = 1

;援軍行動不能に設定
[state -2]
type = VarSet
trigger1 = roundstate<2&&(var(40)=-1||var(40)=-900)
var(40) = 11

;援軍回復までの時間設定
[state -2]
type = VarSet
trigger1 = (var(40)=[3-(roundstate<2),9])
var(40) = ifelse(var(42)>=var(41),0,floor(75*(1.0+floor((100-floor(var(43)/1000))*1.0/25))))+11

;援軍ゲージ設定
[state -2]
type = VarSet
trigger1 = var(41)<71
var(41) = 71
ignorehitpause=1

;援軍ゲージ設定
[state -2]
type = VarSet
trigger1 = var(42)<0
var(42) = 0
ignorehitpause=1

;援軍ゲージ設定
[state -2]
type = VarSet
trigger1 = var(42)>=200
var(42) = 200
ignorehitpause=1

;援軍ゲージ回復
[state -2,gauge]
type = VarAdd
triggerall = !(stateno=3000&&AnimElemTime(1)>=1&&AnimElemTime(1)<31&&Anim=3000)&&!(stateno=3010&&AnimElemTime(3)>=0&&AnimElemTime(3)<30&&Anim=3010)&&!(stateno=3100&&Anim=3100&&AnimElemTime(2)>=0&&AnimElemTime(2)<30)
triggerall = !(stateno=3500&&AnimElemTime(4)>=0&&AnimElemTime(7)<=0)
triggerall = var(40)=10&&var(42)<var(41)&&!numexplod(40000)
triggerall = numhelper(10000)&&roundstate=2&&!numexplod(40000)
triggerall = helper(10000),stateno=10000
trigger1 = gametime%ceil(440.0/ifelse(var(42)<=64,40,ifelse(var(42)>=160,440,var(42))))=0
trigger2 = gametime%ceil(440.0/ifelse(var(42)<=64,40,ifelse(var(42)>=160,440,var(42))))=ceil(100.0/ifelse(var(42)<=64,40,var(42)))
var(42) = 1+ceil(var(42)*1.0/100)
ignorehitpause=1

;援軍ゲージ回復までの時間
[state 2]
type = VarAdd
triggerall = !(stateno=3000&&AnimElemTime(1)>=1&&AnimElemTime(1)<31&&Anim=3000)&&!(stateno=3010&&AnimElemTime(3)>=0&&AnimElemTime(3)<30&&Anim=3010)&&!(stateno=3100&&Anim=3100&&AnimElemTime(2)>=0&&AnimElemTime(2)<30)
triggerall = !(stateno=3500&&AnimElemTime(4)>=0&&AnimElemTime(7)<=0)
trigger1 = var(40)<-10&&roundstate=2&&!numexplod(40000) && numhelper(10000)
trigger1 = helper(10000),stateno=10000||helper(10000),stateno=17000
trigger2 = var(40)>10 && numhelper(10000)&&roundstate=2&&!numexplod(40000)
trigger2 = helper(10000),stateno=10000
var(40) = -1-ifelse(var(40)<=-10,(gametime%4=0)+(gametime%100>=(100-0.18*floor(var(43)/1000))),0)
ignorehitpause=1

;援軍レベル最小値
[state 2]
type = VarSet
trigger1 = var(43)<=1000
var(43) = 1000
ignorehitpause=1

;援軍レベル最大値
[state 2]
type = VarSet
trigger1 = var(43)>=100000
var(43) = 100000
ignorehitpause=1

;援軍レベル上昇
[state 2]
type = VarAdd
triggerall = !(stateno=3000&&AnimElemTime(1)>=1&&AnimElemTime(1)<31&&Anim=3000)&&!(stateno=3010&&AnimElemTime(3)>=0&&AnimElemTime(3)<30&&Anim=3010)&&!(stateno=3100&&Anim=3100&&AnimElemTime(2)>=0&&AnimElemTime(2)<30)
triggerall = !(stateno=3500&&AnimElemTime(4)>=0&&AnimElemTime(7)<=0)
trigger1 = var(43)<100000&&roundstate=2&&!numexplod(40000) && (var(40)=[0,1]) && !NumHelper(11000)
var(43) = ceil(1000/38*ifelse(roundsexisted,1.15,1)/ifelse(var(40)=1,4,1))
ignorehitpause=1

;~~~~~~~カラクリ兵器~~~~~~~~~
[state -2]
type = Helper
trigger1 = !numhelper(20000)
id = 20000
stateno=ifelse(var(12)>10000,22000,ifelse(var(12)>2000,21000,ifelse(var(12)>0,20000,29000)))
name = "weapon"
pos = floor(0*const(size.xscale))+floor(fvar(22)),floor(-24*const(size.yscale))
postype = p1
ownpal = 1
sprpriority = -2
size.ground.front = floor(200*const(size.xscale))
size.ground.back = floor(200*const(size.xscale))
size.height = floor(250*const(size.yscale))
size.shadowoffset = -floor(24*const(size.yscale))
pausemovetime=999999
supermovetime=999999

;~~~~~~~アニキ親衛隊~~~~~~~~~
[state -2]
type = Helper
trigger1 = !numhelper(10000)
name="Aniki-BodyGuard"
id = 10000
stateno = ifelse(!var(40)||(var(40)=[-999,-10]),19900,ifelse(var(12)<0,19000,10000))
pos = 120,-20
postype = back
ownpal = 1
keyctrl = 1
size.xscale = const(size.xscale);*.75
size.yscale = const(size.yscale);*.75
size.ground.front = 20
size.ground.back = 20
size.head.pos = -10,-80
size.mid.pos = -5,-50
size.shadowoffset = -16

;援軍アシスト用
[state -2,en-assist]
type = varset
triggerall = !(enemynear,name="Oichi"&&enemynear,authorname="rei"&&enemynear,numexplod(6793))
triggerall = !(enemynear,name="Mouri Motonari"&&enemynear,authorname="Neat Unsou"&&enemynear,var(29))
triggerall = !NumExplod(6295)&&!NumExplod(6296)&&!NumExplod(6297)&&!NumExplod(6298)&&!NumExplod(6299)&&Movetype!=H&&Statetype!=L&&anim!=5300&&roundstate=2&&!numexplod(40000)&&stateno!=2500&&stateno!=3510&&var(40)=1&&var(12)>0&&!var(59)
triggerall = numhelper(20000)
trigger1 = numhelper(7560)&&(stateno!=[3000,3099])&&power>=1000
trigger1 = command="a"
var(40) = 7

;援軍アシスト用
[state -2,en-assist]
type = varset
triggerall = !(enemynear,name="Oichi"&&enemynear,authorname="rei"&&enemynear,numexplod(6793))
triggerall = !(enemynear,name="Mouri Motonari"&&enemynear,authorname="Neat Unsou"&&enemynear,var(29))
triggerall = !NumExplod(6295)&&!NumExplod(6296)&&!NumExplod(6297)&&!NumExplod(6298)&&!NumExplod(6299)&&Movetype!=H&&Statetype!=L&&anim!=5300&&roundstate=2&&!numexplod(40000)&&stateno!=2500&&stateno!=3510&&var(40)=1&&var(12)>0&&var(59)
triggerall = numhelper(20000)
trigger1 = numhelper(7560)&&(stateno!=[3000,3099])&&power>=1000
trigger1 = stateno=620 && movecontact && random%5<2 && var(3)>=10
var(40) = 7

;援軍アシスト

;俺に続け、海風どもッ！
[state 3000]
type = PlaySND
trigger1 = (!var(10)||var(10)>=1000)&&var(40)=7
value = 10,51
channel = 1

;援軍(ニュートラル)
[state -2,neutral+a]
type = varset
triggerall = !(enemynear,name="Oichi"&&enemynear,authorname="rei"&&enemynear,numexplod(6793))
triggerall = !(enemynear,name="Mouri Motonari"&&enemynear,authorname="Neat Unsou"&&enemynear,var(29))
triggerall = !NumExplod(6295)&&!NumExplod(6296)&&!NumExplod(6297)&&!NumExplod(6298)&&!NumExplod(6299)&&Movetype!=H&&Statetype!=L&&anim!=5300&&roundstate=2&&!numexplod(40000)&&stateno!=2500&&stateno!=3510&&var(40)=1&&var(12)>0&&!var(59)
triggerall = numhelper(20000)
trigger1 = command="a"&&command!="Tedashi"&&command!="holddown"&&command!="holdfwd"&&command!="holdback"
var(40) = 4

;援軍(ニュートラル)
[state -2,neutral+a]
type = varset
triggerall = !(enemynear,name="Oichi"&&enemynear,authorname="rei"&&enemynear,numexplod(6793))
triggerall = !(enemynear,name="Mouri Motonari"&&enemynear,authorname="Neat Unsou"&&enemynear,var(29))
triggerall = !NumExplod(6295)&&!NumExplod(6296)&&!NumExplod(6297)&&!NumExplod(6298)&&!NumExplod(6299)&&Movetype!=H&&Statetype!=L&&anim!=5300&&roundstate=2&&!numexplod(40000)&&stateno!=2500&&stateno!=3510&&var(40)=1&&var(12)>0&&var(59)
triggerall = numhelper(20000)
trigger1 = ((helper(20000),pos x-enemynear,pos x)<-320||(helper(20000),pos x-enemynear,pos x)>320) && P2bodydist X>80 && (var(12)=[2001,5000]) && var(51)%7<ifelse((enemynear,anim=[5120,5129]),5,2) && var(2)<=1 && var(1)%2<1&&var(1)%4<2
trigger2 = stateno=105 && (time=[5,7]) && random%5<3 && ((helper(20000),pos x-enemynear,pos x)<-320||(helper(20000),pos x-enemynear,pos x)>320) && var(12)<10000
trigger3 = stateno=3010 && animelem=3,>=4 && animelem=3,<10 && enemynear,vel x=0 && enemynear,vel Y!=0 && enemynear,pos Y<-40 &&P2bodydist X<=30 && (var(12)=[2001,5000]) && random%5<2 && enemynear,backedgebodydist>40
trigger3 = abs(helper(20000),pos x-enemynear,pos x)>=(140-20+helper(20000),const(size.ground.front));木騎
trigger4 = abs(helper(20000),pos x-enemynear,pos x)<=(120+helper(20000),const(size.ground.front))||((abs(helper(20000),pos x-enemynear,pos x)=[-160,160]) && random<200)
trigger4 = (var(12)=[10001,19999]) && random%6=0 && (!fvar(33)||(stateno=105 && time=5)) && var(2)<=1;
var(40) = 4


;援軍(ニュートラル)
[state -2,neutral+a]
type = varset
triggerall = !(enemynear,name="Oichi"&&enemynear,authorname="rei"&&enemynear,numexplod(6793))
triggerall = !(enemynear,name="Mouri Motonari"&&enemynear,authorname="Neat Unsou"&&enemynear,var(29))
triggerall = !NumExplod(6295)&&!NumExplod(6296)&&!NumExplod(6297)&&!NumExplod(6298)&&!NumExplod(6299)&&Movetype!=H&&Statetype!=L&&anim!=5300&&roundstate=2&&!numexplod(40000)&&stateno!=2500&&stateno!=3510&&var(12)>0 && !var(59);援軍ゲージ空でも使用可
triggerall = numhelper(20000)
trigger1 = helper(20000),stateno=20040 && helper(20000),var(30)<16 && !helper(20000),var(7) && command="a"
var(40) = 4

;援軍(2)
[state -2,2+a]
type = varset
triggerall = !(enemynear,name="Oichi"&&enemynear,authorname="rei"&&enemynear,numexplod(6793))
triggerall = !(enemynear,name="Mouri Motonari"&&enemynear,authorname="Neat Unsou"&&enemynear,var(29))
triggerall = !NumExplod(6295)&&!NumExplod(6296)&&!NumExplod(6297)&&!NumExplod(6298)&&!NumExplod(6299)&&Movetype!=H&&Statetype!=L&&anim!=5300&&roundstate=2&&!numexplod(40000)&&stateno!=2500&&stateno!=3510&&var(40)=1&&var(12)>0&&!var(59)
triggerall = numhelper(20000)
trigger1 = command="a"&&command!="Tedashi"&&command="holddown"&&command!="holdfwd"&&command!="holdback"
var(40) = 5

;援軍(2)
[state -2,2+a]
type = varset
triggerall = !(enemynear,name="Oichi"&&enemynear,authorname="rei"&&enemynear,numexplod(6793))
triggerall = !(enemynear,name="Mouri Motonari"&&enemynear,authorname="Neat Unsou"&&enemynear,var(29))
triggerall = !NumExplod(6295)&&!NumExplod(6296)&&!NumExplod(6297)&&!NumExplod(6298)&&!NumExplod(6299)&&Movetype!=H&&Statetype!=L&&anim!=5300&&roundstate=2&&!numexplod(40000)&&stateno!=2500&&stateno!=3510&&var(40)=1&&var(12)>0&&var(59)
triggerall = numhelper(20000)
trigger1 = stateno=710&&movecontact&&var(52)=12&&var(3)>1&&var(3)<19&&(var(12)=[1,2000]);仁王
trigger2 = P2bodydist X>ifelse((enemynear,anim=[5120,5129]),60,140) && var(51)%5<2 && random%3=0
trigger2 = (var(12)=[1,2000])&&ifelse(helper(20000),facing=1,helper(30000),pos x-helper(20000),pos x,-(helper(30005),pos x-helper(20000),pos x))<=(80+helper(20000),const(size.ground.front)) && var(1)%2<1&&var(1)%4<2;仁王
trigger3 = stateno=105 && (time=[5,7]) && random%5<3 && abs(helper(20000),pos x-enemynear,pos x)<120
trigger3 = (var(12)=[1,2000])&&ifelse(helper(20000),facing=1,helper(30000),pos x-helper(20000),pos x,-(helper(30005),pos x-helper(20000),pos x))<=(80+helper(20000),const(size.ground.front));木騎
trigger4 = stateno=3000 && (var(3)=[14,16]) && animtime>-12 && enemynear,vel x=0 && enemynear,vel Y!=0 && backedgebodydist<=80&&P2bodydist X<=30&&enemynear,P2dist X<20 && (var(12)=[1,2000]);仁王
trigger5 = stateno=900 && (var(3)=[14,16]) && time=4 && enemynear,vel x=0 && enemynear,vel Y!=0 && backedgebodydist<=80&&P2bodydist X<=30&&enemynear,P2dist X<20 && (var(12)=[2001,5000])
trigger5 = (abs(helper(20000),pos x-enemynear,pos x)=[10,180]);木騎
trigger6 = (abs(helper(20000),pos x-enemynear,pos x)=[(20+helper(20000),const(size.ground.front)),180+(random<150)*60])
trigger6 = (var(12)=[10001,19999]) && random%4=0 && ((var(2)<=1 && var(51)%4>1)||(P2statetype=L&&enemynear,alive&&P2stateno=15100)||(enemynear,hitfall && enemynear,pos Y>-30&&enemynear,vel Y>4));砲弾発射
var(40) = 5

;援軍(4 or 6)
[state -2,(4 or 6)+a]
type = varset
triggerall = !(enemynear,name="Oichi"&&enemynear,authorname="rei"&&enemynear,numexplod(6793))
triggerall = !(enemynear,name="Mouri Motonari"&&enemynear,authorname="Neat Unsou"&&enemynear,var(29))
triggerall = !NumExplod(6295)&&!NumExplod(6296)&&!NumExplod(6297)&&!NumExplod(6298)&&!NumExplod(6299)&&Movetype!=H&&Statetype!=L&&anim!=5300&&roundstate=2&&!numexplod(40000)&&stateno!=2500&&stateno!=3510&&var(40)=1&&var(12)>0&&!var(59)
triggerall = numhelper(20000)
trigger1 = command="a"&&command!="Tedashi"&&(command="holdfwd"||command="holdback")&&!var(59)
var(40) = 6
ignorehitpause=1

;援軍(4 or 6),CPU
[state -2,(4 or 6)+a]
type = varset
triggerall = !(enemynear,name="Oichi"&&enemynear,authorname="rei"&&enemynear,numexplod(6793))
triggerall = !(enemynear,name="Mouri Motonari"&&enemynear,authorname="Neat Unsou"&&enemynear,var(29))
triggerall = !NumExplod(6295)&&!NumExplod(6296)&&!NumExplod(6297)&&!NumExplod(6298)&&!NumExplod(6299)&&Movetype!=H&&Statetype!=L&&anim!=5300&&roundstate=2&&!numexplod(40000)&&stateno!=2500&&stateno!=3510&&var(40)=1&&var(12)>0&&var(59)
triggerall = numhelper(20000)
trigger1 = fvar(33)&&random%3=0&&(var(51)%10>=(ifelse(floor(fvar(33))=1,5+(Power>=2000)*4,2))||P2bodydist X>50)&&var(1)%2<1&&var(1)%4<2 && (stateno!=[3000,3010])
trigger1 = ((var(12)=[1,5000])||(((helper(20000),pos x-enemynear,pos x)<-300||(helper(20000),pos x-enemynear,pos x)>400)&&(var(12)=[10001,19999])));ガード後
trigger2 = P2bodydist X>ifelse((enemynear,anim=[5120,5129]),30,100) && var(51)%ifelse((enemynear,anim=[5120,5129])&&P2bodydist X<120,3,6)<2 && random%3=0 && (stateno!=[3000,3010])
trigger2 = ifelse((var(12)=[1,2000]),ifelse(facing=1,helper(30000),pos x-helper(20000),pos x,-(helper(30005),pos x-helper(20000),pos x))>(120+helper(20000),const(size.ground.front)),1)
trigger2 = ((helper(20000),pos x-enemynear,pos x)=[-300,300]) && var(1)%2<1 && !(stateno=1000&&var(2)>1) && (var(12)=[1,5000]);仁王,木騎
trigger3 = stateno=1000 && animelemtime(10)>=0 && !var(2) && P2statetype=A&&P2bodydist X<140 && random%2=0
trigger4 = stateno=5210&&random%5<3
trigger4 = ((var(12)=[1,5000])||(((helper(20000),pos x-enemynear,pos x)<-300||(helper(20000),pos x-enemynear,pos x)>300)&&(var(12)=[10001,19999])));受け身後
trigger5 = stateno=105 && (time=[1,3]) && random%5<3 && abs(helper(20000),pos x-enemynear,pos x)<ifelse(floor(var(43)/1000)>=100,320,ifelse(floor(var(43)/1000)>=50,280,240)) && (var(12)=[1,5000]);仁王;木騎
trigger5 = !((var(12)=[1,2000])&&ifelse(helper(20000),facing=1,helper(30000),pos x-helper(20000),pos x,-(helper(30005),pos x-helper(20000),pos x))<=(80+helper(20000),const(size.ground.front)))
trigger6 = (stateno=310||stateno=410)&&time=4 && !var(2) && floor(var(43)/1000)>=50 && var(51)%5>ifelse(P2statetype=L,0,2) && var(28)>=0 && (var(12)=[1,5000]);仁王;木騎
trigger7 = (abs(helper(20000),pos x-enemynear,pos x)=[(320-(P2statetype=L&&enemynear,alive)*60+helper(20000),const(size.ground.front)),640])
trigger7 = (var(12)=[10001,19999]) && ((var(51)%4>1 && var(2)<=1)||(P2statetype=L&&enemynear,alive&&P2stateno=15100)||(enemynear,hitfall && enemynear,pos Y>-30&&enemynear,vel Y>4));火炎放射
trigger8 = (abs(helper(20000),pos x-enemynear,pos x)=[(280-(P2statetype=L&&enemynear,alive)*60+helper(20000),const(size.ground.front)),640]) && random%4=0
trigger8 = (var(12)=[10001,19999]) && (var(3)=[12,16]) && (stateno=220||(stateno=210&&var(3)>=14)) && movecontact=11 && var(2)>1;火炎放射
trigger9 = (abs(helper(20000),pos x-enemynear,pos x)=[(280-(P2statetype=L&&enemynear,alive)*60+helper(20000),const(size.ground.front)),640])
trigger9 = (var(12)=[10001,19999]) && var(2)>=14 && stateno=620 && time=11 && var(2)>1 && var(1)%4>=2;火炎放射
var(40) = 6
ignorehitpause=1

;援軍カウンター用
[state -2,en-counter]
type = varset
triggerall = !(enemynear,name="Oichi"&&enemynear,authorname="rei"&&enemynear,numexplod(6793))
triggerall = !(enemynear,name="Mouri Motonari"&&enemynear,authorname="Neat Unsou"&&enemynear,var(29))
triggerall = numhelper(10000)&&var(12)>0&&var(40)=1
triggerall = ((movetype=H&&statetype!=L&&(stateno!=[150,155]))||anim=5300)&&Power>=1000&&roundstate=2&&alive&&!numexplod(40000)&&stateno!=2500&&stateno!=3510
triggerall = numhelper(20000)
trigger1 = command="a"&&command="holdup"&&!var(59)
trigger2 = (((gethitvar(hitcount)=[4,6]) && Life<=200)||gethitvar(hitcount)>=40) && !canrecover && (P2bodydist X=[-15,60]) && random%3=0 && (var(57)<=2||(floor(var(43)/1000)>=80&&life<=150))
trigger2 = ((floor(var(43)/1000)>=80 && var(51)%5<2 && (((var(12)=[1,1000])&&life<150)||(var(12)=[2001,3500])||(var(12)=[10001,12500])))||(roundsexisted>1&&fvar(15)>=.9 && var(51)%5<3)) && (stateno=[5000,5099]) && enemynear,pos Y>-280 && var(59)
trigger3 = (teammode=turns)&&var(51)%8<ifelse((P2bodydist X=[-15,60]),3,2) && (Life=[1,150]) && (stateno=[5000,5099]) && enemynear,pos Y>-280 && var(59)
var(40) = 8
ignorehitpause=1

;援軍カウンター後
[state -2]
type = ChangeState
triggerall = Numhelper(20000) && ((stateno=[5000,5099])||(stateno=105 && Helper(20000),var(26)!=1)) && alive
trigger1 = Helper(20000),stateno%100=80&&(Helper(20000),time=[1,30]); && ((stateno=[5000,5099])||(stateno=105&&Helper(20000),Hitpausetime))&&Helper(20000),numtarget&&Helper(11000),movehit>1
value = 105
ignorehitpause=1

;援軍ブロック用
[state -2,en-block]
type = null;varset
triggerall = !(enemynear,name="Oichi"&&enemynear,authorname="rei"&&enemynear,numexplod(6793))
triggerall = !(enemynear,name="Mouri Motonari"&&enemynear,authorname="Neat Unsou"&&enemynear,var(29))
triggerall = numhelper(10000)&&var(40)=1&&var(12)>0&&roundstate=2&&!numexplod(40000)&&stateno!=2500&&stateno!=3510
triggerall = numhelper(20000)
trigger1 = enemynear,numhelper(99999999999)
trigger1 = command="a"&&command="holdup"&&!var(59)
var(40) = 9
ignorehitpause=1

[state -2]
type = Helper
trigger1 = (var(40)=[4,9])&&!numhelper(7711)
id = 7711
stateno=7710
pos = 15+25+(teamside=1&&facing=-1)*240-(teamside=2&&facing=1)*240+floor(fvar(19)),63-232+floor(1000*ifelse(((fvar(19)-floor(fvar(19)))=(0,.001)),-1000,1)*(fvar(19)-floor(fvar(19))))
postype = back
ignorehitpause=1
pausemovetime=999
supermovetime=999
size.xscale = .5*.75
size.yscale = .5*.75

;◆援軍関連ボイス◆
;野郎共！準備はいいか？
[state -2]
type = PlaySND
trigger1 = roundstate=2&&alive
trigger1 = var(40)=-10||(!var(40)&&floor(var(43)/1000)>=100)
trigger1 = var(10) := floor(175*(TicksPerSecond/60))
value = 10,197
channel = 1
;2.913sec

[state -2]
type = VarSet
trigger1 = roundstate=2&&alive&&numhelper(10000)
trigger1 = helper(10000),stateno=16500&&helper(10000),prevstateno=17000&&helper(10000),time=1
var(10) = 3180

;野郎共！俺に着いて来いよ！
[state -2]
type = PlaySND
trigger1 = roundstate=2&&alive&&random%3=0
trigger1 = var(10)=3000
trigger1 = var(10) := floor(167*(TicksPerSecond/60))
value = 10,200
channel = 1
;2.785sec

;来たぜ野郎共！腹いっぱい食ってやんな！
[state -2]
type = PlaySND
trigger1 = roundstate=2&&alive
trigger1 = var(10)=3000
trigger1 = var(10) := floor(207*(TicksPerSecond/60))
value = 10,198
channel = 1
;3.440sec

[state -2]
type = playsnd
trigger1 = (!var(10)||var(10)>=1000)&&roundstate=2&&alive&&!numexplod(40000)
trigger1 = var(40)=[5,6]
trigger1 = ((stateno!=[105,106])&&(stateno!=[195,3999]))||(stateno=[3110,3120])
trigger1 = var(10) := floor(34*(TicksPerSecond/60))
value = 10,52
channel = 1
;0.559sec

;野郎共！突撃だ！
[state -2]
type = playsnd
trigger1 = (!var(10)||var(10)>=1000)&&roundstate=2&&alive&&!numexplod(40000)
trigger1 = var(40)=8
trigger1 = 1;var(10) := floor(141*(TicksPerSecond/60))
value = 10,53
channel = 1
;2.335sec

[state -2]
type = playsnd
trigger1 = (!var(10)||var(10)>=1000)&&roundstate=2&&alive&&!numexplod(40000)
trigger1 = var(40)=9
trigger1 = var(10) := floor(69*(TicksPerSecond/60))
value = 10,54
channel = 1
;1.149sec

[state -2]
type = PlaySND
trigger1 = roundstate=2&&alive
trigger1 = var(40)=-2&&numexplod(6295)
trigger1 = var(10) := floor(180*(TicksPerSecond/60))
value = 10,199
channel = 1
;2.989sec

;~~~~~~~ゲージ表示~~~~~~
BASARAゲージ+一撃ゲージ
[state -2]
type = Helper
trigger1 = !numhelper(8000) && numenemy && !numhelper(9000)
id = 8000
stateno = 8000
pos = 8,224
postype = back
ownpal = 1
size.xscale = .5
size.yscale = .5
pausemovetime=99999
supermovetime=99999

;援軍ゲージ
[state -2]
type = Helper
trigger1 = !numhelper(8100) && numenemy && !numhelper(9000)
id = 8100
stateno = 8100
pos = 20,44
postype = back
ownpal = 1
size.xscale = .5
size.yscale = .5
pausemovetime=99999
supermovetime=99999

;ガードクラッシュゲージ
[state -2]
type = Helper
trigger1 = !numhelper(8500) && numenemy
trigger1 = !enemynear,numpartner && !(teammode=simul)&&!(enemynear,teammode=simul)
id = 8500
stateno = 8500
pos = 20,44
postype = back
ownpal = 1
size.xscale = .5
size.yscale = .5
pausemovetime=99999
supermovetime=99999

;~~~~~~~小判ゲージ~~~~~~~
[state -2]
type = Helper
trigger1 = var(40)>-1000 && var(40)!=-2 && !numhelper(8900) && numenemy && !(roundstate<2&&!roundsexisted)
name="Gold_Gauge"
id = 8900
stateno = 8900
pos = 120,224
postype = back
ownpal = 1
size.xscale = .5
size.yscale = .5
pausemovetime=99999
supermovetime=99999
facing=facing

;===燃焼
[state -2]
type = helper
trigger1 = stateno=1300 && movehit=1
trigger2 = (stateno=[3000,3010]) && movehit=1
trigger3 = numhelper(3050)
trigger3 = helper(3050),movehit=1
trigger4 = numhelper(3555)
trigger4 = helper(3555),movehit=1
trigger5 = numhelper(26720)
trigger5 = helper(26720),movehit=1
trigger6 = numhelper(26730)
trigger6 = helper(26730),movehit=1
id = 7250
stateno=7250
ownpal = 1
pos = enemynear,const(size.mid.pos.x),enemynear,const(size.mid.pos.y)
postype = p1

;==援軍ヒットキャンセル判別
[state -2]
type = varadd
trigger1 = var(15)
var(15) = ifelse(var(15)<0,1,-1)
ignorehitpause=1

;アーマー処理
[state -2]
type = varset
trigger1 = (stateno!=[3000,3199]) && !((prevstateno=[3000,3199])&&(stateno=[5000,5099]))
var(46) = 0

;援軍操作

;援軍アタック・援軍エリアルアタック用
;（ヘルパー側だと本体が行動不能中（暗転中など）でも出せてしまうため）
[state -2]
type = Explod
trigger1 = ((var(40)=[4,6])||(var(40)=[8,9]))&&!var(59)
id = 6295+ifelse(command="holdfwd",1,ifelse(command="holdback",2,0))
anim = 90000
removetime=1
ignorehitpause=1

;援軍アタック・援軍エリアルアタック用
;（ヘルパー側だと本体が行動不能中（暗転中など）でも出せてしまうため）
[state -2]
type = Explod
trigger1 = ((var(40)=[4,6])||(var(40)=[8,9]))&&var(59)
id = 6295+ifelse(var(40)=8,2,ifelse(var(2)>1,1,ifelse(random%7<2,2,0)))
anim = 90000
removetime=1
ignorehitpause=1

;~~~~元親
;こいつで遊んでみるか
;見たか！こいつも最新型よ
;こいつの実戦投入は…
[state -2]
type = PlaySND
trigger1 = (!var(10)||var(10)>=1000)&&roundstate=2&&alive&&!numexplod(40000)&&numhelper(20000)
trigger1 = (helper(20000),stateno=20008||helper(20000),stateno=21008||helper(20000),stateno=22008)&&helper(20000),time=1
trigger1 = var(10) := floor(ifelse(var(12)>=10000,466,ifelse(var(12)>=2000,239,159))*(TicksPerSecond/60))
value = 10,74+ifelse(var(12)>=10000,2,ifelse(var(12)>=2000,1,0))
channel = 1
;2.650sec
;3.977sec
;7.763sec

;くっそう！野郎ども！踏ん張れよ！
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&alive&&!numexplod(40000)&&numhelper(20000)
trigger1 = (helper(20000),prevstateno=[5000,5099])&&helper(20000),time=1&&((var(12)=[10361,10600])||(var(12)=[2301,2500])||(var(12)=[201,400]))&&random%3=0
trigger1 = var(10) := floor(218*(TicksPerSecond/60))
value = 10,55
channel = 1
;3.617sec

;てめぇ…
;なんてことしやがる！…
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&alive&&!numexplod(40000)&&numhelper(20000)
trigger1 = (helper(20000),stateno=20500||helper(20000),stateno=21500||helper(20000),stateno=22500)&&helper(20000),time=1&&fvar(23)!=90000
trigger1 = var(10) := floor(ifelse(var(50)%2=0,264,148)*(TicksPerSecond/60))
value = 10,72+var(50)%2
channel = 1
;4.396sec
;2.453sec

;いい感じに貯まってきたぜ！
;こいつはかなりの稼ぎだぜ！
;はっは！お宝獲り放題だ！
[state -2]
type = PlaySND
trigger1 = !var(10)&&roundstate=2&&alive&&!numexplod(40000)&&movetype!=H&&var(37)>=2000&&gametime%480=0&&var(50)<500&&!var(2) && numhelper(18600)
trigger1 = var(10) := floor(ifelse(var(37)>=9999,194,ifelse(var(37)>=5000,133,124))*(TicksPerSecond/60))
value = 10,66+ifelse(var(37)>=9999,2,ifelse(var(37)>=5000,1,0))
channel = 1
;2.056sec
;2.202sec
;3.055sec

[state -2]
type = varset
trigger1 = var(12)=-1||var(12)=-2001||var(12)=-10001
var(12) = floor(fvar(23))+ifelse(var(12)=-10001,10001,ifelse(var(12)=-2001,2001,1))
ignorehitpause=1

[state -2]
type = varAdd
trigger1 = roundstate=2&&!numexplod(40000) && var(12)<-1&&(var(40)!=[-899,-2])
trigger2 = numhelper(10000) && var(12)<0
trigger2 = helper(10000),stateno=14400
var(12) = 1
ignorehitpause=1

[state -2]
type = varset
trigger1 = !numhelper(20000)&&(var(12)=1||var(12)=2001||var(12)=10001)
var(12) = 0
ignorehitpause=1

[state -2]
type = varadd
trigger1 = fvar(23)>90000
fvar(23) = -1

[state -2]
type = varset
trigger1 = var(12)<0&&var(40)=1
var(40) = -1
ignorehitpause=1

[state -2]
type = StatetypeSet
trigger1 = numhelper(10000)&&roundstate=3&&stateno=0
trigger1 = helper(10000),stateno=14400
movetype=A

[state -2]
type = StatetypeSet
trigger1 = numhelper(10000)&&roundstate=3&&stateno=0
trigger1 = helper(10000),stateno!=14400
movetype=I

[state -2]
type = varset
trigger1 = movetype=H&&statetype!=A
var(13) = 0
ignorehitpause=1

[state -2]
type = varset
trigger1 = !var(2)&&var(36)=1
trigger2 = stateno!=3010&&var(36)=2
var(36) = 0
ignorehitpause=1

[state -2]
type = varset
trigger1 = !roundsexisted&&roundstate<2&&var(37)<1000
var(37)  = ifelse((teammode=turns)||numpartner,1999,1000)
ignorehitpause=1

[state -2]
type = varset
trigger1 = var(37)>9999
var(37)  = 9999
ignorehitpause=1

[state -2]
type = varadd
trigger1 = enemynear,name="chousokabe motochika"&&enemynear,authorname="gal129"&&(enemynear,fvar(25)-floor(enemynear,fvar(25)))=.9 && roundstate=2
var(37) = floor(1000*(floor(enemynear,fvar(25))+1))
ignorehitpause = 1

;小判獲得レート

[state -2]
type = VarAdd
trigger1 = movecontact=1 && numtarget
trigger1 = target,time=ifelse(var(1)%2>=1||var(1)%8>=4,1,0)
trigger2 = movecontact=1 && movetype=H
fvar(24) = ifelse(moveguarded=1,.05,.1)
ignorehitpause = 1

[state -2]
type = VarAdd
trigger1 = (var(38)-Life)>0&&(stateno!=[150,155])&&movetype=H
trigger2 = (stateno=150||stateno=152||stateno=154)&&Time=0
fvar(24) = -ifelse((stateno=[150,155]),.005,.05)
ignorehitpause = 1

[state -2]
type = varset
trigger1 = fvar(24)>10
fvar(24) = 10
ignorehitpause = 1

[state -2]
type = varset
trigger1 = fvar(24)<0
fvar(24) = 0
ignorehitpause = 1

[state -2]
type = varset
trigger1 = roundstate<2
fvar(24) = 1.0
ignorehitpause = 1

;小判エフェクト
[state -2]
type = Helper
triggerall = (movehit=1||(movehit=2&&var(1)%2>=1)||projhit=1) && roundstate=2 && numhelper(15900)
triggerall = helper(15900),var(20)
triggerall = var(40)!=-2
trigger1 = numtarget
trigger1 = target,time=0 && (target,stateno=5000||target,stateno=5010||target,stateno=5020||target,stateno=5070||target,stateno=5080)
trigger2 = !numtarget && movetype=H && P2movetype=H && (P2stateno!=[150,155])
trigger3 = numtarget
trigger3 = target,time=1 && (target,prevstateno=[5000,5099]) && var(1)%2>=1
id = 18600
stateno=18600
pos = 0,enemynear,const(size.mid.pos.y)
postype = P2
ownpal = 1
facing=-1
pausemovetime=999999
supermovetime=999999
ignorehitpause = 1

[state -2]
type = varset
trigger1 = var(12)<=0
fvar(22) = 0

;カラクリ兵器画面位置
[state -2]
type = varset
trigger1 = numhelper(18000) &&numhelper(20000) && var(12)>0 && roundstate>=2 && !numexplod(40000)
fvar(22) = helper(20000),pos x-(helper(18000),pos x-ifelse(teamside=2,40,-40))

[state -2]
type = varadd
trigger1 = numhelper(18000) && numhelper(20000) && var(12)>0 && roundstate>=2 && !numexplod(40000)
trigger1 = numpartner
trigger1 = (ID-partner,ID)>0
fvar(22) = -ifelse(teamside=2,60,-60)

[state -2]
type = varset
trigger1 = roundstate<2
fvar(25) = .90
ignorehitpause=1

[state -2]
type = varadd
trigger1 = (fvar(25)-floor(fvar(25)))>=.001
fvar(25) = -.001
ignorehitpause=1

[state -2]
type = varset
trigger1 = (fvar(25)-floor(fvar(25)))=(0,0.001)
fvar(25) = floor(fvar(25))
ignorehitpause=1

;オウム
[state -2]
type = Helper
triggerall = var(40)!=-2
trigger1 = roundstate=2&&!numexplod(40000)&&gametime%30=0&&random%5=0&&(fvar(25)-floor(fvar(25)))=0&&!numhelper(18100)&&!numhelper(18500)
id = 18100
stateno=18100
pos = 0,0
postype = back
ownpal = 1
facing=ifelse((teamside=1&&facing=1)||(teamside=2&&facing=-1),-1,1)
pausemovetime=999999
supermovetime=999999
ignorehitpause = 1

;宝箱
[state -2]
type = Helper
triggerall = var(40)!=-2
trigger1 = roundstate=2&&!numexplod(40000)&&numhelper(18100)
trigger1 = helper(18100),var(2)=11
id = 18500
stateno=18500
pos = floor(helper(18100),pos x-pos x)*ifelse(helper(18100),facing!=facing,-1,1)*ifelse(teamside=1,-1,1)+100*ifelse(ifelse(teamside=2,facing=-1,facing=1),1,0),-floor(Pos Y)
postype = p1
ownpal = 1
pausemovetime=999999
supermovetime=999999
ignorehitpause = 1

;援軍暗転中判別
[state -2]
type = Explod
trigger1 = !(stateno=3000&&AnimElemTime(1)>=1&&AnimElemTime(1)<31&&Anim=3000)&&!(stateno=3010&&AnimElemTime(3)>=0&&AnimElemTime(3)<30&&Anim=3010)&&!(stateno=3100&&Anim=3100&&AnimElemTime(2)>=0&&AnimElemTime(2)<30)
trigger1 = !(stateno=3500&&AnimElemTime(4)>=0&&AnimElemTime(7)<=0)
id = 50000
anim = 90000
pos =0,0
postype = back
ignorehitpause=1
removetime = 1
pausemovetime=999
supermovetime=999

[state -2]
type = varset
trigger1 = !((numexplod(7701)||numexplod(7702))&&(stateno=150||stateno=152||stateno=154||stateno=4120)&&time<=1)
var(38) = Life
ignorehitpause=1

[state -2]
type = varset
trigger1 = !((numexplod(7701)||numexplod(7702))&&(stateno=150||stateno=152||stateno=154||stateno=4120)&&time<=1)
var(55) = Power
ignorehitpause=1

;相手AI判別
[state -2]
type = varadd
trigger1 = (enemynear,stateno=[130,132])&&enemynear,time=1&&enemynear,command!="holdback"&&((enemynear,prevstateno=[0,99])||(enemynear,ctrl&&enemynear,prevstateno!=120))&&(enemynear,prevstateno!=[130,155])
fvar(35) = 1

[state -2]
type = DisplayToClipBoard
trigger1 = 1
text = "Combo = %f Air=%d BASARA Gauge=%f Koban Rate=%f Engun Gauge=%d"
params = fvar(0), var(3), fvar(16), fvar(24), var(40)
ignorehitpause=1

[state -3]
type = varset
trigger1 = (anim=[5120,5121]) && animtime=0 && (stateno!=[5000,5199])
fvar(33) = 1.18

[statedef -3]

[state -3]
type = varadd
trigger1 = !(statetype=L&&anim=5120) && P2stateno=50&&enemynear,time=1&&ifelse(P2bodydist X<160,1,Vel X>0)
fvar(29) = 1

[state -3]
type = varadd
trigger1 = !(statetype=L&&anim=5120) && P2statetype!=A
fvar(29) = -.0075

;===ガード不能(中段)技判別
[state -2]
type = varset
triggerall = P2movetype=A && (P2bodydist X=[-10,100]) && !fvar(30) && (P2statetype!=A||(P2statetype=A&&!(enemynear,vel Y>=0||enemynear,pos Y<-90)))
trigger1 = time=0 && (prevstateno=[120,140]) && (stateno=5000||stateno=5010)
trigger2 = time=1 && (stateno!=[150,155]) && (stateno!=[5000,5099]) && (prevstateno=[5000,5099]) && movetype=H
fvar(30) = P2stateno

[state -2]
type = varadd
triggerall = P2movetype=A &&(P2bodydist X=[-10,100]) && floor(fvar(30))=P2stateno && (P2statetype!=A||(P2statetype=A&&!(enemynear,vel Y>0||enemynear,pos Y<-90))) && (fvar(30)-floor(fvar(30)))<.999
trigger1 = time=0 && (prevstateno=[120,140]) && (stateno=5000||stateno=5010)
trigger2 = time=1 && (stateno!=[150,155]) && (stateno!=[5000,5099]) && (prevstateno=[5000,5099]) && movetype=H
fvar(30) = .001

[state -2]
type = varadd
trigger1 = !fvar(33) && movetype!=H && statetype!=L && (fvar(30)-floor(fvar(30)))>.001 && ((gametime%50=0 && random%3!=0)||roundstate=0)
fvar(30) = -.0002

[state -2]
type = varset
trigger1 = roundstate=0&&!enemynear,roundsexisted
fvar(30) = 0

[state -2]
type = varset
triggerall = P2movetype=A && (P2bodydist X=[-10,100]) && !fvar(31) && (P2statetype!=A||(P2statetype=A&&!(enemynear,vel Y>=0||enemynear,pos Y<-90)))
trigger1 = time=0 && (prevstateno=[120,140]) && (stateno=5000||stateno=5010)
trigger2 = time=1 && (stateno!=[150,155]) && (stateno!=[5000,5099]) && (prevstateno=[5000,5099]) && movetype=H
fvar(31) = P2stateno

[state -2]
type = varadd
triggerall = P2movetype=A &&(P2bodydist X=[-10,100]) && floor(fvar(31))=P2stateno && (P2statetype!=A||(P2statetype=A&&!(enemynear,vel Y>0||enemynear,pos Y<-90))) && (fvar(31)-floor(fvar(31)))<.999
trigger1 = time=0 && (prevstateno=[120,140]) && (stateno=5000||stateno=5010)
trigger2 = time=1 && (stateno!=[150,155]) && (stateno!=[5000,5099]) && (prevstateno=[5000,5099]) && movetype=H
fvar(31) = .001

[state -2]
type = varadd
trigger1 = !fvar(33) && movetype!=H && statetype!=L && (fvar(31)-floor(fvar(31)))>.001 && ((gametime%50=0 && random%3!=0)||roundstate=0)
fvar(31) = -.0002

[state -2]
type = varset
trigger1 = floor(fvar(30))=floor(fvar(31))
trigger2 = roundstate=0&&!enemynear,roundsexisted
fvar(31) = 0

[state -2]
type = varset
triggerall = P2movetype=A && (P2bodydist X=[-10,100]) && !fvar(32) && (P2statetype!=A||(P2statetype=A&&!(enemynear,vel Y>0||enemynear,pos Y<-90)))
trigger1 = time=0 && (prevstateno=[120,140]) && (stateno=5000||stateno=5010)
trigger2 = time=1 && (stateno!=[150,155]) && (stateno!=[5000,5099]) && (prevstateno=[5000,5099]) && movetype=H
fvar(32) = P2stateno

[state -2]
type = varadd
triggerall = P2movetype=A &&(P2bodydist X=[-10,100]) && floor(fvar(32))=P2stateno && (P2statetype!=A||(P2statetype=A&&!(enemynear,vel Y>=0||enemynear,pos Y<-90))) && (fvar(32)-floor(fvar(32)))<.999
trigger1 = time=0 && (prevstateno=[120,140]) && (stateno=5000||stateno=5010)
trigger2 = time=1 && (stateno!=[150,155]) && (stateno!=[5000,5099]) && (prevstateno=[5000,5099]) && movetype=H
fvar(32) = .001

[state -2]
type = varadd
trigger1 = !fvar(33) && movetype!=H && statetype!=L && (fvar(32)-floor(fvar(32)))>.001 && ((gametime%50=0 && random%3!=0)||roundstate=0)
fvar(32) = -.0002

[state -2]
type = varset
trigger1 = floor(fvar(30))=floor(fvar(32))||floor(fvar(31))=floor(fvar(32))
trigger2 = roundstate=0&&!enemynear,roundsexisted
fvar(32) = 0

[state -3]
type = varset
trigger1 = (stateno=[200,3999])||((fvar(33)-floor(fvar(33)))=[0,.01])
fvar(33) = 0

[state -3]
type = varadd
trigger1 = fvar(33)>0
fvar(33) = -0.01

[state -3]
type = varset
trigger1 = (anim=[5120,5121]) && animtime=0
fvar(33) = 1.18

[state -3]
type = varset
trigger1 = (stateno=151||stateno=153||stateno=155)
trigger1 = (((hitover||ctrl)&&!numexplod(7701) && !numexplod(7702))||(time >= floor(GetHitVar(ctrltime)*.8) && numexplod(7706))||(time >= (GetHitVar(ctrltime)+4) && (numexplod(7701) || numexplod(7702))))
fvar(33) = 2.18

[state -3]
type = varset
trigger1 = (stateno=5001||stateno=5011||stateno=5021) && hitover
fvar(33) = 3.18

[state -2]
type = varadd
trigger1 = p2statetype=A
fvar(34) = 1

[state -2]
type = varset
trigger1 = p2statetype!=A
fvar(34) = 0

;有利時間判別
[state -3]
type = varadd
trigger1 = fvar(36)&&!(var(52)>0&&movecontact)
fvar(36) = ifelse(fvar(36)<0,1,-1)

[state -3]
type = varset
trigger1 = (stateno=[200,999])&&movecontact=1
fvar(36) = (ifelse(stateno=210||stateno=610,14,ifelse(stateno=200||stateno=400||stateno=600||stateno=910,10,ifelse(stateno%100>=20,20,17)))+4+(numhelper(8710))*7)*ifelse(moveguarded,-1,1)

[state -3]
type = varset
trigger1 = stateno=1400&&movecontact=1 && numtarget
fvar(36) = (17+17+4+(numhelper(8710))*7)*ifelse(moveguarded,-1,1)

[state -3]
type = varset
trigger1 = numhelper(20000)
trigger1 = helper(20000),movecontact=2 && helper(20000),numtarget
fvar(36) = (ifelse((var(12)=[5001,10000]),20+14,ifelse((var(12)=[2001,5000]),17+13,14+12))+4)*ifelse(helper(20000),moveguarded,-1,1)

[state -3]
type = varset
trigger1 = numhelper(20000)
trigger1 = helper(20000),var(19)!=0
fvar(36) = (ifelse((var(12)=[5001,10000]),20+14,ifelse((var(12)=[2001,5000]),12+11,14+12))+4)*ifelse(helper(20000),moveguarded,-1,1)

;弓
[state -3]
type = varset
trigger1 = numhelper(26700)
trigger1 = helper(26700),movecontact=2 && helper(26700),numtarget
fvar(36) = (ifelse((var(12)=[5001,10000]),20+14,ifelse((var(12)=[2001,5000]),17+13,14+12))+4)*ifelse(helper(26700),moveguarded,-1,1)

[state -3]
type = varset
trigger1 = numhelper(26700)
trigger1 = helper(26700),var(19)!=0
fvar(36) = (ifelse((var(12)=[5001,10000]),20+14,ifelse((var(12)=[2001,5000]),12+11,14+12))+4)*ifelse(helper(26700),moveguarded,-1,1)

;火炎
[state -3]
type = varset
trigger1 = numhelper(26740)
trigger1 = helper(26740),movecontact=2 && helper(26740),numtarget
fvar(36) = (ifelse((var(12)=[5001,10000]),20+14,ifelse((var(12)=[2001,5000]),17+13,14+12))+4)*ifelse(helper(26740),moveguarded,-1,1)

[state -3]
type = varset
trigger1 = numhelper(26740)
trigger1 = helper(26740),var(19)!=0
fvar(36) = (ifelse((var(12)=[5001,10000]),20+14,ifelse((var(12)=[2001,5000]),12+11,14+12))+4)*ifelse(helper(26740),moveguarded,-1,1)

;相手のリーチ判別
[state -3]
type = varset
trigger1 = roundstate<2&&!enemynear,roundsexisted
fvar(37) = 0

[state -3]
type = varset
trigger1 = (stateno=150||stateno=152||stateno=5000||stateno=5010||stateno=5070)&&time=1&&enemynear,time<ifelse(P2bodydist X>160,22,ifelse(P2bodydist X>120,18,12))
fvar(37) = floor(P2bodydist X)
